'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

// Generated by CoffeeScript 2.0.3
var Button, Clock, a, b, buttons, circles, hist, info, level, levels, mousePressed, newGame, setup, state, total, xdraw;

total = 0;

levels = [];

// resten, klockorna, total, steps
levels.push([[0, 6, 2, 7], [1, 7, 13, 17], 41, 3]);

// levels.push [[2,3,2], [3,5,11], 68, 8] 
// levels.push [[2,3,2], [3,7,11], 101, 11]
// levels.push [[1,1,5], [2,3,7], 19, 7]
levels.push([[4, 6], [5, 7], 34, 6]);

levels.push([[2, 5], [5, 7], 12, 4]);

levels.push([[1, 5], [3, 7], 19, 7]);

levels.push([[1, 4], [3, 5], 4, 4]);

levels.push([[4, 3], [5, 7], 24, 6]);

levels.push([[4], [5], 4, 4]);

levels.push([[0, 1], [2, 3], 4, 2]);

levels.push([[1, 1, 1], [2, 3, 5], 1, 1]);

levels.push([[0, 2, 2], [2, 3, 5], 2, 2]);

levels.push([[2, 3, 2], [3, 5, 7], 23, 5]);

level = -1;

hist = [];

buttons = [];

circles = [];

a = null;

b = null;

state = 0; // 0=game running 

// 1=game finished
Button = function () {
  function Button(txt, x, y) {
    var f = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

    _classCallCheck(this, Button);

    this.txt = txt;
    this.x = x;
    this.y = y;
    this.f = f;
    this.enabled = false;
  }

  _createClass(Button, [{
    key: 'draw',
    value: function draw() {
      if (this.enabled) {
        fc(1);
      } else {
        fc(0);
      }
      return text(this.txt, this.x, this.y);
    }
  }]);

  return Button;
}();

Clock = function () {
  function Clock(a1, b1, x, y) {
    var f = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;

    _classCallCheck(this, Clock);

    this.a = a1;
    this.b = b1;
    this.x = x;
    this.y = y;
    this.f = f;
  }

  _createClass(Clock, [{
    key: 'draw',
    value: function draw() {
      var j, k, len, ref;
      push();
      translate(this.x, this.y);
      sw(1);
      if (total % this.b === this.a) {
        fc(0, 1, 0);
      } else {
        fc(1, 0, 0);
      }
      sc(1 - state);
      circle(0, 0, 40);
      fc(1 - state);
      textSize(40);
      text(this.b, 0, 0);
      rotate(radians(-90 - this.a * 360 / this.b));
      ref = range(this.b);
      for (k = 0, len = ref.length; k < len; k++) {
        j = ref[k];
        sw(5);
        point(40, 0);
        sw(2);
        if (j === total % this.b) {
          line(0, 0, 40, 0);
        }
        rotate(radians(360 / this.b));
      }
      return pop();
    }
  }]);

  return Clock;
}();

newGame = function newGame() {
  var i, k, len, ref;
  level++;
  level %= levels.length;
  buttons[4].enabled = true;
  state = 0;
  total = 0;
  a = levels[level][0];
  b = levels[level][1];
  hist = [];
  circles = [];
  ref = range(a.length);
  for (k = 0, len = ref.length; k < len; k++) {
    i = ref[k];
    circles.push(new Clock(a[i], b[i], 200, 100 + 100 * i, function () {
      if (state === 0) {
        hist.push(total);
        return total += this.b;
      }
    }));
  }
  return xdraw();
};

setup = function setup() {
  createCanvas(800, 800);
  textAlign(CENTER, CENTER);
  textSize(64);
  buttons.push(new Button('', 500, 100, function () {}));
  buttons.push(new Button('', 500, 200, function () {}));
  buttons.push(new Button('', 500, 300, function () {}));
  buttons.push(new Button('undo', 500, 500, function () {
    if (state === 0 && hist.length > 0) {
      return total = hist.pop();
    }
  }));
  buttons.push(new Button('new', 500, 600, function () {
    if (state === 1) {
      return newGame();
    }
  }));
  return newGame();
};

info = function info() {
  var button, k, len, results;
  buttons[0].txt = 'level: ' + level;
  buttons[1].txt = 'steps: ' + (levels[level][3] - hist.length);
  buttons[2].txt = 'total: ' + total;
  buttons[3].enabled = state === 0 && hist.length > 0;
  buttons[4].enabled = state === 1;
  results = [];
  for (k = 0, len = buttons.length; k < len; k++) {
    button = buttons[k];
    results.push(button.draw());
  }
  return results;
};

xdraw = function xdraw() {
  var c, k, len, results;
  bg(0.5);
  info();
  results = [];
  for (k = 0, len = circles.length; k < len; k++) {
    c = circles[k];
    results.push(c.draw());
  }
  return results;
};

mousePressed = function mousePressed() {
  var k, len, obj, ref;
  ref = buttons.concat(circles);
  for (k = 0, len = ref.length; k < len; k++) {
    obj = ref[k];
    if (40 > dist(mouseX, mouseY, obj.x, obj.y)) {
      obj.f();
    }
  }
  if (levels[level][2] === total) {
    if (levels[level][3] === hist.length) {
      state = 1;
    }
  }
  return xdraw();
};
//# sourceMappingURL=sketch.js.map
