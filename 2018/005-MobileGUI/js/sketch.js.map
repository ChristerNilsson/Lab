{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# https://stackoverflow.com/questions/2010892/storing-objects-in-html5-localstorage\r\n# sex decimaler motsvarar 11 cm resp 5 cm precision i sista siffran.\r\n\r\nLINK = \"https://christernilsson.github.io/Lab/2018/005-MobileGUI/index.html\"\r\n\r\nWHITE = null\r\nGREEN = null\r\nBLACK = null\r\nRED   = null\r\n\r\npages = {}\r\nplace = null\r\noldName = null\r\n\r\n#normal = 0 # 0 = values 1 = help texts\r\n\r\nplaces = []\r\nplaces.push {name:'Bagarmossen Sushi',     lat:59.277560, lng:18.132739}\r\nplaces.push {name:'Bagarmossen T',         lat:59.276264, lng:18.131465}\r\nplaces.push {name:'Björkhagens Golfklubb', lat:59.284052, lng:18.145925}\r\nplaces.push {name:'Björkhagen T',          lat:59.291114, lng:18.115521}\r\nplaces.push {name:'Brotorpsbron',\t\t\t\t\t lat:59.270067, lng:18.150236}\r\nplaces.push {name:'Brotorpsstugan',        lat:59.270542, lng:18.148473}\r\nplaces.push {name:'Kärrtorp T',            lat:59.284505, lng:18.114477}\r\nplaces.push {name:'Hellasgården',          lat:59.289813, lng:18.160577}\r\nplaces.push {name:'Hem',                   lat:59.265205, lng:18.132735}\r\nplaces.push {name:'Parkeringsgran',        lat:59.274916, lng:18.161353}\r\nplaces.push {name:'Pers badställe',        lat:59.289571, lng:18.170767}\r\nplaces.push {name:'Skarpnäck T',           lat:59.266432, lng:18.133093}\r\nplaces.push {name:'Söderbysjön N Bron',    lat:59.285500, lng:18.150542}\r\nplaces.push {name:'Söderbysjön S Bron',    lat:59.279155, lng:18.149318}\r\nplaces.push {name:'Ulvsjön, Udden',        lat:59.277103, lng:18.164897}\r\n\r\nplaceIndex = 0\r\nplace = places[placeIndex]\r\n\r\nw = null \r\nh = null \r\ntrack = []\r\nbearing = 0\r\nheading_12 = 0\r\nlastObservation = 0\r\np1 = null\r\nstart = null # Starttid. Sätts vid byte av target\r\nstartDate = null\r\n\r\ntexts = ['dist','bäring','ETA','km/h','','wait','punkter','','tid','destination']\r\n\r\nstoreData = -> localStorage[\"GPSCompass\"] = JSON.stringify places\t\r\nfetchData = ->\r\n\tdata = localStorage[\"GPSCompass\"]\r\n\tif data then places = JSON.parse data \r\n\r\nhideCanvas = ->\r\n\telem = document.getElementById 'myContainer'\r\n\telem.style.display = 'none'\t\t\r\n\r\nshowCanvas = ->\r\n\telem = document.getElementById 'myContainer'\r\n\telem.style.display = 'block'\r\n\r\n################################\r\n\r\nsetupCompass = ->\r\n\twindow.addEventListener \"deviceorientation\", (event) ->\r\n\t\tbearing = event.alpha\r\n\t\tif typeof event.webkitCompassHeading != \"undefined\"\r\n\t\t\tbearing = event.webkitCompassHeading # iOS non-standard\r\n\r\nlocationUpdate = (position) ->\r\n\t#print 'locationUpdate', position\r\n\tp1 = \r\n\t\tlat : position.coords.latitude\r\n\t\tlng : position.coords.longitude\r\n\t\ttimestamp : position.timestamp # milliseconds since 1970\r\n\r\n\ttrack.push p1\r\n\r\n\theading_12 = calcHeading p1,place\r\n\tlastObservation = millis()\r\n\r\n\ttexts[0] = prettyDist distance_on_geoid p1,place\r\n\ttexts[1] = \"#{Math.round heading_12}°\"\r\n\ttexts[6] = track.length \r\n\tif track.length > 1\r\n\t\tspeed     = calcSpeed     start, millis(), track[0], _.last(track), place\r\n\t\ttotalTime = calcTotalTime start, millis(), track[0], _.last(track), place\r\n\t\ttexts[3] = \"#{precisionRound 3.6*speed,1} km/h\"  \r\n\t\ttexts[2] = prettyETA startDate, totalTime\r\n\r\nlocationUpdateFail = (error) ->\r\n\r\nnavigator.geolocation.watchPosition locationUpdate, locationUpdateFail, \r\n\tenableHighAccuracy: true\r\n\tmaximumAge: 30000\r\n\ttimeout: 27000\r\n\r\n##########################\r\n\r\n#mousePressed = -> normal = 1 - normal\r\n\r\nsetup = ->\r\n\r\n\tWHITE = color 255,255,255\r\n\tGREEN = color 0,255,0\r\n\tBLACK = color 0,0,0\r\n\tRED   = color 255,0,0\r\n\r\n\ttest()\r\n\r\n\tfetchData()\r\n\r\n\tparameters = getParameters()\r\n\tif _.size(parameters) == 3 \r\n\t\tconsole.log parameters\r\n\t\tplaces.push parameters\r\n\t\tstoreData()\r\n\r\n\tstart = millis()\r\n\r\n\tc = createCanvas windowWidth,windowHeight*0.90 # 4s\r\n\tw = width\r\n\th = height\t\r\n\r\n\tc.parent 'myContainer'\t\r\n\thideCanvas()\r\n\r\n\tsetupCompass()\r\n\r\n\tpages.List = new Page ->\r\n\t\tfor p,i in places\r\n\t\t\tdo (i) =>\r\n\t\t\t\tb = makeButton p.name, 1, => \r\n\t\t\t\t\tplace = places[i]\r\n\t\t\t\t\tpages.Nav.display()\r\n\t\t\t\tb.style.textAlign = 'left' \r\n\t\t\t\t@addRow b\t\t\r\n\tpages.List.addAction 'Add', -> pages.Add.display()\r\n\r\n\tpages.Nav = new Page -> \r\n\t\ttexts[9] = place.name\r\n\t\tstart = millis()\r\n\t\tstartDate = new Date()\r\n\t\ttrack = []\r\n\t\tlastObservation = millis()\r\n\t\tshowCanvas()\r\n\r\n\tpages.Nav.addAction 'List', -> pages.List.display()\r\n\tpages.Nav.addAction 'Map', -> window.open \"http://maps.google.com/maps?q=#{place.lat},#{place.lng}\"\r\n\tpages.Nav.addAction 'Edit', -> pages.Edit.display()\r\n\tpages.Nav.addAction 'Del', -> pages.Del.display()\r\n\tpages.Nav.addAction 'Link', -> pages.Link.display()\r\n\r\n\tpages.Edit = new Page ->\r\n\t\toldName = place.name\r\n\t\t@addRow makeInput 'name',place.name\r\n\t\t@addRow makeInput 'lat',place.lat\r\n\t\t@addRow makeInput 'lng',place.lng\r\n\t\tdocument.getElementById(\"name\").focus()\r\n\t\tdocument.getElementById(\"name\").select()\r\n\tpages.Edit.addAction 'Update', -> \r\n\t\tname = getField \"name\"\r\n\t\tlat = parseFloat getField \"lat\"\r\n\t\tlng = parseFloat getField \"lng\"\r\n\t\tif isNumeric(lat) and isNumeric(lng)\r\n\t\t\tif oldName == name # finns namnet redan?\r\n\t\t\t\tfor p in places\r\n\t\t\t\t\tif oldName == p.name\r\n\t\t\t\t\t\tp.lat = lat\r\n\t\t\t\t\t\tp.lng = lng\r\n\t\t\telse\r\n\t\t\t\tplaces = places.filter (e) => e.name != oldName\r\n\t\t\t\tplaces.push {name:name,lat:lat,lng:lng}\r\n\t\t\t\tplaces.sort (a,b) -> if a.name > b.name then 1 else -1\r\n\t\t\tstoreData()\r\n\t\t\tpages.List.display()\r\n\tpages.Edit.addAction 'Cancel', -> pages.List.display()\r\n\r\n\tpages.Add = new Page ->\r\n\t\tif track.length > 0\r\n\t\t\tlast = _.last track\r\n\t\t\tprint last \r\n\t\t\t@addRow makeInput 'name', prettyDate new Date last.timestamp\r\n\t\t\t@addRow makeInput 'lat',  precisionRound last.lat,6\r\n\t\t\t@addRow makeInput 'lng',  precisionRound last.lng,6\r\n\t\telse\r\n\t\t\t@addRow makeInput 'name', 'Missing'\r\n\t\t\t@addRow makeInput 'lat',  0\r\n\t\t\t@addRow makeInput 'lng',  0\r\n\t\tdocument.getElementById(\"name\").focus()\r\n\t\tdocument.getElementById(\"name\").select()\r\n\tpages.Add.addAction\t'Save', -> \r\n\t\tname = getField \"name\"\r\n\t\tlat = parseFloat getField \"lat\"\r\n\t\tlng = parseFloat getField \"lng\"\r\n\t\tif isNumeric(lat) and isNumeric(lng)\r\n\t\t\tplaces.push {name:name, lat:lat, lng:lng}\r\n\t\t\tplaces.sort (a,b) -> if a.name > b.name then 1 else -1\r\n\t\t\tstoreData()\r\n\t\t\tpages.List.display()\r\n\tpages.Add.addAction 'Cancel', -> pages.List.display()\r\n\r\n\tpages.Del = new Page -> \r\n\t\t@addRow makeInput 'name',place.name,true\r\n\t\t@addRow makeInput 'lat',place.lat,true\r\n\t\t@addRow makeInput 'lng',place.lng,true\r\n\tpages.Del.addAction 'Delete', -> \r\n\t\tplaces = places.filter (e) => e.name != place.name\r\n\t\tstoreData()\r\n\t\tpages.List.display()\r\n\tpages.Del.addAction 'Cancel', -> pages.Nav.display()\r\n\r\n\tpages.Link = new Page -> \r\n\t\t@addRow makeDiv 'The Link is now on the Clipboard. Mail it to a friend.'\r\n\t\t@addRow link = makeInput 'link', \"\" #, true\r\n\t\tlink.value += encodeURI \"#{LINK}?name=#{place.name}&lat=#{place.lat}&lng=#{place.lng}\\n\" \r\n\t\tif track.length > 0\r\n\t\t\tcurr = _.last track\r\n\t\t\tlink.value += encodeURI \"#{LINK}?name=#{curr.timestamp}&lat=#{curr.lat}&lng=#{curr.lng}\\n\"\r\n\t\tlink.focus()\r\n\t\tlink.select()\r\n\t\tdocument.execCommand 'copy'\r\n\t\t#link.value = ''\r\n\t\t#link.style.display = 'none'\r\n\tpages.Link.addAction 'Ok', -> pages.Nav.display()\r\n\r\n\t# startsida:\r\n\tpages.List.display()\r\n"
  ]
}