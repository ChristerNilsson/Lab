{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# https://stackoverflow.com/questions/2010892/storing-objects-in-html5-localstorage\r\n# sex decimaler motsvarar 11 cm resp 5 cm precision i sista siffran.\r\n\r\n#LINK = \"https://christernilsson.github.io/Lab/2018/005-MobileGUI/index.html\"\r\nLINK = \"file:///C:/Lab/2018/005-MobileGUI/index.html\"\r\n\r\nWHITE = null\r\nGREEN = null\r\nBLACK = null\r\nRED   = null\r\n\r\npages = {}\r\nlogg = []\r\n\r\nplaces = \r\n\t'Bagarmossen Sushi'      : {lat:59.277560, lng:18.132739}\r\n\t'Bagarmossen T'          : {lat:59.276264, lng:18.131465}\r\n\t'Björkhagens Golfklubb'  : {lat:59.284052, lng:18.145925}\r\n\t'Björkhagen T'           : {lat:59.291114, lng:18.115521}\r\n\t'Brotorpsbron'           : {lat:59.270067, lng:18.150236}\r\n\t'Brotorpsstugan'         : {lat:59.270542, lng:18.148473}\r\n\t'Kärrtorp T'             : {lat:59.284505, lng:18.114477}\r\n\t'Hellasgården'           : {lat:59.289813, lng:18.160577}\r\n\t'Hem'                    : {lat:59.265205, lng:18.132735}\r\n\t'Parkeringsgran'         : {lat:59.274916, lng:18.161353}\r\n\t'Pers badställe'         : {lat:59.289571, lng:18.170767}\r\n\t'Skarpnäck T'            : {lat:59.266432, lng:18.133093}\r\n\t'Söderbysjön N Bron'     : {lat:59.285500, lng:18.150542}\r\n\t'Söderbysjön S Bron'     : {lat:59.279155, lng:18.149318}\r\n\t'Ulvsjön, Udden'         : {lat:59.277103, lng:18.164897}\r\n\r\nplaceIndex = 'Bagarmossen Sushi'\r\nplace = -> places[placeIndex]\r\n\r\nw = null \r\nh = null \r\ntrack = []\r\nbearing = 0\r\nheading_12 = 0\r\nlastObservation = 0\r\np1 = null\r\nstart = null # Starttid. Sätts vid byte av target till millis()\r\nstartDate = null # . Sätts vid byte av target till new Date()\r\n\r\ntexts = ['dist','bäring','ETA','km/h','','wait','punkter','','tid','destination']\r\n\r\nstoreData = -> localStorage[\"GPSCompass\"] = JSON.stringify places\t\r\nfetchData = ->\r\n\tdata = localStorage[\"GPSCompass\"]\r\n\tprint data\r\n\tif data then places = JSON.parse data \r\n\r\nhideCanvas = ->\r\n\telem = document.getElementById 'myContainer'\r\n\telem.style.display = 'none'\t\t\r\n\r\nshowCanvas = ->\r\n\telem = document.getElementById 'myContainer'\r\n\telem.style.display = 'block'\r\n\r\n################################\r\n\r\nsetupCompass = ->\r\n\twindow.addEventListener \"deviceorientation\", (event) ->\r\n\t\tbearing = event.alpha\r\n\t\tif typeof event.webkitCompassHeading != \"undefined\"\r\n\t\t\tbearing = event.webkitCompassHeading # iOS non-standard\r\n\r\nlocationUpdate = (position) ->\r\n\t#print 'locationUpdate', position\r\n\tp1 = \r\n\t\tlat : position.coords.latitude\r\n\t\tlng : position.coords.longitude\r\n\t\ttimestamp : position.timestamp # milliseconds since 1970\r\n\r\n\ttrack.push p1\r\n\r\n\theading_12 = calcHeading p1,place()\r\n\tlastObservation = millis()\r\n\r\n\ttexts[0] = prettyDist distance_on_geoid p1,place()\r\n\ttexts[1] = \"#{Math.round heading_12}°\"\r\n\ttexts[6] = track.length \r\n\tif track.length > 1\r\n\t\tspeed     = calcSpeed     start, millis(), track[0], _.last(track), place()\r\n\t\ttotalTime = calcTotalTime start, millis(), track[0], _.last(track), place()\r\n\t\ttexts[3] = \"#{precisionRound 3.6*speed,1} km/h\"  \r\n\t\ttexts[2] = prettyETA startDate, totalTime\r\n\t\tlogg.push \"#{p1.timestamp} #{p1.lat} #{p1.lng}\" #  #{heading_12} #{speed} #{totaltime}\"\r\n\r\nlocationUpdateFail = (error) ->\r\n\r\nnavigator.geolocation.watchPosition locationUpdate, locationUpdateFail, \r\n\tenableHighAccuracy: true\r\n\tmaximumAge: 30000\r\n\ttimeout: 27000\r\n\r\n##########################\r\n\r\nsetup = ->\r\n\r\n\tWHITE = color 255,255,255\r\n\tGREEN = color 0,255,0\r\n\tBLACK = color 0,0,0\r\n\tRED   = color 255,0,0\r\n\r\n\ttest()\r\n\r\n\t#storeData()\r\n\tfetchData()\r\n\r\n\tparameters = getParameters()\r\n\tif _.size(parameters) == 3 \r\n\t\tkey = decodeURI parameters.name\r\n\t\tplaces[key] = {lat: parameters.lat, lng: parameters.lng}\r\n\t\tstoreData()\r\n\r\n\tstart = millis()\r\n\r\n\tc = createCanvas windowWidth,windowHeight*0.90 # 4s\r\n\tw = width\r\n\th = height\t\r\n\r\n\tc.parent 'myContainer'\t\r\n\thideCanvas()\r\n\r\n\tsetupCompass()\r\n\r\n\tpages.List = new Page ->\r\n\t\tkeys = _.keys places \r\n\t\tfor key in keys.sort()\r\n\t\t\tdo (key) =>\r\n\t\t\t\t@addRow b = makeButton key, 1, => \r\n\t\t\t\t\tplaceIndex = key\r\n\t\t\t\t\tpages.Nav.display()\r\n\t\t\t\tb.style.textAlign = 'left' \r\n\tpages.List.addAction 'Add', -> pages.Add.display()\r\n\tpages.List.addAction 'Links', -> pages.Links.display()\r\n\r\n\tpages.Nav = new Page -> \r\n\t\ttexts[9] = placeIndex\r\n\t\tstart = millis()\r\n\t\tstartDate = new Date()\r\n\t\ttrack = []\r\n\t\tlogg = []\r\n\t\tlastObservation = millis()\r\n\t\tshowCanvas()\r\n\tpages.Nav.addAction 'List', -> pages.List.display()\r\n\tpages.Nav.addAction 'Map', -> window.open \"http://maps.google.com/maps?q=#{place().lat},#{place().lng}\"\r\n\tpages.Nav.addAction 'Edit', -> pages.Edit.display()\r\n\tpages.Nav.addAction 'Del', -> pages.Del.display()\r\n\tpages.Nav.addAction 'Link', -> pages.Link.display()\r\n\r\n\tpages.Edit = new Page ->\r\n\t\t@addRow makeInput 'name',placeIndex\r\n\t\t@addRow makeInput 'lat',place().lat\r\n\t\t@addRow makeInput 'lng',place().lng\r\n\t\tdocument.getElementById(\"name\").focus()\r\n\t\tdocument.getElementById(\"name\").select()\r\n\tpages.Edit.addAction 'Update', -> \r\n\t\tname = getField \"name\"\r\n\t\tlat = parseFloat getField \"lat\"\r\n\t\tlng = parseFloat getField \"lng\"\r\n\t\tif isNumeric(lat) and isNumeric(lng)\r\n\t\t\tplaces[name] = {lat: lat, lng: lng}\r\n\t\t\tif placeIndex != name then delete places[placeIndex]\r\n\t\t\tplaceIndex = name\r\n\t\t\tstoreData()\r\n\t\t\tpages.List.display()\r\n\tpages.Edit.addAction 'Cancel', -> pages.List.display()\r\n\r\n\tpages.Add = new Page ->\r\n\t\tif track.length > 0\r\n\t\t\tlast = _.last track\r\n\t\t\t@addRow makeInput 'name', prettyDate new Date last.timestamp\r\n\t\t\t@addRow makeInput 'lat',  precisionRound last.lat,6\r\n\t\t\t@addRow makeInput 'lng',  precisionRound last.lng,6\r\n\t\telse\r\n\t\t\t@addRow makeInput 'name', 'Missing'\r\n\t\t\t@addRow makeInput 'lat',  0\r\n\t\t\t@addRow makeInput 'lng',  0\r\n\t\tdocument.getElementById(\"name\").focus()\r\n\t\tdocument.getElementById(\"name\").select()\r\n\tpages.Add.addAction\t'Save', -> \r\n\t\tname = getField \"name\"\r\n\t\tlat = parseFloat getField \"lat\"\r\n\t\tlng = parseFloat getField \"lng\"\r\n\t\tif isNumeric(lat) and isNumeric(lng)\r\n\t\t\tplaces[name] = {lat:lat, lng:lng}\r\n\t\t\tstoreData()\r\n\t\t\tpages.List.display()\r\n\tpages.Add.addAction 'Cancel', -> pages.List.display()\r\n\r\n\tpages.Del = new Page -> \r\n\t\t@addRow makeInput 'name',placeIndex,true\r\n\t\t@addRow makeInput 'lat',place().lat,true\r\n\t\t@addRow makeInput 'lng',place().lng,true\r\n\tpages.Del.addAction 'Delete', -> \r\n\t\tdelete places[placeIndex]\r\n\t\tstoreData()\r\n\t\tpages.List.display()\r\n\tpages.Del.addAction 'Cancel', -> pages.Nav.display()\r\n\r\n\tpages.Link = new Page -> \r\n\t\t@addRow makeDiv \"Click Copy and Mail #{placeIndex} and your current position to a friend.\"\r\n\t\t@addRow link = makeTextArea 'link'\r\n\t\tlinks = []\r\n\t\tlinks.push encodeURI \"#{LINK}?name=#{placeIndex}&lat=#{place().lat}&lng=#{place().lng}\" \r\n\t\tif track.length > 0\r\n\t\t\tcurr = _.last track\r\n\t\t\tlinks.push encodeURI \"#{LINK}?name=#{'Christer'}&lat=#{curr.lat}&lng=#{curr.lng}&timestamp=#{curr.timestamp}\"\r\n\t\tlink.value = links.join(\"\\n\") + logg.join(\"\\n\")\r\n\tpages.Link.addAction 'Copy', -> \r\n\t\tiosCopyToClipboard document.getElementById(\"link\")\r\n\t\tpages.Nav.display()\r\n\tpages.Link.addAction 'Cancel', -> \r\n\t\tpages.Nav.display()\r\n\r\n\tpages.Links = new Page -> \r\n\t\t@addRow makeDiv \"Click Copy and Mail all your points to a friend.\"\r\n\t\t@addRow link = makeTextArea 'link'\r\n\t\tlinks = []\r\n\t\tfor key,p of places\r\n\t\t\tlinks.push encodeURI \"#{LINK}?name=#{key}&lat=#{p.lat}&lng=#{p.lng}\" \r\n\t\tlink.value = links.join \"\\n\"\r\n\tpages.Links.addAction 'Copy', -> \r\n\t\tiosCopyToClipboard document.getElementById(\"link\")\r\n\t\tpages.List.display()\r\n\tpages.Links.addAction 'Cancel', -> \r\n\t\tpages.List.display()\r\n\r\n\t# startsida:\r\n\tpages.List.display()\r\n\r\n```\r\n// fungerar på iPad: iOS 11.2.2\r\n// fungerar ej på 4s iOS 9.3.5. Workaround: Låt användaren utföra kopieringen.\r\n// https://stackoverflow.com/questions/34045777/copy-to-clipboard-using-javascript-in-ios\r\nfunction iosCopyToClipboard(el) {\r\n    var oldContentEditable = el.contentEditable,\r\n        oldReadOnly = el.readOnly,\r\n        range = document.createRange();\r\n\r\n    el.contenteditable = true;\r\n    el.readonly = false;\r\n    range.selectNodeContents(el);\r\n\r\n    var s = window.getSelection();\r\n    s.removeAllRanges();\r\n    s.addRange(range);\r\n\r\n    el.setSelectionRange(0, 999999); // A big number, to cover anything that could be inside the element.\r\n\r\n    el.contentEditable = oldContentEditable;\r\n    el.readOnly = oldReadOnly;\r\n\r\n\t\t// document.execCommand('copy');\r\n}\r\n```"
  ]
}