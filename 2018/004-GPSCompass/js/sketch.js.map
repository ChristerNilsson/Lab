{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "places = []\r\nplaces.push {name:'Bron S Söderbysjön',lat:59.279155, lng:18.149318}\r\nplaces.push {name:'Golfklubben',       lat:59.284052, lng:18.145925}\r\nplaces.push {name:'Sushi Bagarmossen', lat:59.277560, lng:18.132739}\r\nplaces.push {name:'Hem',               lat:59.265205, lng:18.132735}\r\nplaces.push {name:'Hellasgården',      lat:59.289813, lng:18.160577}\r\nplaces.push {name:'Ulvsjön, Udden',    lat:59.277103, lng:18.164897}\r\nplaceIndex = 0\r\nplace = places[placeIndex]\r\n\r\nw = null\r\nh = null\r\ntrack = []\r\nbearing = 0\r\nheading_12 = 0\r\nlastObservation = 0\r\np1 = null\r\n\r\ntexts = ['','','','','','','','','','','','']\r\n\r\nlocationUpdate = (position) ->\r\n\tp1 = \r\n\t\tlat : position.coords.latitude\r\n\t\tlng : position.coords.longitude\r\n\t\taccuracy : position.coords.accuracy\r\n\t\ttimestamp : position.timestamp/1000\r\n\r\n\ttrack.push p1\r\n\r\n\theading_12 = calcHeading p1,place\r\n\tlastObservation = millis()\r\n\r\n\ttexts[0] = precisionRound place.lat,6\r\n\ttexts[1] = precisionRound place.lng,6\r\n\ttexts[3] = \"#{track.length}\"  \r\n\ttexts[6] = \"#{Math.round p1.accuracy} m\"\r\n\t#texts[8] = \"#{Math.round heading_12}°\"\r\n\t#texts[3] = 'nospeed' #p1.spd\r\n\t#texts[4] = p1.timestamp\r\n\ttexts[10] = \"#{Math.round distance_on_geoid p1,place} m\"\r\n\r\n\tif track.length >= 2 \r\n\t\tp0 = track[track.length-2]\r\n\t\tdt = p1.timestamp-p0.timestamp\r\n\t\tds = distance_on_geoid p0,p1\r\n\t\ttexts[2] = \"#{precisionRound dt,3} s\"\r\n\t\ttexts[4] = \"#{Math.round ds} m\"\r\n\t\ttexts[5] = \"#{precisionRound ds/dt,1} m/s\"\r\n\t\ttexts[9] = \"#{Math.round calcHeading p0,p1}°\"\r\n\r\nlocationUpdateFail = (error) ->\r\n\ttexts[0] = \"n/a\"\r\n\ttexts[1] = \"n/a\"\r\n\r\nnavigator.geolocation.watchPosition locationUpdate, locationUpdateFail, \r\n\tenableHighAccuracy: true\r\n\tmaximumAge: 30000\r\n\ttimeout: 27000\r\n\r\ncalcDelta = (delta) ->\r\n\tif delta < -180 then delta += 360\r\n\tif delta > +180 then delta -= 360\r\n\tdelta\r\n\r\ncalcColor = (delta) ->\r\n\twhite = color 255,255,255\r\n\tred   = color 255,0,0\r\n\tgreen = color 0,255,0\r\n\tif delta < 0 then lerpColor(white, red, -delta/180).levels\r\n\telse lerpColor(white, green, delta/180).levels\r\n\r\nsetup = ->\r\n\tcreateCanvas windowWidth,windowHeight\r\n\tw = windowWidth\r\n\th = windowHeight\t\r\n\r\n\twindow.addEventListener \"deviceorientation\", (event) ->\r\n\t\tbearing = event.alpha\r\n\r\n\t\tif typeof event.webkitCompassHeading != \"undefined\"\r\n\t\t\tbearing = event.webkitCompassHeading # iOS non-standard\r\n\r\n\t\ttexts[7] = \"#{Math.round (millis() - lastObservation)/1000} s\"\r\n\t\ttexts[9] = \"#{Math.round bearing}°\"\r\n\t\tdelta = calcDelta heading_12-bearing\r\n\t\ttexts[11] = \"#{Math.round delta}°\"\r\n\r\n\tassert [255,255,255,255], calcColor 0\r\n\tassert [255,128,128,255], calcColor -90\r\n\tassert [255,0,0,255], calcColor -180\r\n\tassert [128,255,128,255], calcColor 90\r\n\tassert [0,255,0,255], calcColor 180\r\n\r\ndrawHouse = (radius) ->\r\n\tfc 1\r\n\tsc()\r\n\t#textSize 50\r\n\ttextAlign CENTER,CENTER\r\n\r\n\tfor i in range 4\r\n\t\tpush()\r\n\t\ttranslate 0,1.3*radius\r\n\t\trd 180\r\n\t\ttext \"SWNE\"[i],0,0\r\n\t\tpop()\r\n\t\trd 90\t\r\n\tpush()\r\n\tsc 0\r\n\tsw 1\r\n\tfc 0.5\r\n\trect -15,-0.9*radius,30,1.9*radius\r\n\t#sc 1,0,0\r\n\t#fc 1,0,0\r\n\ttriangle -25,-0.9*radius,0,-1.1*radius,25,-0.9*radius\r\n\tpop()\r\n\r\ndrawNeedle = (radius) ->\r\n\ttry\r\n\t\trd -bearing\r\n\t\tsc 1\r\n\t\tsw 13 \r\n\t\tline 0,0,0,0.95*radius\r\n\t\tsc 1,0,0\r\n\t\tline 0,0,0,-0.95*radius\r\n\r\ndrawCompass = ->\r\n\tradius = 0.25 * w \r\n\tdelta = calcDelta heading_12-bearing\r\n\tfill calcColor delta\r\n\tsw 5\r\n\tsc 1\r\n\tpush()\r\n\ttranslate 0.5*w,0.7*h\r\n\tcircle 0,0,1.1*radius\r\n\tpush()\r\n\r\n\trd -heading_12\r\n\tdrawHouse radius\r\n\tpop()\r\n\ttextSize 0.08*h\r\n\tfc 1\r\n\tsc()\r\n\ttext texts[10],0,-1.6*radius\r\n\ttext \"#{Math.round heading_12}°\",0,-1.2*radius\r\n\tdrawNeedle radius\r\n\tpop()\r\n\r\ndrawTexts = ->\r\n\tfc 0.5\r\n\td = h/12\r\n\tsc 0.5\r\n\tsw 1\r\n\ttextSize 0.08*h\r\n\tfor t,i in texts\r\n\t\tx = i%2 * w\r\n\t\tif i%2==0 then textAlign LEFT else textAlign RIGHT\r\n\t\ty = d*Math.floor i/2\r\n\t\ttext t,x,2*d+y\r\n\ttextAlign CENTER\r\n\ttext place.name,w/2,d\r\n\r\ndraw = ->\r\n\tbg 0\r\n\tdrawCompass()\r\n\tdrawTexts()\r\n\r\nmousePressed = ->\r\n\tif mouseY > h/2 and track.length>0\r\n\t\tp = track[track.length-1]\r\n\t\tplaces.push \r\n\t\t\tname: prettyDate new Date()\r\n\t\t\tlat: p.lat\r\n\t\t\tlng: p.lng\r\n\t\tplaceIndex = places.length-1\r\n\r\n\telse if mouseX > w/2 then placeIndex++\r\n\telse placeIndex--\r\n\tplaceIndex %%= places.length\r\n\tplace = places[placeIndex]\r\n\ttexts = ['','','','','','','','','','','','']\r\n\ttexts[0] = precisionRound place.lat,6\r\n\ttexts[1] = precisionRound place.lng,6"
  ]
}