// Generated by CoffeeScript 2.3.2
var Board, M, N, WINSIZE, getRandom;

M = 6; // antal rader

N = 7; // antal kolumner

WINSIZE = 4;

getRandom = function(b) {
  return int(b * Math.random());
};

Board = class Board {
  constructor(moves = '') {
    var digit, j, len;
    this.clear();
    for (j = 0, len = moves.length; j < len; j++) {
      digit = moves[j];
      this.move(parseInt(digit));
    }
  }

  copy() {
    var b;
    b = new Board();
    b.board = this.board.slice();
    b.moves = this.moves.slice();
    return b;
  }

  rand() {
    var b, i;
    return _.sample((function() {
      var j, len, ref, results;
      ref = this.board;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        b = ref[i];
        if (b.length < M) {
          results.push(i);
        }
      }
      return results;
    }).call(this));
  }

  clear() {
    var i;
    this.moves = [];
    return this.board = (function() {
      var j, len, ref, results;
      ref = range(N);
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        i = ref[j];
        results.push('');
      }
      return results;
    })();
  }

  move(m) {
    this.board[m] += this.nextMarker();
    return this.moves.push(m);
  }

  nextBoard(play) {
    var b;
    b = this.copy();
    b.move(play);
    return b;
  }

  undo() {
    var index;
    index = this.moves.pop();
    return this.board[index] = this.board[index].slice(0, this.board[index].length - 1);
  }

  lastMarker() {
    return 'OX'[this.moves.length % 2];
  }

  nextMarker() {
    return 'XO'[this.moves.length % 2];
  }

  calc(dr, dc) {
    var col, helper, marker, row;
    helper = () => {
      var c, r, res;
      r = row + dr;
      c = col + dc;
      res = 0;
      while ((0 <= r && r < M) && (0 <= c && c < N) && r < this.board[c].length && this.board[c][r] === marker) {
        res++;
        //console.log 'helper',row,col,r,c,res
        r += dr;
        c += dc;
      }
      return res;
    };
    marker = this.lastMarker();
    col = _.last(this.moves);
    row = this.board[col].length - 1;
    return 1 + helper() >= WINSIZE;
  }

  done() {
    var dc, dr, j, k, len, len1, ref, ref1;
    if (this.moves.length <= 2 * (WINSIZE - 1)) {
      return false;
    }
    ref = [-1, 0, 1];
    for (j = 0, len = ref.length; j < len; j++) {
      dr = ref[j];
      ref1 = [-1, 0, 1];
      for (k = 0, len1 = ref1.length; k < len1; k++) {
        dc = ref1[k];
        if (dr !== 0 || dc !== 0) {
          if (this.calc(dr, dc)) {
            return true;
          }
        }
      }
    }
    return false;
  }

  draw() {
    return this.moves.length === M * N; // OBS! Kan vara vinst!
  }

  legalPlays() {
    var col, j, len, ref, results;
    ref = range(N);
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      col = ref[j];
      if (this.board[col].length < M) {
        results.push(col);
      }
    }
    return results;
  }

  winner() {
    if (this.draw()) {
      return 0.5;
    }
    if (this.done()) {
      return [1, 0][this.moves.length % 2];
    }
    return null;
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9hcmQuanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcYm9hcmQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLEtBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLE9BQUEsRUFBQTs7QUFBQSxDQUFBLEdBQUksRUFBSjs7QUFDQSxDQUFBLEdBQUksRUFESjs7QUFFQSxPQUFBLEdBQVU7O0FBRVYsU0FBQSxHQUFZLFFBQUEsQ0FBQyxDQUFELENBQUE7U0FBTyxHQUFBLENBQUksQ0FBQSxHQUFJLElBQUksQ0FBQyxNQUFMLENBQUEsQ0FBUjtBQUFQOztBQUVOLFFBQU4sTUFBQSxNQUFBO0VBRUMsV0FBYyxDQUFDLFFBQU0sRUFBUCxDQUFBO0FBQ2IsUUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBO0lBQUEsSUFBQyxDQUFBLEtBQUQsQ0FBQTtJQUNBLEtBQUEsdUNBQUE7O01BQ0MsSUFBQyxDQUFBLElBQUQsQ0FBTSxRQUFBLENBQVMsS0FBVCxDQUFOO0lBREQ7RUFGYTs7RUFLZCxJQUFPLENBQUEsQ0FBQTtBQUNOLFFBQUE7SUFBQSxDQUFBLEdBQUksSUFBSSxLQUFKLENBQUE7SUFDSixDQUFDLENBQUMsS0FBRixHQUFVLElBQUMsQ0FBQSxLQUFLLENBQUMsS0FBUCxDQUFBO0lBQ1YsQ0FBQyxDQUFDLEtBQUYsR0FBVSxJQUFDLENBQUEsS0FBSyxDQUFDLEtBQVAsQ0FBQTtXQUNWO0VBSk07O0VBTVAsSUFBTyxDQUFBLENBQUE7QUFBRyxRQUFBLENBQUEsRUFBQTtXQUFBLENBQUMsQ0FBQyxNQUFGOztBQUFZO0FBQUE7TUFBQSxLQUFBLDZDQUFBOztZQUF1QixDQUFDLENBQUMsTUFBRixHQUFXO3VCQUFwQzs7TUFBRSxDQUFBOztpQkFBWjtFQUFIOztFQUVQLEtBQVEsQ0FBQSxDQUFBO0FBQ1AsUUFBQTtJQUFBLElBQUMsQ0FBQSxLQUFELEdBQVM7V0FDVCxJQUFDLENBQUEsS0FBRDs7QUFBYTtBQUFBO01B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QTs7RUFFUCxVQUFhLENBQUEsQ0FBQTtBQUFHLFFBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxFQUFBO0FBQUs7QUFBQTtJQUFBLEtBQUEscUNBQUE7O1VBQXdCLElBQUMsQ0FBQSxLQUFNLENBQUEsR0FBQSxDQUFJLENBQUMsTUFBWixHQUFxQjtxQkFBakQ7O0lBQUksQ0FBQTs7RUFBUjs7RUFFYixNQUFTLENBQUEsQ0FBQTtJQUNSLElBQUcsSUFBQyxDQUFBLElBQUQsQ0FBQSxDQUFIO0FBQWdCLGFBQU8sSUFBdkI7O0lBQ0EsSUFBRyxJQUFDLENBQUEsSUFBRCxDQUFBLENBQUg7QUFBZ0IsYUFBTyxDQUFDLENBQUQsRUFBRyxDQUFILENBQU0sQ0FBQSxJQUFDLENBQUEsS0FBSyxDQUFDLE1BQVAsR0FBZ0IsQ0FBaEIsRUFBN0I7O1dBQ0E7RUFIUTs7QUEvRFYiLCJzb3VyY2VzQ29udGVudCI6WyJNID0gNiAgIyBhbnRhbCByYWRlclxyXG5OID0gNyAgIyBhbnRhbCBrb2x1bW5lclxyXG5XSU5TSVpFID0gNFxyXG5cclxuZ2V0UmFuZG9tID0gKGIpIC0+IGludCBiICogTWF0aC5yYW5kb20oKVxyXG5cclxuY2xhc3MgQm9hcmRcclxuXHJcblx0Y29uc3RydWN0b3IgOiAobW92ZXM9JycpIC0+IFxyXG5cdFx0QGNsZWFyKClcclxuXHRcdGZvciBkaWdpdCBpbiBtb3Zlc1xyXG5cdFx0XHRAbW92ZSBwYXJzZUludCBkaWdpdFxyXG4gXHJcblx0Y29weSA6IC0+XHJcblx0XHRiID0gbmV3IEJvYXJkKClcclxuXHRcdGIuYm9hcmQgPSBAYm9hcmQuc2xpY2UoKSBcclxuXHRcdGIubW92ZXMgPSBAbW92ZXMuc2xpY2UoKVxyXG5cdFx0YlxyXG5cclxuXHRyYW5kIDogLT4gXy5zYW1wbGUgKGkgZm9yIGIsaSBpbiBAYm9hcmQgd2hlbiBiLmxlbmd0aCA8IE0pXHJcblxyXG5cdGNsZWFyIDogLT5cclxuXHRcdEBtb3ZlcyA9IFtdXHJcblx0XHRAYm9hcmQgPSAoJycgZm9yIGkgaW4gcmFuZ2UgTilcclxuXHJcblx0bW92ZSA6IChtKSAtPlxyXG5cdFx0QGJvYXJkW21dICs9IEBuZXh0TWFya2VyKClcclxuXHRcdEBtb3Zlcy5wdXNoIG1cclxuXHJcblx0bmV4dEJvYXJkIDogKHBsYXkpIC0+XHJcblx0XHRiID0gQGNvcHkoKVxyXG5cdFx0Yi5tb3ZlIHBsYXlcclxuXHRcdGJcclxuXHJcblx0dW5kbyA6IC0+IFxyXG5cdFx0aW5kZXggPSBAbW92ZXMucG9wKCkgXHJcblx0XHRAYm9hcmRbaW5kZXhdID0gQGJvYXJkW2luZGV4XS5zbGljZSAwLCBAYm9hcmRbaW5kZXhdLmxlbmd0aC0xXHJcblxyXG5cdGxhc3RNYXJrZXIgOiAtPiAnT1gnW0Btb3Zlcy5sZW5ndGggJSAyXVxyXG5cdG5leHRNYXJrZXIgOiAtPiAnWE8nW0Btb3Zlcy5sZW5ndGggJSAyXVxyXG5cclxuXHRjYWxjIDogKGRyLGRjKSAtPlxyXG5cdFx0aGVscGVyID0gPT5cclxuXHRcdFx0ciA9IHJvdyArIGRyIFxyXG5cdFx0XHRjID0gY29sICsgZGNcclxuXHRcdFx0cmVzID0gMFxyXG5cdFx0XHR3aGlsZSAwIDw9IHIgPCBNIGFuZCAwIDw9IGMgPCBOIGFuZCByIDwgQGJvYXJkW2NdLmxlbmd0aCBhbmQgQGJvYXJkW2NdW3JdID09IG1hcmtlclxyXG5cdFx0XHRcdHJlcysrXHJcblx0XHRcdFx0I2NvbnNvbGUubG9nICdoZWxwZXInLHJvdyxjb2wscixjLHJlc1xyXG5cdFx0XHRcdHIgKz0gZHJcclxuXHRcdFx0XHRjICs9IGRjXHJcblx0XHRcdHJlc1xyXG5cdFx0bWFya2VyID0gQGxhc3RNYXJrZXIoKVxyXG5cdFx0Y29sID0gXy5sYXN0IEBtb3Zlc1xyXG5cdFx0cm93ID0gQGJvYXJkW2NvbF0ubGVuZ3RoLTFcclxuXHRcdDEgKyBoZWxwZXIoKSA+PSBXSU5TSVpFXHJcblxyXG5cdGRvbmUgOiAtPlxyXG5cdFx0aWYgQG1vdmVzLmxlbmd0aCA8PSAyICogKFdJTlNJWkUtMSkgdGhlbiByZXR1cm4gZmFsc2VcclxuXHRcdGZvciBkciBpbiBbLTEsMCwxXVxyXG5cdFx0XHRmb3IgZGMgaW4gWy0xLDAsMV1cclxuXHRcdFx0XHRpZiBkciE9MCBvciBkYyE9MFxyXG5cdFx0XHRcdFx0aWYgQGNhbGMgZHIsZGMgdGhlbiByZXR1cm4gdHJ1ZSBcclxuXHRcdGZhbHNlXHJcblxyXG5cdGRyYXcgOiAtPiBAbW92ZXMubGVuZ3RoID09IE0qTiAjIE9CUyEgS2FuIHZhcmEgdmluc3QhXHJcblxyXG5cdGxlZ2FsUGxheXMgOiAtPiAoY29sIGZvciBjb2wgaW4gcmFuZ2UgTiB3aGVuIEBib2FyZFtjb2xdLmxlbmd0aCA8IE0pXHJcblxyXG5cdHdpbm5lciA6IC0+IFxyXG5cdFx0aWYgQGRyYXcoKSB0aGVuIHJldHVybiAwLjVcclxuXHRcdGlmIEBkb25lKCkgdGhlbiByZXR1cm4gWzEsMF1bQG1vdmVzLmxlbmd0aCAlIDJdIFxyXG5cdFx0bnVsbFxyXG5cdCJdfQ==
//# sourceURL=C:\Lab\2018\090-Connect4-MCTS\coffee\board.coffee