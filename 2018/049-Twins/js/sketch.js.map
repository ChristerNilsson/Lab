{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "SIZE = 12\r\nTILE = 60\r\nFREE = -1\r\nCOLORS = null\r\nKEY = '049-Twins'\r\n\r\nlevel = null\r\nmaxLevel=null\r\nnumbers = null\r\n\r\nb = null\r\nselected = []\r\nmessage = ''\r\nbuttons = []\r\npath = []\r\npathTimestamp = null\r\nhearts = null\r\n\r\nclass Hearts\r\n\tconstructor : (@x,@y,@count=9,@maximum=9) -> \r\n\tdraw : ->\r\n\t\tfor i in range @maximum\r\n\t\t\tx = @x + 25*i\r\n\t\t\tif i < @count\r\n\t\t\t\tfc 1,0,0\r\n\t\t\telse\r\n\t\t\t\tfc 0.5\r\n\t\t\ttriangle x-11,@y, x+11,@y, x,@y+15 \r\n\t\t\tcircle x-5,@y,5\r\n\t\t\tcircle x+5,@y,5\r\n\r\nclass Button\r\n\tconstructor : (@x,@y,@txt,@click) -> @r=50\r\n\tinside : (x,y) -> @r > dist @x,@y,x,y\r\n\tdraw : ->\r\n\t\tfc 0.5\r\n\t\tsc()\r\n\t\tcircle @x,@y,@r\r\n\t\tfc 0\r\n\t\ttextSize 30\r\n\t\ttext @txt,@x,@y\r\n\r\nnewGame = (n) ->\r\n\tlevel = constrain n,2,maxLevel\r\n\tmakeGame()\r\n\r\nsaveStorage = -> localStorage[KEY] = maxLevel\r\nloadStorage = ->\r\n\tif KEY of localStorage \r\n\t\tmaxLevel = parseInt localStorage[KEY]\r\n\t\tprint maxLevel\r\n\telse\r\n\t\tmaxLevel = 2\r\n\r\nsetup = ->\r\n\tcreateCanvas 30+TILE*SIZE+30,100+TILE*SIZE+TILE\r\n\trectMode CENTER\r\n\tmakeColors()\r\n\tloadStorage()\r\n\tlevel = maxLevel\r\n\tbuttons.push new Button 80,65,'-', -> newGame level-1\r\n\tbuttons.push new Button 180,65,level, -> newGame level\r\n\tbuttons.push new Button 280,65,'+', -> newGame level+1\r\n\thearts = new Hearts width-240,110\r\n\tmakeGame()\r\n\t#assert true,  setBoard 41,true,2,5,9,8,[\"\",\"\",\"\",\" 25\",\" 22 35 21       7\",\" 11 10 15\",\"          5\",\"  19 18   29\",\"   33      30\"]\r\n\t#assert false, setBoard 41,true,2,5,3,8,[\"\",\"\",\"\",\" 25\",\" 22 35 21       7\",\" 11 10 15\",\"          5\",\"  19 18   29\",\"   33      30\"]\r\n\t#assert false, setBoard 21,false,2,8,6,8,[\"\",\"    17\",\"\",\"\",\"        11\",\"  7\",\"     4   7\",\"  5    7  15 10\",\"  17   5 3 18 16 2 12\",\"       8 13 15 9\",\"  10  3    13 13\"]\r\n\t#assert true,  setBoard 21,false,2,2,7,2,[\"\",\"        20  5\",\" 18 1  17   19 16\",\"  4 9 10  14 15 3\",\"     9\"]\r\n\r\nmybrightness = (s) ->\r\n\tres = 0\r\n\tfor ch in s\r\n\t\tres += \"0123456789abcdef#\".indexOf ch\r\n\tres\r\n\r\nmakeColors = ->\r\n\tCOLORS = []\r\n\tfor i in \"05af\"\r\n\t\tfor j in \"05af\"\r\n\t\t\tfor k in \"05af\"\r\n\t\t\t\tCOLORS.push \"#\"+i+j+k\r\n\tCOLORS = _.without COLORS, \"#000\", \"#005\", \"#00a\"\r\n\tCOLORS.sort (a,b) -> mybrightness(b) - mybrightness(a)\r\n\r\nmakeGame = ->\r\n\tcandidates = []\r\n\thearts.count = 9\r\n\tnumbers = 100\r\n\tfor i in range 50\r\n\t\tcandidates.push i % level\r\n\t\tcandidates.push level-1 - i % level\r\n\tcandidates = _.shuffle candidates\r\n\r\n\tb = new Array SIZE\r\n\tfor i in range SIZE\r\n\t\tb[i] = new Array SIZE\r\n\t\tfor j in range SIZE\r\n\t\t\tif i in [0,SIZE-1] or j in [0,SIZE-1] then b[i][j] = FREE\r\n\t\t\telse b[i][j] = candidates.pop()\r\n\r\ndraw = ->\r\n\tbg 0.25\r\n\tsw 1\r\n\tbuttons[1].txt = level-1\r\n\r\n\tfor button in buttons\r\n\t\tbutton.draw()\r\n\thearts.draw()\r\n\r\n\ttextSize 0.8 * TILE\r\n\ttranslate TILE,TILE+100\r\n\ttextAlign CENTER,CENTER\r\n\tfc 1\r\n\tsc 0\r\n\tfor i in range SIZE\r\n\t\tfor j in range SIZE\r\n\t\t\tfc 0\r\n\t\t\tsc 1\r\n\t\t\trect TILE*i,TILE*j,TILE,TILE\r\n\t\t\tcell = b[i][j]\r\n\t\t\tif cell >= 0 \r\n\t\t\t\tfill COLORS[cell%%COLORS.length]\r\n\t\t\t\tsc()\r\n\t\t\t\ttext b[i][j],TILE*i,TILE*j\r\n\tfor [i,j] in selected\r\n\t\tfc 1,1,0,0.5\r\n\t\tsc()\r\n\t\tcircle TILE*i,TILE*j,TILE/2-3\r\n\tdrawPath()\r\n\r\nwithin = (i,j) -> 0 <= i < SIZE and 0 <= j < SIZE\r\n\r\nmousePressed = ->\r\n\tfor button in buttons\r\n\t\tif button.inside mouseX,mouseY then button.click()\r\n\t[i,j] = [(mouseX-TILE/2)//TILE,(mouseY-100-TILE/2)//TILE]\r\n\tif not within i,j then return\r\n\tif selected.length == 0\r\n\t\tif b[i][j] != FREE then selected.push [i,j]\r\n\telse\r\n\t\t[i1,j1] = selected[0]\r\n\t\tif i==i1 and j==j1 then return selected.pop()\r\n\t\tif b[i][j] + b[i1][j1] == level-1\r\n\t\t\tpath = legal false,i1,j1,i,j\r\n\t\t\tif path.length == 0\r\n\t\t\t\tpath = legal true,i1,j1,i,j\r\n\t\t\t\tif path.length == 0\r\n\t\t\t\t\thearts.count -= 2 # Punish two\r\n\t\t\t\telse\r\n\t\t\t\t\thearts.count -= 1 # Punish one\r\n\t\t\tb[i][j] = b[i1][j1] = FREE\r\n\t\t\tnumbers -= 2\r\n\t\t\tselected.pop()\r\n\t\t\tif numbers==0\r\n\t\t\t\tif level == maxLevel \r\n\t\t\t\t\tif hearts.count >= 0 \r\n\t\t\t\t\t\tmaxLevel+=1\r\n\t\t\t\t\t\tlevel+=1\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tmaxLevel-=1\r\n\t\t\t\t\t\tlevel-=1\r\n\t\t\t\tsaveStorage()\r\n\t\t\t\tnewGame level\r\n\t\t\telse\r\n\t\t\t\tif level == maxLevel \r\n\t\t\t\t\tif hearts.count < 0 \r\n\t\t\t\t\t\tmaxLevel-=1\r\n\t\t\t\t\t\tlevel-=1\r\n\t\t\t\t\t\tsaveStorage()\r\n\t\t\t\t\t\tnewGame level\r\n\r\nmakeMove = (wrap,x,y) -> if wrap then [x %% SIZE, y %% SIZE] else [x,y]\r\n\r\nmakePath = (wrap,reached,i,j) ->\r\n\tres = []\r\n\tkey = \"#{i},#{j}\"\r\n\t[turns0,i0,j0,indexes0] = reached[key]\r\n\t[i,j] = [i0,j0]\r\n\tres.push [i,j]\r\n\tpathTimestamp = millis()\r\n\tindexes0.reverse()\r\n\tfor index in indexes0\r\n\t\t[di,dj] = [[1,0],[-1,0],[0,1],[0,-1]][index]\r\n\t\t[i,j] = makeMove wrap,i+di,j+dj\r\n\t\tres.push [i,j]\r\n\tres\r\n\r\ndrawPath = ->\r\n\tif path.length == 0 then return \r\n\tsw 3\r\n\tsc 1,1,0\r\n\t[i1,j1] = path[0]\r\n\tfor [i2,j2] in path\r\n\t\tif 1 == dist i1,j1,i2,j2\r\n\t\t\tline TILE*i1,TILE*j1,TILE*i2,TILE*j2\r\n\t\t[i1,j1] = [i2,j2]\r\n\tif millis() > 1000 + pathTimestamp then path = []\r\n\r\n# A*\r\nlegal = (wrap,i0,j0,i1,j1) ->\r\n\tstart = [0,i0,j0,[]] # turns,x,y,move\r\n\tcands = []\r\n\tcands.push start\r\n\treached = {}\r\n\treached[[i0,j0]] = start\r\n\twhile cands.length > 0\r\n\t\tfront = cands\r\n\t\tfront.sort (a,b) -> a[0]-b[0]\r\n\t\tcands = []\r\n\t\tfor [turns0,x0,y0,indexes0] in front\r\n\t\t\tfor [dx,dy],index in [[-1,0],[1,0],[0,-1],[0,1]]\r\n\t\t\t\t[x,y] = makeMove wrap,x0+dx,y0+dy\r\n\t\t\t\tkey = \"#{x},#{y}\"\r\n\t\t\t\tturns = turns0\r\n\t\t\t\tif indexes0.length > 0 and index != _.last(indexes0) then turns++\r\n\t\t\t\tnext = [turns,x,y,indexes0.concat [index]]\r\n\t\t\t\tif x==i1 and y==j1 and turns<=2\r\n\t\t\t\t\treached[key] = next\r\n\t\t\t\t\treturn makePath wrap,reached,i1,j1\r\n\t\t\t\tif within x,y\r\n\t\t\t\t\tif b[x][y]==FREE\r\n\t\t\t\t\t\tif key not of reached or reached[key][0] >= next[0]\r\n\t\t\t\t\t\t\tif next[0] < 3\r\n\t\t\t\t\t\t\t\treached[key] = next\r\n\t\t\t\t\t\t\t\tcands.push next\r\n\t[]\r\n\r\n# setBoard = (n,w,i0,j0,i1,j1,arr) ->\r\n# \tlevel = n\r\n# \tfor j in range SIZE\r\n# \t\tb[j] = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]\r\n# \tfor row,j in arr\r\n# \t\tfor cell,i in row.split ' '\r\n# \t\t\tb[i][j] = if cell=='' then -1 else parseInt cell\r\n# \tlegal i0,j0,i1,j1\r\n"
  ]
}