{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# Internt används talen 1..100. Externt visas de som 0..99\r\n# Då ett tal plockats bort negeras det. Dessa visas gråa och förminskade.\r\n# Ramens celler innehåller 0.\r\n\r\nALFABET = \"abcdefghijklmnopqrstuvwxyz\"\r\nSIZE = 12\r\nTILE = 60\r\nFREE = 0\r\nCOLORS = '#fff #f00 #0f0 #ff0 #f0f #0ff #880 #f88 #088 #8f8'.split ' '\r\nKEY = '049-Twins'\r\n\r\nSize = null\r\nlevel = null\r\nmaxLevel=null\r\nnumbers = null\r\n\r\nb = null\r\nselected = []\r\nmessage = ''\r\nbuttons = []\r\npath = []\r\npathTimestamp = null\r\ndeathTimestamp = null\r\nhearts = null\r\nmilliseconds0 = null\r\nmilliseconds1 = null\r\nstate = 'halted' # 'running' 'halted'\r\ndelta = 0\r\nfound = null\r\nshowLittera = true \r\nshowShadow = true\r\nshowHint = false\r\nhints0 = []\r\nhints1 = []\r\nlatestPair = []\r\ncounter = {}\r\n\r\nclass Hearts\r\n\tconstructor : (@x,@y,@count=12,@maximum=12) -> \r\n\r\n\tdraw : ->\r\n\t\tfor i in range @maximum\r\n\t\t\tx = @x + 60*i\r\n\t\t\tif i < @count\r\n\t\t\t\t@drawHeart x,@y,10,1,0,0\r\n\t\t\telse\r\n\t\t\t\t@drawHeart x,@y,10,0.5,0.5,0.5\r\n\r\n\tdrawHeart : (x,y,n,r,g,b) ->\r\n\t\t\tfc r,g,b\r\n\t\t\tsc r,g,b\r\n\t\t\tsw n\r\n\t\t\tdx = 1.2*n\r\n\t\t\ty -= 0.8*n\r\n\t\t\ty1 = y+0.6*n\r\n\t\t\ty2 = y+2.2*n\r\n\t\t\tline x-dx,y1, x,y2\r\n\t\t\tline x+dx,y1, x,y2\r\n\t\t\tline x,y+0.5*n,x,y+2*n\r\n\t\t\tsc()\r\n\t\t\tcircle x-n,y,n\r\n\t\t\tcircle x+n,y,n\r\n\r\nclass Button\r\n\tconstructor : (@x,@y,@txt,@click) -> @r=24\r\n\tinside : (x,y) -> @r > dist @x,@y,x,y\r\n\tdraw : ->\r\n\t\tfc 0.5\r\n\t\tif level == maxLevel then sc 1 else sc()\r\n\t\tsw 2\r\n\t\tcircle @x,@y,@r\r\n\t\tfc 0\r\n\t\ttextSize 30\r\n\t\tsc()\r\n\t\ttext @txt,@x,@y\r\n\r\nnewGame = (n) ->\r\n\tif n in [0,maxLevel+1] then return \r\n\tlevel = constrain n,2,maxLevel\r\n\tmakeGame()\r\n\tshowMoves()\r\n\r\nsaveStorage = -> localStorage[KEY] = maxLevel\r\nloadStorage = -> maxLevel = if KEY of localStorage then parseInt localStorage[KEY] else maxLevel = 2\r\n\r\nsetup = ->\r\n\tcanvas = createCanvas TILE*(SIZE+1),TILE*(SIZE+2)\r\n\tcanvas.position 0,0 # hides text field used for clipboard copy.\r\n\r\n\trectMode CENTER\r\n\tloadStorage()\r\n\tlevel = maxLevel\r\n\tbuttons.push new Button 180+90,height-TILE/2,'<', -> newGame 1\r\n\tbuttons.push new Button 180+150,height-TILE/2,'-', -> newGame level-1\r\n\tbuttons.push new Button 180+210,height-TILE/2,level, -> \r\n\tbuttons.push new Button 180+270,height-TILE/2,'+', -> newGame level+1\r\n\tbuttons.push new Button 180+330,height-TILE/2,'>', -> newGame maxLevel\r\n\tbuttons.push new Button 720,height-TILE/2,'?', -> window.open 'https://github.com/ChristerNilsson/Lab/blob/master/2018/049-Twins/README.md#049-twins'\r\n\r\n\thearts = new Hearts 60,35\r\n\r\n\tif -1 != window.location.href.indexOf 'level'\r\n\t\turlGame()\r\n\telse\r\n\t\tmakeGame()\r\n\tshowMoves()\r\n\r\nurlGame = ->\r\n\tparams = getParameters()\r\n\tlevel = parseInt params.level\r\n\tb = JSON.parse params.b\r\n\tSize = 4+level//4 \r\n\tif Size>12 then Size=12\r\n\thearts.count   = constrain 1+level//8,0,12\r\n\thearts.maximum = constrain 1+level//8,0,12 \r\n\tnumbers = (Size-2)*(Size-2)\r\n\tif numbers%2==1 then numbers -= 1\r\n\tmilliseconds0 = millis()\r\n\tstate = 'running'\t\r\n\r\nmakeGame = ->\r\n\thints0 = []\r\n\thints1 = []\r\n\r\n\tlatestPair = []\r\n\r\n\tif level == maxLevel\r\n\t\tmaxLevel = constrain maxLevel+delta,2,100\r\n\tlevel = constrain level+delta,2,100\r\n\tdelta = 0\r\n\tsaveStorage()\r\n\r\n\tSize = 4+level//4 \r\n\tif Size>12 then Size=12\r\n\thearts.count   = constrain 1+level//8,0,12 \r\n\thearts.maximum = constrain 1+level//8,0,12 \r\n\r\n\tnumbers = (Size-2)*(Size-2)\r\n\tif numbers%2==1 then numbers -= 1\r\n\r\n\tcandidates = []\r\n\tfor i in range numbers/2\r\n\t\tcandidates.push 1 + i % level\r\n\t\tcandidates.push 1 + level-1 - i % level\r\n\tcandidates = _.shuffle candidates\r\n\r\n\tb = new Array Size\r\n\tfor i in range Size\r\n\t\tb[i] = new Array Size\r\n\t\tfor j in range Size\r\n\t\t\tif i in [0,Size-1] or j in [0,Size-1] then b[i][j] = FREE\r\n\t\t\telse \r\n\t\t\t\tif Size % 2 == 0\r\n\t\t\t\t\tb[i][j] = candidates.pop()\r\n\t\t\t\telse\r\n\t\t\t\t\tif i == Size//2 and j == Size//2\r\n\t\t\t\t\t\tb[i][j] = FREE\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tb[i][j] = candidates.pop()\r\n\tmilliseconds0 = millis()\r\n\tstate = 'running'\r\n\tlink = makeLink()\r\n\tcopyToClipboard link\r\n\tprint link \r\n\r\nmakeLink = -> \r\n\turl = window.location.href + '?'\r\n\tindex = url.indexOf '?'\r\n\turl = url.substring 0,index\r\n\turl += '?b=' + JSON.stringify b\r\n\turl += '&level=' + level\r\n\turl\r\n\r\ndrawRect = (i,j) ->\r\n\tfc 0\r\n\tsc 0.25\r\n\tsw 1\r\n\trect TILE*i,TILE*j,TILE,TILE\r\n\r\ndrawNumber = (cell,i,j) ->\r\n\tcell -= 1 \r\n\tsw 3\r\n\tc1 = COLORS[cell%%COLORS.length]\r\n\tc2 = COLORS[cell//COLORS.length]\r\n\tif c1==c2 then c1='#000'\r\n\tfill   c1\r\n\tstroke c2\r\n\ttext cell,TILE*i,TILE*j + if showHint then 10 else 0\r\n\r\ndrawHint  = (hints,r,g,b) -> \r\n\tif showHint \r\n\t\tsw 1\r\n\t\tfc r,g,b\r\n\t\tsc()\r\n\t\ttextSize 20\r\n\t\tfor [[i0,j0],[i1,j1]],index in hints\r\n\t\t\tdrawHintHelp ALFABET[index],i0,j0\r\n\t\t\tdrawHintHelp ALFABET[index],i1,j1\r\n\r\ndrawHintHelp = (cell,i,j) ->\r\n\t\tkey = \"#{i}-#{j}\"\r\n\t\tif key not of counter then counter[key] = 0\r\n\t\tdx = [-20,0,20][counter[key] %% 3]\r\n\t\tdy = [-20,0,20][counter[key] // 3]\r\n\t\ttext cell,TILE*i+dx,TILE*j+dy\r\n\t\tcounter[key]++\r\n\r\ndrawShadow = (i,j) ->\r\n\tif showShadow\r\n\t\tsw 3\r\n\t\tfill 48\r\n\t\tstroke 48 \r\n\t\tfor [x,y] in latestPair\r\n\t\t\tif i==x and j==y \r\n\t\t\t\ttext -b[i][j]-1, TILE*i,TILE*j\t\t\t\t\r\n\r\ndraw = ->\r\n\tbg 0.25\r\n\tsw 1\r\n\tbuttons[2].txt = level-1\r\n\r\n\tfor button in buttons\r\n\t\tbutton.draw()\r\n\thearts.draw()\r\n\r\n\ttextAlign CENTER,CENTER\r\n\ttextSize 0.8 * TILE\r\n\r\n\tpush()\r\n\ttranslate (width-TILE*Size)/2+TILE/2, (height-TILE*Size)/2+TILE/2 \r\n\tfc 1\r\n\tsc 0\r\n\tfor i in range Size\r\n\t\tfor j in range Size\r\n\t\t\tdrawRect i,j\r\n\t\t\tcell = b[i][j]\r\n\t\t\tif state == 'halted' \t\t\r\n\t\t\t\tif cell != FREE then drawNumber abs(cell),i,j\r\n\t\t\telse\r\n\t\t\t\tif cell > 0 then drawNumber cell,i,j\r\n\t\t\t\telse if cell != FREE then drawShadow i,j\r\n\t\t\tif i in [0,Size-1] or j in [0,Size-1] then drawLittera i,j\r\n\tfor [i,j] in selected\r\n\t\tfc 1,1,0,0.5\r\n\t\tsc()\r\n\t\tcircle TILE*i,TILE*j,TILE/2-3\r\n\tdrawPath()\r\n\r\n\tcounter = {}\r\n\r\n\tdrawHint hints0,0,1,0\r\n\tdrawHint hints1,1,0,0\r\n\r\n\tpop()\r\n\r\n\tif state=='halted'\r\n\t\tfc 1,1,0,0.5\r\n\t\tx = width/2 \r\n\t\ty = height/2 \r\n\t\tw = Size*TILE\r\n\t\th = Size*TILE\r\n\t\trect x,y,w,h\r\n\t\tms = round((milliseconds1-milliseconds0)/100)/10\r\n\t\tif ms > 0\r\n\t\t\ty = Size*TILE-10\r\n\t\t\tfc 1\r\n\t\t\tsc()\r\n\t\t\ttextSize 30\r\n\t\t\ttext ms,width-2.5*TILE,height-30\r\n\tif millis() < deathTimestamp\r\n\t\tx = width/2 \r\n\t\ty = height/2 \r\n\t\thearts.drawHeart x,y,Size*TILE/5,1,0,0\r\n\r\n\tdrawHints()\r\n\tdrawProgress()\r\n\r\ndrawHints = ->\r\n\tif hints0.length > 0 \r\n\t\tfc 0,1,0 \r\n\t\ttext '*', TILE, height - 0.3 * TILE\r\n\tif hints1.length > 0 \r\n\t\tfc 1,0,0\r\n\t\ttext '*', TILE, height - 0.3 * TILE\r\n\r\ndrawProgress = ->\r\n\tfc 1\r\n\tsc()\r\n\ttextSize 30\r\n\ttext numbers,2.5*TILE,height-0.5*TILE\r\n\r\ndrawLittera = (i,j) ->\r\n\tif showLittera\r\n\t\tpush()\r\n\t\ttextSize 32\r\n\t\tfc 0.25\r\n\t\tsc 0.25\r\n\t\tif j in [0,Size-1] and i < Size-1\r\n\t\t\ttext ' abcdefghik '[i],TILE*i,TILE*j\r\n\t\telse if i in [0,Size-1] and 0<j<Size-1\r\n\t\t\ttext Size-1-j,TILE*i,TILE*j\r\n\t\tpop()\r\n\r\nwithin = (i,j) -> 0 <= i < Size and 0 <= j < Size\r\n\r\nkeyPressed = -> if key == 'H' then showHint = not showHint\r\n\r\nmousePressed = ->\r\n\tif state=='halted' \r\n\t\tnewGame level\r\n\t\treturn\r\n\tfor button in buttons\r\n\t\tif button.inside mouseX,mouseY then button.click()\r\n\r\n\tx = mouseX - (width-TILE*Size)/2 \r\n\ty = mouseY - (height-TILE*Size)/2 \r\n\t[i,j] = [x//TILE,y//TILE]\r\n\tif not within i,j then return\r\n\r\n\tif i in [0,Size-1] or j in [0,Size-1] \r\n\t\tshowLittera = not showLittera\r\n\t\treturn\r\n\r\n\tif b[i][j] < 0\r\n\t\tshowShadow = not showShadow \r\n\t\treturn\r\n\r\n\tif selected.length == 0\r\n\t\tif b[i][j] > 0 then selected.push [i,j]\r\n\telse\r\n\t\t[i1,j1] = selected[0]\r\n\t\tif i==i1 and j==j1 then return selected.pop()\r\n\t\tif b[i][j]-1 + b[i1][j1]-1 != level-1\r\n\t\t\thearts.count -= 1 # Punish one, wrong sum\r\n\t\t\tdeathTimestamp = 200 + millis()\r\n\t\t\tselected.pop()\r\n\t\telse\r\n\t\t\tpath = legal false,i1,j1,i,j\r\n\t\t\tif path.length == 0\r\n\t\t\t\tpath = legal true,i1,j1,i,j\r\n\t\t\t\tif path.length == 0\r\n\t\t\t\t\thearts.count -= 2 # Punish two, anything goes\r\n\t\t\t\telse\r\n\t\t\t\t\thearts.count -= 1 # Punish one, wrap\r\n\t\t\t\tdeathTimestamp = 200 + millis()\r\n\t\t\tlatestPair = [[i,j],[i1,j1]]\r\n\t\t\tb[i][j] = -b[i][j] \r\n\t\t\tb[i1][j1] = -b[i1][j1] \r\n\t\t\tnumbers -= 2\r\n\t\t\tselected.pop()\r\n\t\t\tif numbers==0\r\n\t\t\t\tmilliseconds1 = millis()\r\n\t\t\t\tstate = 'halted'\r\n\t\t\t\tif hearts.count >= 0 then delta = 1 else delta = -1\r\n\t\t\telse\r\n\t\t\t\tif level == maxLevel \r\n\t\t\t\t\tif hearts.count < 0 \r\n\t\t\t\t\t\tstate = 'halted'\r\n\t\t\t\t\t\tdelta = -1\r\n\tshowMoves()\r\n\r\nmakeMove = (wrap,x,y) -> if wrap then [x %% Size, y %% Size] else [x,y]\r\n\r\nmakePath = (wrap,reached,i,j) ->\r\n\tres = []\r\n\tkey = \"#{i},#{j}\"\r\n\t[turns0,i0,j0,indexes0] = reached[key]\r\n\t[i,j] = [i0,j0]\r\n\tres.push [i,j]\r\n\tpathTimestamp = millis()\r\n\tindexes0.reverse()\r\n\tfor index in indexes0\r\n\t\t[di,dj] = [[1,0],[-1,0],[0,1],[0,-1]][index]\r\n\t\t[i,j] = makeMove wrap,i+di,j+dj\r\n\t\tres.push [i,j]\r\n\tres\r\n\r\ndrawPath = ->\r\n\tif path.length == 0 then return \r\n\tsw 3\r\n\tsc 1,1,0\r\n\t[i1,j1] = path[0]\r\n\tfor [i2,j2] in path\r\n\t\tif 1 == dist i1,j1,i2,j2\r\n\t\t\tline TILE*i1,TILE*j1,TILE*i2,TILE*j2\r\n\t\t[i1,j1] = [i2,j2]\r\n\tif millis() > 500 + pathTimestamp then path = []\r\n\r\n# A*\r\nlegal = (wrap,i0,j0,i1,j1) ->\r\n\tstart = [0,i0,j0,[]] # turns,x,y,move\r\n\tcands = []\r\n\tcands.push start\r\n\treached = {}\r\n\treached[[i0,j0]] = start\r\n\twhile cands.length > 0\r\n\t\tfront = cands\r\n\t\tfront.sort (a,b) -> a[0]-b[0]\r\n\t\tcands = []\r\n\t\tfor [turns0,x0,y0,indexes0] in front\r\n\t\t\tfor [dx,dy],index in [[-1,0],[1,0],[0,-1],[0,1]]\r\n\t\t\t\t[x,y] = makeMove wrap,x0+dx,y0+dy\r\n\t\t\t\tkey = \"#{x},#{y}\"\r\n\t\t\t\tturns = turns0\r\n\t\t\t\tif indexes0.length > 0 and index != _.last(indexes0) then turns++\r\n\t\t\t\tnext = [turns,x,y,indexes0.concat [index]]\r\n\t\t\t\tif x==i1 and y==j1 and turns<=2\r\n\t\t\t\t\treached[key] = next\r\n\t\t\t\t\treturn makePath wrap,reached,i1,j1\r\n\t\t\t\tif within x,y\r\n\t\t\t\t\tif b[x][y] <= 0\r\n\t\t\t\t\t\tif key not of reached or reached[key][0] >= next[0]\r\n\t\t\t\t\t\t\tif next[0] < 3\r\n\t\t\t\t\t\t\t\treached[key] = next\r\n\t\t\t\t\t\t\t\tcands.push next\r\n\t[]\r\n\r\ncopyToClipboard = (txt) ->\r\n\tcopyText = document.getElementById \"myClipboard\"\r\n\tcopyText.value = txt \r\n\tcopyText.select()\r\n\tdocument.execCommand \"copy\"\r\n\r\nshowMoves = -> \r\n\thints0 = showMoves1 false\r\n\thints1 = if hints0.length > 0 then [] else showMoves1 true\r\n\r\nshowMoves1 = (wrap) ->\r\n\tres = []\r\n\tfor i0 in range 1,Size-1\r\n\t\tfor j0 in range 1,Size-1\r\n\t\t\tif b[i0][j0] > 0 \r\n\t\t\t\tfor i1 in range 1,Size-1\r\n\t\t\t\t\tfor j1 in range 1,Size-1\r\n\t\t\t\t\t\tif b[i1][j1] > 0 \r\n\t\t\t\t\t\t\tif b[i0][j0]-1 + b[i1][j1]-1 == level-1\r\n\t\t\t\t\t\t\t\tif b[i0][j0] <= b[i1][j1] and (i0!=i1 or j0!=j1)\r\n\t\t\t\t\t\t\t\t\tp = legal wrap,i0,j0,i1,j1 \r\n\t\t\t\t\t\t\t\t\tif p.length > 0\r\n\t\t\t\t\t\t\t\t\t\tok = true\r\n\t\t\t\t\t\t\t\t\t\tp0 = [i0,j0]\r\n\t\t\t\t\t\t\t\t\t\tp1 = [i1,j1]\r\n\t\t\t\t\t\t\t\t\t\tfor [q0,q1] in res\r\n\t\t\t\t\t\t\t\t\t\t\tif _.isEqual(p0,q0) and _.isEqual(p1,q1) then ok = false\r\n\t\t\t\t\t\t\t\t\t\t\tif _.isEqual(p0,q1) and _.isEqual(p1,q0) then ok = false\r\n\t\t\t\t\t\t\t\t\t\tif ok then res.push [[i0,j0],[i1,j1]]\r\n\tres # innehåller koordinaterna för paren.\r\n"
  ]
}