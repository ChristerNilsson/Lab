{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "SIZE = 12\r\nTILE = 60\r\nFREE = -1\r\nN = 5\r\nb = null\r\nCOLORS = null\r\n\r\nselected = []\r\nmessage = ''\r\nbuttons = []\r\nwrap = false\r\nwrapCount = 0\r\npath = []\r\npathTimestamp = null\r\n\r\nclass Button\r\n\tconstructor : (@x,@y,@txt,@click) -> @r=50\r\n\tinside : (x,y) -> @r > dist @x,@y,x,y\r\n\tdraw : ->\r\n\t\tfc 0.5\r\n\t\tsc()\r\n\t\tcircle @x,@y,@r\r\n\t\tfc 0\r\n\t\ttextSize 30\r\n\t\ttext @txt,@x,@y\r\n\r\nnewGame = (n) ->\r\n\tN = constrain n,2,100\r\n\twrapCount = 0\r\n\tmakeGame()\r\n\r\nsetup = ->\r\n\tcreateCanvas 30+TILE*SIZE+30,100+TILE*SIZE+TILE\r\n\trectMode CENTER\r\n\tmakeColors()\r\n\tbuttons.push new Button 80,65,'-', -> newGame N-1\r\n\tbuttons.push new Button 180,65,N, -> newGame N\r\n\tbuttons.push new Button 280,65,'+', -> newGame N+1\r\n\tbuttons.push new Button width-80,65,'', -> wrap = not wrap\r\n\tmakeGame()\r\n\t#assert true,  setBoard 41,true,2,5,9,8,[\"\",\"\",\"\",\" 25\",\" 22 35 21       7\",\" 11 10 15\",\"          5\",\"  19 18   29\",\"   33      30\"]\r\n\t#assert false, setBoard 41,true,2,5,3,8,[\"\",\"\",\"\",\" 25\",\" 22 35 21       7\",\" 11 10 15\",\"          5\",\"  19 18   29\",\"   33      30\"]\r\n\t#assert false,  setBoard 21,false,2,8,6,8,[\"\",\"    17\",\"\",\"\",\"        11\",\"  7\",\"     4   7\",\"  5    7  15 10\",\"  17   5 3 18 16 2 12\",\"       8 13 15 9\",\"  10  3    13 13\"]\r\n\t#assert true,  setBoard 21,false,2,2,7,2,[\"\",\"        20  5\",\" 18 1  17   19 16\",\"  4 9 10  14 15 3\",\"     9\"]\r\n\r\nmybrightness = (s) ->\r\n\tres = 0\r\n\tfor ch in s\r\n\t\tres += \"0123456789abcdef#\".indexOf ch\r\n\tres\r\n\r\nmakeColors = ->\r\n\tCOLORS = []\r\n\tfor i in \"05af\"\r\n\t\tfor j in \"05af\"\r\n\t\t\tfor k in \"05af\"\r\n\t\t\t\tCOLORS.push \"#\"+i+j+k\r\n\tCOLORS = _.without COLORS, \"#000\", \"#005\", \"#00a\"\r\n\tCOLORS.sort (a,b) -> mybrightness(b) - mybrightness(a)\r\n\r\nmakeGame = ->\r\n\tcandidates = []\r\n\tfor i in range 50\r\n\t\tcandidates.push i % N\r\n\t\tcandidates.push N-1 - i % N\r\n\tcandidates = _.shuffle candidates\r\n\r\n\tb = new Array SIZE\r\n\tfor i in range SIZE\r\n\t\tb[i] = new Array SIZE\r\n\t\tfor j in range SIZE\r\n\t\t\tif i in [0,SIZE-1] or j in [0,SIZE-1] then b[i][j] = FREE\r\n\t\t\telse b[i][j] = candidates.pop()\r\n\r\ndraw = ->\r\n\tbg 0.25\r\n\tsw 1\r\n\tbuttons[1].txt = N-1\r\n\tbuttons[3].txt = if wrap then 'wrap' else wrapCount\r\n\r\n\tfor button in buttons\r\n\t\tbutton.draw()\r\n\r\n\ttextSize 0.8 * TILE\t\r\n\ttranslate TILE,TILE+100\r\n\ttextAlign CENTER,CENTER\r\n\tfc 1\r\n\tsc 0\r\n\tfor i in range SIZE\r\n\t\tfor j in range SIZE\r\n\t\t\tfc 0\r\n\t\t\tsc 1\r\n\t\t\trect TILE*i,TILE*j,TILE,TILE\r\n\t\t\tcell = b[i][j]\r\n\t\t\tif cell >= 0 \r\n\t\t\t\tfill COLORS[cell%%COLORS.length]\r\n\t\t\t\tsc()\r\n\t\t\t\ttext b[i][j],TILE*i,TILE*j\r\n\tfor [i,j] in selected\r\n\t\tfc 1,1,0,0.5\r\n\t\tsc()\r\n\t\tcircle TILE*i,TILE*j,TILE/2-3\r\n\tdrawPath()\r\n\r\nwithin = (i,j) -> 0 <= i < SIZE and 0 <= j < SIZE\r\n\r\nmousePressed = ->\r\n\tfor button in buttons\r\n\t\tif button.inside mouseX,mouseY then button.click()\r\n\t[i,j] = [(mouseX-TILE/2)//TILE,(mouseY-100-TILE/2)//TILE]\r\n\tif not within i,j then return \r\n\tif selected.length == 0 \r\n\t\tif b[i][j] != FREE then selected.push [i,j]\r\n\telse\r\n\t\t[i1,j1] = selected[0]\r\n\t\tif i==i1 and j==j1 then return selected.pop()\r\n\t\tif b[i][j] + b[i1][j1] == N-1 \r\n\t\t\tpath = legal i1,j1,i,j\r\n\t\t\tif path.length > 0 # or legal(i,j,i1,j1) # legal misses some targets\r\n\t\t\t\tb[i][j] = b[i1][j1] = FREE\r\n\t\t\t\tif wrap then wrapCount++\r\n\t\t\t\twrap = false\r\n\t\t\t\tselected.pop()\r\n\r\nmakeMove = (x,y) -> if wrap then [x %% SIZE, y %% SIZE] else [x,y]\r\n\r\nmakePath = (reached,i,j) ->\r\n\tres = []\r\n\tprint reached,i,j\r\n\tcount = 0\r\n\twhile count < 50\r\n\t\tcount++\r\n\t\tkey = \"#{i},#{j}\"\r\n\t\t[turns0,i0,j0,index0] = reached[key]\r\n\t\tprint [turns0,i0,j0,index0]\r\n\t\tif index0 == -1\r\n\t\t\tres.push reached[key]\r\n\t\t\tpathTimestamp = millis()\r\n\t\t\tprint res\r\n\t\t\treturn res\r\n\t\t[di,dj] = [[1,0],[-1,0],[0,1],[0,-1]][index0]\r\n\t\t[i,j] = makeMove i0+di,j0+dj\r\n\t\tres.push reached[key]\r\n\tres\r\n\r\ndrawPath = ->\r\n\tif path.length == 0 then return \r\n\tsw 3\r\n\t[z,i1,j1,z] = path[0]\r\n\tx1 = TILE * i1\r\n\ty1 = TILE * j1\r\n\tfor [z,i2,j2,z] in path\r\n\t\tx2 = TILE * i2\r\n\t\ty2 = TILE * j2\r\n\t\tif TILE == dist x1,y1,x2,y2\r\n\t\t\tline x1,y1,x2,y2\r\n#\t\telse\r\n\t\t\t# if y1==y2\r\n\t\t\t# \tline 1,y1,x2,y2\r\n\t\t\t# \tline x1,y1,10,y2\r\n\t\t\t# else\r\n\t\t\t# \tline x1,1,x2,y2\r\n\t\t\t# \tline x1,y1,x2,10\r\n\r\n\t\t[x1,y1] = [x2,y2]\r\n\tif millis() > 200 + pathTimestamp then path = []\r\n\r\n# A*\r\nlegal = (i0,j0,i1,j1) ->\r\n\tstart = [0,i0,j0,-1] # turns,x,y,move\r\n\tcands = []\r\n\tcands.push start\r\n\treached = {}\r\n\treached[[i0,j0]] = start\r\n\t#print \"#####\"\r\n\twhile cands.length > 0\r\n\t\t#print front\r\n\t\tfront = cands\r\n\t\tfront.sort (a,b) -> a[0]-b[0]\r\n\t\tcands = []\r\n\t\tfor [turns0,x0,y0,index0] in front\r\n\t\t\t#print '------',x0,y0\r\n\t\t\tfor [dx,dy],index in [[-1,0],[1,0],[0,-1],[0,1]]\r\n\t\t\t\t[x,y] = makeMove x0+dx,y0+dy\r\n\t\t\t\tkey = \"#{x},#{y}\"\r\n\t\t\t\tturns = turns0\r\n\t\t\t\tif index != index0 and index0 != -1 then turns++\r\n\t\t\t\tnext = [turns,x,y,index]\r\n\t\t\t\t#print next\r\n\t\t\t\tif x==i1 and y==j1 and turns<=2\r\n\t\t\t\t\treached[key] = next\r\n\t\t\t\t\treturn makePath reached,i1,j1\r\n\t\t\t\tif within x,y\r\n\t\t\t\t\tif b[x][y]==FREE\r\n\t\t\t\t\t\tif key not of reached or reached[key][0] >= next[0]\r\n\t\t\t\t\t\t\tif next[0] < 3\r\n\t\t\t\t\t\t\t\treached[key] = next\r\n\t\t\t\t\t\t\t\tcands.push next\r\n\t[]\r\n\r\nsetBoard = (n,w,i0,j0,i1,j1,arr) ->\r\n\tN = n\r\n\twrap = w\r\n\tfor j in range SIZE\r\n\t\tb[j] = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]\r\n\tfor row,j in arr\r\n\t\tfor cell,i in row.split ' '\r\n\t\t\tb[i][j] = if cell=='' then -1 else parseInt cell\r\n\t#print b\r\n\tlegal i0,j0,i1,j1\r\n\r\n\r\n# getlst = (x0,y0,dx,dy) ->\r\n# \tresx = []\r\n# \tresy = []\r\n# \t[x,y] = makeMove x0+dx,y0+dy \r\n# \twhile within x,y\r\n# \t\tif b[x][y] != FREE then return [resx,resy]\r\n# \t\tresx.push x\r\n# \t\tresy.push y\r\n# \t\t[x,y] = makeMove x+dx,y+dy \r\n# \t[resx,resy]\r\n\r\n# getrows = (x0,x1) ->\r\n# \tres = []\r\n# \tfor y in range SIZE\r\n# \t\tfound = false \r\n# \t\tfor x in range x0,x1 \r\n# \t\t\tif b[x][y] != FREE then found = true \r\n# \t\tif not found then res.push y\r\n# \tres\r\n\r\n# getcols = (y0,y1) ->\r\n# \tres = []\r\n# \tfor x in range SIZE\r\n# \t\tfound = false \r\n# \t\tfor y in range y0,y1 \r\n# \t\t\tif b[x][y] != FREE then found = true \r\n# \t\tif not found then res.push x\r\n# \tres\r\n\r\n# bridge = (x0,y0,x1,y1) ->\r\n# \tlst1 = getlst(x0,y0,0,-1)[1].concat getlst(x0,y0,0,1)[1]\r\n# \tlst2 = getlst(x1,y1,0,-1)[1].concat getlst(x1,y1,0,1)[1]\r\n# \tlst3 = getrows _.min([x0,x1])+1,_.max([x0,x1])\r\n# \tlst4 = _.intersection lst1, lst2, lst3 \r\n\r\n# \tlst1 = getlst(x0,y0,-1,0)[0].concat getlst(x0,y0,1,0)[0]\r\n# \tlst2 = getlst(x1,y1,-1,0)[0].concat getlst(x1,y1,1,0)[0]\r\n# \tlst3 = getcols _.min([y0,y1])+1,_.max([y0,y1])\r\n# \tlst5 = _.intersection lst1, lst2, lst3 \r\n\r\n# \tlst4.length > 0 or lst5.length > 0\r\n"
  ]
}