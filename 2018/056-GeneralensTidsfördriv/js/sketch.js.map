{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# Vectorized Playing Cards 2.0 - http://sourceforge.net/projects/vector-cards/\r\n# Copyright 2015 - Chris Aguilar - conjurenation@gmail.com\r\n# Licensed under LGPL 3 - www.gnu.org/copyleft/lesser.html\r\n\r\n#  4  4  4  4  4  0  8  8  8  8  8\r\n#  5  5  5  5  5  1  9  9  9  9  9\r\n#  6  6  6  6  6  2 10 10 10 10 10\r\n#  7  7  7  7  7  3 11 11 11 11 11\r\n#    12 13 14 15    16 17 18 19      PANEL\r\n\r\nACES = [0,1,2,3]\r\nHEAPS = [4,5,6,7,8,9,10,11]\r\nPANEL = [12,13,14,15,16,17,18,19]\r\n\r\nSUIT = \"club heart spade diamond\".split ' '\r\nRANK = \"A 2 3 4 5 6 7 8 9 T J Q K\".split ' '\r\nLONG = \" Ace 2 3 4 5 6 7 8 9 Ten Jack Queen King\".split ' '\r\nOFFSETX = 468\r\nW = 263.25\r\nH = 352\r\nw = W/3\r\nh = H/3\r\nLIMIT = 2000 # Maximum steps considered before giving up.\r\n\r\nfaces = null\r\nbacks = null\r\n\r\nboard = null\r\ncards = null\r\nhist = null\r\ncands = null\r\nhash = null\r\naceCards = 4\r\noriginalBoard = null\r\nstart = null\r\nmsg = ''\r\nautoShake = []\r\nshake = true\r\nN = null # Max rank\r\nclassic = false\r\nsrcs = null\r\ndsts = null\r\nhintsLeft = null\r\nmaxHints = null\r\n\r\npreload = -> \r\n\tfaces = loadImage 'cards/Color_52_Faces_v.2.0.png'\r\n\tbacks = loadImage 'cards/Playing_Card_Backs.png'\r\n\r\nrange = _.range\r\nassert = (a, b, msg='Assert failure') -> chai.assert.deepEqual a, b, msg\r\n\r\ncompress = (board) ->\r\n\tfor heap in HEAPS\r\n\t\tif board[heap].length > 1\r\n\t\t\ttemp = board[heap][0]\r\n\t\t\tres = []\r\n\t\t\tfor i in range 1,board[heap].length\r\n\t\t\t\t[suit1,h1,v1] = unpack temp\r\n\t\t\t\t[suit2,h2,v2] = unpack board[heap][i]\r\n\t\t\t\tif suit1==suit2 and 1 == abs v1-h2\r\n\t\t\t\t\ttemp = pack suit1,h1,v2\r\n\t\t\t\telse\r\n\t\t\t\t\tres.push temp \r\n\t\t\t\t\ttemp = pack suit2,h2,v2\r\n\t\t\tres.push temp\r\n\t\t\tboard[heap] = res\r\n\r\n# suit är nollbaserad\r\n# rank1 är nollbaserad\r\n# rank2 är nollbaserad\r\n# I talet räknas rank1 och rank2 upp\r\npack = (suit,rank1,rank2=rank1) ->\r\n\tif rank1 == rank2 then rank2 = -1 \r\n\tsuit + 10 * (rank1+1) + 1000 * (rank2+1) # rank=1..13 suit=0..3 \r\nassert 10, pack 0,0 # club A\r\nassert 13, pack 3,0 # diamond A\r\nassert 23, pack 3,1,1 # diamond 2\r\nassert 12111, pack 1,10,11 # heart J,Q\r\nassert 111, pack 1,10,10 # heart J,J\r\n\r\nunpack = (n) -> \r\n\tsuit = n%10\r\n\trank1 = (n//10)%100 \r\n\trank2 = n//1000 \r\n\tif rank2 == 0 then rank2 = rank1\r\n\t[suit,rank1-1,rank2-1]\r\nassert [0,0,0], unpack 10\r\nassert [3,0,0], unpack 13\r\nassert [1,10,11], unpack 12111\r\n\r\nmakeBoard = (maxRank,classic)->\r\n\tN = maxRank\r\n\r\n\tcards = []\r\n\tfor suit in range 4\r\n\t\tfor rank in range 1,maxRank # 2..K\r\n\t\t\tcards.push pack suit,rank \r\n\tcards = _.shuffle cards\r\n\r\n\tboard = []\r\n\tfor i in range 20\r\n\t\tboard.push []\r\n\r\n\tfor suit,heap in range 4 \r\n\t\tboard[heap].push pack suit,0 # Ess\r\n\r\n\tfor heap in PANEL\r\n\t\tboard[heap].push cards.pop()\r\n\r\n\tfor card,i in cards\r\n\t\tboard[if classic then 4+i%8 else int random 4,12].push card\r\n\r\n\tcompress board\r\n\r\nfakeBoard = ->\r\n\tN = 13\r\n\tclassic = false \r\n\tif N==3 then board = [[10],[11],[12],[13],[],[],[],[],[],[],[],[],[21],[33],[23],[31],[30],[22],[32],[20]] # 3\r\n\tif N==4 then board = [[10],[11],[12],[13],[32],[],[21],[],[],[],[41],[42],[33],[23],[31],[20],[43],[22],[30],[40]] # 4\r\n\tif N==4 then board = [[10],[11],[12],[13],[23,43],[],[],[],[],[],[41],[22],[32],[42],[31],[40],[33],[21],[20],[30]]\r\n\tif N==5 then board = [[10],[11],[12],[13],[21,30],[43,20],[],[53],[32],[50,22],[],[],[41],[51],[31],[42],[23],[52],[40],[33]] # 5\r\n\tif N==5 then board = [[10],[11],[12],[13],[],[3041],[20],[33],[42],[],[53],[4030],[52],[50],[32],[22],[51],[43],[21],[23]]\r\n\tif N==6 then board = [[10],[11],[12],[13],[32,51,5060],[62],[31],[],[22],[53],[42,3023],[52],[43],[30],[20],[61],[21],[41],[63],[40]] # 6 \r\n\tif N==7 then board = [[10],[11],[12],[13],[23,63],[],[20,72,50,21,51],[31,73,22],[53,41,61],[33],[],[6070],[62],[42],[71],[30],[43],[40],[32],[52]] # 7\r\n\tif N==7 then board = [[10],[11],[12],[13],[53,33],[30,72],[40,42],[23,73],[60,22,63],[],[71,43,5041],[61],[50],[52],[21],[62],[70],[20],[31],[32]]\r\n\tif N==8 then board = [[10],[11],[12],[13],[62,20,50,43,31,70],[51,60,2033,72],[52,22,81],[83],[73],[30,63],[41,40],[],[80],[42],[53],[71],[32],[21],[82],[61]] # 8\r\n\tif N==9 then board = [[10],[11],[12],[13],[53,80,71,91],[50,93,70],[42,81],[41,7063,61],[32,82,21],[20,40],[30,52,72],[62,92,90],[51],[83],[43],[33],[60],[23],[22],[31]] # 9\r\n\tif N==10 then board = [[10],[11],[12],[13],[93,90,41,20,83,23],[53,62,103],[100,43,61],[],[22,81,51,80,33],[102,73,31],[21,32,91,72],[50,52,82,40],[92],[70],[30],[60],[42],[63],[71],[101]] # T\r\n\tif N==11 then board = [[10],[11],[12],[13],[3042,53,93,33,103,82],[3021,72],[91,40],[111],[50,20,52,23,92,80,113,71,101],[100,43,90,83],[62,41],[70,61,112,63],[51],[60],[73],[22],[102],[81],[30],[110]] # J\r\n\tif N==12 then board = [[10],[11],[12],[13],[20,73],[60,100,33,92,71,51],[91,61,103,90,50],[80,93,121,23,52],[102,30,111,63,21,53,81],[122,83,112],[43,62,40],[42,70,123,41,22],[113],[31],[110],[120],[72],[101],[32],[82]] # Q\r\n\tif N==13 then board = [[10],[11],[12],[13],[22,53,100,40,33],[5061,102,131],[5062,93,73,42,60,72,83],[41,111,81,133,63,50,120],[70,71],[92,20,121,130],[11123,31,9080,23],[101,82,91,43],[32],[132],[112],[122],[21],[103],[110],[30]] # K\r\n\tif N==13 then board = [[10],[11],[12],[13],[50,101,112,43,42],[62,133,72,102,53],[71,63,111,30,80],[20,100,32,81,103],[51,22,61,92,91],[110,52,82,21,60],[122,121,41,83,123],[120,73,40,90,113],[93],[70],[33],[31],[131],[132],[23],[130]] # C\r\n\r\nmakeAutoShake = ->\r\n\tautoShake = []\r\n\tfor i in range 52\r\n\t\tautoShake.push [int(random(-2,2)),int(random(-2,2))]\r\n\r\nsetup = ->\r\n\tcreateCanvas 800,600\r\n\tmakeAutoShake()\r\n\tnewGame '3'\r\n\tdisplay board \r\n\r\nshowHeap = (board,heap,x,y,dx) ->\r\n\tn = calcAntal board[heap]\r\n\tif n==0 then return \r\n\tx0 = width/2 - w/2\r\n\tif x < 0 then x0 += -w+dx\r\n\tif x > 0 then x0 += w-dx\r\n\tx = x0 + x*dx/2\r\n\ty = y * h\r\n\tfor card,k in board[heap]\r\n\t\t[suit,unvisible,visible] = unpack card\r\n\t\tdr = if unvisible < visible then 1 else -1\r\n\t\tfor rank,i in range unvisible,visible+dr,dr\r\n\t\t\t[x0,y0] = if shake then autoShake[13*suit+rank] else [0,0]\r\n\t\t\timage faces, x0+x,y0+y+13, w,h, OFFSETX+W*rank,1092+H*suit,243,H\r\n\t\t\tx += dx\r\n\r\n\tcard = _.last board[heap]\r\n\t[suit,unvisible,visible] = unpack card\r\n\tif heap in ACES and visible == N-1\r\n\t\t[x0,y0] = if shake then autoShake[13*suit+rank] else [0,0]\r\n\t\timage backs, x0+x,y0+y+13, w,h, OFFSETX+860,1092+622,243,H\r\n\r\ndisplay = (board) ->\r\n\tbackground 0,128,0\r\n\r\n\ttextAlign CENTER,CENTER\r\n\ttextSize 10\r\n\r\n\tx = width/2-5+2\r\n\ty = height-110\r\n\r\n\tfill 200\r\n\ttext 'U = Undo',          x,y\r\n\ttext 'R = Restart',       x,y+10\r\n\r\n\t# text '3 4 5 6 = Easy',    x,y+20\r\n\t# text '7 8 9 = Medium',    x,y+30\r\n\t# text 'T J Q K = Hard',    x,y+40\r\n\r\n\ttext '3 4 5 6 7 8 9 T J Q K',    x,y+20\r\n\ttext 'Easy    Level    Hard',    x,y+30\r\n\r\n\ttext 'C = Classic',       x,y+40\r\n\ttext 'Space = Next',      x,y+60\r\n\ttext \"H = Hint (#{hintsLeft} left)\", x,y+70\r\n\r\n\ttext msg, x,y+105\r\n\ttextSize 24\r\n\ttext (if classic then 'Classic' else LONG[N]), x,y+89\r\n\ttextAlign LEFT,CENTER\r\n\ttextSize 10\r\n\ttext 'Generalens Tidsfördriv', 0,height-5\r\n\r\n\tfor heap,y in ACES\r\n\t\tshowHeap board, heap, 0, y, 0\r\n\r\n\tfor heap,y in [4,5,6,7]\r\n\t\tn = calcAntal board[heap]\r\n\t\tdx = if n<=7 then w/2 else (width/2-w/2-w)/(n-1)\r\n\t\tshowHeap board, heap, -2, y, -dx\r\n\r\n\tfor heap,y in [8,9,10,11]\r\n\t\tn = calcAntal board[heap]\r\n\t\tdx = if n<=7 then w/2 else (width/2-w/2-w)/(n-1)\r\n\t\tshowHeap board, heap, 2, y, dx\r\n\r\n\tfor heap,x in PANEL\r\n\t\txx = [-8,-6,-4,-2,2,4,6,8][x]\r\n\t\tshowHeap board, heap, xx,4, w\r\n\r\nlegalMove = (board,a,b) ->\r\n\tif a in ACES then return false \r\n\tif b in PANEL then return false \r\n\tif board[a].length==0 then return false\r\n\tif board[b].length==0 then return true\r\n\t[sa,a1,a2] = unpack _.last board[a]\r\n\t[sb,b1,b2] = unpack _.last board[b]\r\n\tif sa==sb and abs(a2-b2) == 1 then return true \r\n\tfalse\r\n\r\nmakeMove = (board,a,b,record) -> # from heap a to heap b\r\n\t[suit,visible,unvisible] = unpack board[a].pop() # reverse order\r\n\tif record then hist.push [a, b, 1 + abs unvisible-visible]\r\n\tif board[b].length > 0\r\n\t\t[xx,unvisible,yy] = unpack board[b].pop()\r\n\tboard[b].push pack suit,unvisible,visible \r\n\r\n# returns text move\r\nundoMove = ([a,b,antal]) ->\r\n\t[suit, unvisible, visible] = unpack board[b].pop()\r\n\tif unvisible < visible\r\n\t\tboard[a].push pack suit,visible, visible-antal+1\r\n\t\tif visible!=unvisible+antal-1\r\n\t\t\tboard[b].push pack suit,unvisible,visible-antal\r\n\t\t\treturn prettyMove a,b,board\r\n\telse\r\n\t\tboard[a].push pack suit,visible, visible+antal-1\r\n\t\tif unvisible!=visible+antal-1\t\r\n\t\t\tboard[b].push pack suit,unvisible,visible+antal\r\n\t\t\treturn prettyMove a,b,board\r\n\r\nmousePressed = -> \r\n\tif not (0 < mouseX < width) then return\r\n\tif not (0 < mouseY < height) then return\r\n\r\n\tmarked = null\r\n\tmx = mouseX//(W/3)\r\n\tmy = mouseY//(H/3)\r\n\tif my >= 4\r\n\t\tif mx<=3 then marked = 12 + mx\r\n\t\tif mx>=5 then marked = 11 + mx\r\n\telse\r\n\t\tif mx==4 then marked = my\r\n\t\telse if mx<4 then marked = [4,5,6,7][my]\r\n\t\telse marked = [8,9,10,11][my]\r\n\tif marked==null then return \r\n\r\n\tholes = []\r\n\tfound = false\r\n\r\n\tfor heap in ACES.concat HEAPS \t\r\n\t\tif board[heap].length==0 then holes.push heap\r\n\t\tif heap not in holes and legalMove board,marked,heap  \r\n\t\t\tmakeMove board,marked,heap,true\r\n\t\t\tfound = true\r\n\t\t\tbreak \r\n\tif not found\r\n\t\tfor heap in holes\t\r\n\t\t\tif legalMove board,marked,heap  \r\n\t\t\t\tmakeMove board,marked,heap,true\r\n\t\t\t\tbreak \r\n\r\n\tif 4*N == countAceCards board \r\n\t\tif hintsLeft == maxHints\r\n\t\t\tmsg = \"#{(millis() - start) // 1000} seconds\"\r\n\t\telse if hintsLeft == maxHints-1\r\n\t\t\tmsg = \"1 hint used\"\r\n\t\telse\r\n\t\t\tmsg = \"#{maxHints - hintsLeft} hints used\"\r\n\r\n\tdisplay board\r\n\r\n####### AI-section ########\r\n\r\nfindAllMoves = (b) ->\r\n\tsrcs = HEAPS.concat PANEL \r\n\tdsts = ACES.concat HEAPS \r\n\tres = []\r\n\tfor src in srcs\r\n\t\tfor dst in dsts\r\n\t\t\tif src != dst\r\n\t\t\t\tif legalMove b,src,dst\r\n\t\t\t\t\tres.push [src,dst]\r\n\tres\r\n\r\nmakeKey = (b) -> \r\n\tres = ''\r\n\tfor heap,index in b\r\n\t\tif heap.length==0\r\n\t\t\tres += '.'\r\n\t\tfor card in heap\r\n\t\t\t[suit,r1,r2] = unpack card\r\n\t\t\tif r1==r2\r\n\t\t\t\tres += 'chsd'[suit] + RANK[r1]\r\n\t\t\telse\r\n\t\t\t\tres += 'chsd'[suit] + RANK[r1] + RANK[r2]\r\n\t\tres += '|'\r\n\tres \r\n\r\ncalcAntal = (lst) ->\r\n\tres=0\r\n\tfor card in lst\r\n\t\t[suit,unvisible,visible] = unpack card\r\n\t\tres += 1 + abs(unvisible-visible)\r\n\tres\r\n\r\ncountAceCards = (b) ->\r\n\tres\t= 0\r\n\tfor heap in ACES\r\n\t\tres += calcAntal b[heap]\r\n\tres\r\n\r\nexpand = ([aceCards,level,b,path]) ->\r\n\tres = []\r\n\tmoves = findAllMoves b\r\n\tfor move in moves\r\n\t\t[src,dst] = move\r\n\t\tb1 = _.cloneDeep b\r\n\t\tmakeMove b1,src,dst\r\n\t\tkey = makeKey b1\r\n\t\tif key not of hash\r\n\t\t\tnewPath = path.concat([move])\r\n\t\t\thash[key] = [newPath, b]\r\n\t\t\tres.push [countAceCards(b1), level+1, b1, path.concat([move])] \r\n\tres\r\n\r\nhint = ->\r\n\tif hintsLeft == 0 then return\r\n\thintsLeft--\r\n\tundone = []\r\n\twhile true \r\n\t\tres = hintOne()\r\n\t\tif res? or hist.length==0 \r\n\t\t\tfor u in undone\r\n\t\t\t\tprint \"Undo: #{u}\"\r\n\t\t\tprint \"Move #{res}\"\r\n\t\t\treturn\r\n\t\tcard = hist.pop()\r\n\t\tundone.push undoMove card\r\n\r\nhintOne = -> \r\n\thintTime = millis()\r\n\taceCards = countAceCards board\r\n\tif aceCards == N*4 then return \r\n\tcands = []\r\n\tcands.push [aceCards,hist.length,board,[]] # antal kort på ässen, antal drag, board\r\n\thash = {}\r\n\tnr = 0\r\n\tcand = null\r\n\torigBoard = _.cloneDeep board\r\n\r\n\twhile nr < LIMIT and cands.length > 0 and aceCards < N*4\r\n\t\tnr++ \r\n\t\tcand = cands.pop()\r\n\t\taceCards = cand[0]\r\n\t\tif aceCards < N*4 \r\n\t\t\tincrement = expand cand\r\n\t\t\tcands = cands.concat increment\r\n\t\t\tcands.sort (a,b) -> if a[0] == b[0] then b[1]-a[1] else a[0]-b[0]\r\n\r\n\tif aceCards == N*4\r\n\t\tboard = cand[2]\r\n\t\tpath = cand[3]\r\n\t\tboard = origBoard\r\n\t\t[src,dst] = path[0]\r\n\t\ts = prettyMove src,dst,board\r\n\t\tmakeMove board,src,dst,true\r\n\t\tprint \"hint: #{int millis()-hintTime} ms\"\r\n\t\treturn s\r\n\telse\r\n\t\tboard = origBoard\r\n\t\treturn null\r\n\r\nnewGame = (key) ->\r\n\tstart = millis()\r\n\tmsg = ''\r\n\thist = []\r\n\tclassic = key=='C'\r\n\twhile true \r\n\t\tif key in '3456789TJQK' then makeBoard 3+'3456789TJQK'.indexOf(key),classic\r\n\t\tif key in 'C' then makeBoard 13,classic\r\n\t\tmaxHints = N\r\n\t\thintsLeft = maxHints\r\n\t\toriginalBoard = _.cloneDeep board\r\n\r\n\t\taceCards = countAceCards board\t\t\r\n\t\tcands = []\r\n\t\tcands.push [aceCards,0,board,[]] # antal kort på ässen, antal drag, board\r\n\t\thash = {}\r\n\t\tnr = 0\r\n\t\tcand = null\r\n\r\n\t\t#print LIMIT,N,nr,cands.length,aceCards\r\n\t\twhile nr < LIMIT and cands.length > 0 and aceCards < N*4\r\n\t\t\tnr++ \r\n\t\t\tcand = cands.pop()\r\n\t\t\taceCards = cand[0]\r\n\t\t\tincrement = expand cand\r\n\t\t\tcands = cands.concat increment\r\n\t\t\tcands.sort (a,b) -> if a[0] == b[0] then b[1]-a[1] else a[0]-b[0]\r\n\r\n\t\tlevel = cand[1]\r\n\t\tprint nr,aceCards,level\r\n\t\tif aceCards == N*4\r\n\t\t\t#print 'heapsize',_.size(hash)\r\n\t\t\tprint JSON.stringify(originalBoard)\r\n\t\t\tboard = cand[2]\r\n\t\t\tprintSolution hash,board\r\n\t\t\tboard = _.cloneDeep originalBoard\r\n\t\t\tprint \"#{int millis()-start} ms\"\r\n\t\t\tstart = millis()\r\n\t\t\treturn \r\n\r\nrestart = ->\r\n\thist = []\r\n\tboard = _.cloneDeep originalBoard\r\n\r\nnextLevel = ->\r\n\tif 4*N == countAceCards board\r\n\t\tN++\r\n\telse\r\n\t\tN--\r\n\tN = constrain N,3,13\r\n\tclassic = false\r\n\tnewGame '   3456789TJQK'[N]\r\n\r\nkeyPressed = -> \r\n\tif key == 'U' and hist.length > 0 then undoMove hist.pop()\r\n\tif key == 'R' then restart()\r\n\tif key in '3456789TJQKC' then newGame key \r\n\tif key == 'A' then shake = not shake\r\n\tif key == ' ' then nextLevel()\r\n\tif key == 'H' then hint()\r\n\tdisplay board\r\n\t\t\r\nprettyCard = (card,antal=2) ->\r\n\t[suit,unvisible,visible] = unpack card \r\n\tif antal==1 then \"#{RANK[visible]}\"\r\n\telse \"#{SUIT[suit]} #{RANK[visible]}\"\r\nassert \"diamond 3\", prettyCard pack(3,2)\r\nassert \"3\", prettyCard pack(3,2),1\r\n\r\nprettyMove = (src,dst,b) ->\r\n\tc1 = _.last b[src]\r\n\tif b[dst].length > 0\r\n\t\tc2 = _.last b[dst]\r\n\t\t\"#{prettyCard c1} to #{prettyCard c2,1}\"\r\n\telse\r\n\t\tif dst in HEAPS then \"#{prettyCard c1} to hole\"\r\n\t\telse \"#{prettyCard c1} to panel\"\r\n\r\nprintSolution = (hash, b) ->\r\n\tkey = makeKey b\r\n\tsolution = []\r\n\twhile key of hash\r\n\t\t[path,b] = hash[key]\r\n\t\tsolution.push hash[key]\r\n\t\tkey = makeKey b\r\n\tsolution.reverse()\r\n\ts = ''\r\n\tfor [path,b],index in solution\r\n\t\t[src,dst] = _.last path \r\n\t\ts += \"\\n#{index}: #{prettyMove src,dst,b}\"\r\n\tprint s\r\n"
  ]
}