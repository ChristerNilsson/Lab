{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "FILENAME = 'karta.jpg'\r\n\r\nspara = (lat,lon, x,y) -> {lat,lon, x,y}\r\nB = spara 59.300593,18.163456, 5422,158 \r\nA = spara 59.300736,18.125648, 554,433\r\nC = spara 59.265339,18.159501, 5384,9114 \r\nD = spara 59.281411,18.122435, 338,5298  # Sockenvägen/Ätravägen\r\nE = spara 59.266262,18.144961, 3496,8980 # Garden Center\r\n\r\nDATA = \"gpsKarta\"\r\nWIDTH = 6912\r\nHEIGHT = 9216\r\n[cx,cy] = [0,0] # center (image coordinates)\r\nSCALE = 1\r\n\r\nreleased = true # to make Android work\r\n\r\ngps = null\r\nTRACKED = 5 # circles shows the player's position\r\nposition = null # gps position (pixels)\r\ntrack = [] # five latest GPS positions (pixels)\r\nbuttons = []\r\npoints = [] # remembers e.g. car/bike position\r\nimg = null \r\nbearing = 360\r\nmessages = []\r\n\r\npreload = -> img = loadImage FILENAME\r\n\r\nmyround = (x,dec=6) ->\r\n\tx *= 10**dec\r\n\tx = round x\r\n\tx/10**dec\r\n\r\nshow = (prompt,p) -> print prompt,\"http://maps.google.com/maps?q=#{p.lat},#{p.lon}\"\t\r\n\r\nvercal = (a,b,y) ->\r\n\tx = map y, a.y,b.y, a.x,b.x\r\n\tlat = map y, a.y,b.y, a.lat,b.lat\r\n\tlon = map y, a.y,b.y, a.lon,b.lon  \r\n\t{lat,lon,x,y} \t\r\n\r\nhortal = (a,b,x) ->\r\n\ty = map x, a.x,b.x, a.y,b.y\r\n\tlat = map x, a.x,b.x, a.lat,b.lat\r\n\tlon = map x, a.x,b.x, a.lon,b.lon  \r\n\t{lat,lon,x,y} \t\r\n\r\ncorner = (a,b,c,d,x,y)->\r\n\tlon = map x, a.x,b.x, a.lon,b.lon\r\n\tlat = map y, c.y,d.y, c.lat,d.lat  \r\n\t{lat,lon,x,y} \t\r\n\r\nmakeCorners = ->\r\n\tad0 = vercal A,D,0\r\n\tad1 = vercal A,D,HEIGHT\r\n\tbc0 = vercal B,C,0\r\n\tbc1 = vercal B,C,HEIGHT\r\n\r\n\tab0 = hortal A,B,0\r\n\tab1 = hortal A,B,WIDTH\r\n\tec0 = hortal E,C,0\r\n\tec1 = hortal E,C,WIDTH\r\n\r\n\tnw = corner ad0,bc0,ab0,ec0,0,    0\r\n\tne = corner ad0,bc0,ab1,ec1,WIDTH,0\r\n\tse = corner ad1,bc1,ab1,ec1,WIDTH,HEIGHT\r\n\tsw = corner ad1,bc1,ab0,ec0,0,    HEIGHT\r\n\r\n\tgps = new GPS nw,ne,se,sw,WIDTH,HEIGHT\r\n\r\n\t# Testpunkter\r\n\tP1 = spara 59.275687,18.155340, 4697, 6518 # krknök\r\n\tP2 = spara 59.280348,18.155122, 4590,5310 # trevägsskylt\r\n\tP3 = B\r\n\tP4 = spara 59.279172,18.149319, 3877,5681 # Bron\r\n\r\n\tgps.assert_gps2bmp P1, [6,7]\r\n\tgps.assert_gps2bmp P2, [24,38]\r\n\tgps.assert_gps2bmp P3, [0,1]\r\n\tgps.assert_gps2bmp P4, [-4,7]\r\n\r\n\tgps.assert_bmp2gps P1,[2.4,-1.2]\r\n\tgps.assert_bmp2gps P2,[14.9, -7.35]\r\n\tgps.assert_bmp2gps P3,[0.2,0]\r\n\tgps.assert_bmp2gps P4,[2.3,2.75]\r\n\r\nlocationUpdate = (p) ->\r\n\tlat = p.coords.latitude\r\n\tlon = p.coords.longitude\r\n\tposition = gps.gps2bmp lat,lon\r\n\ttrack.push position\r\n\tif track.length > TRACKED then track.shift()\r\n\txdraw()\r\n\r\nlocationUpdateFail = (error) ->\tif error.code == error.PERMISSION_DENIED then messages = ['Check location permissions']\r\n\r\nsetupCompass = ->\r\n\twindow.addEventListener \"deviceorientation\", (event) ->\r\n\t\tbearing = round event.alpha \r\n\t\txdraw()\r\n\r\nstoreData = -> localStorage[DATA] = JSON.stringify points\t\r\nfetchData = -> if localStorage[DATA] then points = JSON.parse localStorage[DATA]\r\n\r\nsetup = ->\r\n\tcreateCanvas windowWidth,windowHeight\r\n\r\n\t[cx,cy] = [WIDTH/2,HEIGHT/2] \r\n\r\n\tfetchData()\r\n\r\n\tx = width/2\r\n\ty = height/2\r\n\tx1 = 100\r\n\tx2 = width-100\r\n\ty1 = 100\r\n\ty2 = height-100\r\n\r\n\tbuttons.push new Button 'SB',x1,y1, -> \r\n\t\tpoints.push position\r\n\t\tstoreData()\r\n\r\n\tbuttons.push new Button 'U',x,y1, ->\r\n\t\tcy -= 0.5*height/SCALE\r\n\r\n\tbuttons.push new Button '0',x2,y1, -> \r\n\t\tif points.length > 0 \r\n\t\t\tpoints.pop()\r\n\t\t\tstoreData()\r\n\r\n\tbuttons.push new Button 'L',x1,y, -> \r\n\t\tcx -= 0.5*width/SCALE\r\n\r\n\tbuttons.push new Button 'C',x,y, ->\t\r\n\t\t[cx,cy] = position\r\n\r\n\tbuttons.push new Button 'R',x2,y, ->\r\n\t\tcx += 0.5*width/SCALE\r\n\r\n\tbuttons.push new Button 'D',x,y2, -> \r\n\t\tcy += 0.5*height/SCALE\r\n\r\n\tbuttons.push new Button '-',x1,y2, ->\r\n\t\tSCALE /= 1.5\r\n\r\n\tbuttons.push new Button '+',x2,y2, ->\r\n\t\tSCALE *= 1.5\r\n\r\n\tmakeCorners()\r\n\r\n\tposition = [WIDTH/2,HEIGHT/2]\r\n\r\n\tnavigator.geolocation.watchPosition locationUpdate, locationUpdateFail, \r\n\t\tenableHighAccuracy: true\r\n\t\tmaximumAge: 30000\r\n\t\ttimeout: 27000\r\n\r\n\tsetupCompass()\r\n\txdraw()\r\n\r\n\taddEventListener 'touchend', (evt) ->\t\r\n\t\treleased = true             # to make Android work\r\n\t\tmessages.push 'touchend'\r\n\t\tfalse       # to make Android work\r\n\r\n\taddEventListener 'touchstart', (evt) ->\t\r\n\t\tif not released then return false # to make Android work\r\n\t\treleased = false            # to make Android work\r\n\t\tmessages.push \"touchstart #{points.length}\"\r\n\t\ttouches = evt.changedTouches\t\r\n\t\ttouch = touches[touches.length-1]\r\n\t\tmessages.push \"#{touches.length},#{touch.pageX},#{touch.pageY}\"\r\n\t\tfor button in buttons\r\n\t\t\tif button.contains touch.pageX,touch.pageY then button.click()\r\n\t\txdraw()\r\n\t\tfalse       # to make Android work\r\n\r\ndrawTrack = ->\r\n\tpush()\r\n\tfc()\r\n\tsw 2\r\n\tsc 1,1,0 # YELLOW\r\n\ttranslate width/2, height/2\r\n\tscale SCALE\r\n\tfor [x,y],i in track\r\n\t\tcircle x-cx, y-cy, 5*(track.length-i)\r\n\tpop()\r\n\r\ndrawPoints = ->\r\n\tpush()\r\n\tsc()\r\n\tfc 1,0,0,0.5 # RED\r\n\ttranslate width/2, height/2\r\n\tscale SCALE\r\n\tfor [x,y],i in points\r\n\t\tcircle x-cx, y-cy, 20\r\n\tpop()\r\n\r\ndrawButtons = ->\r\n\tbuttons[2].prompt = points.length\r\n\tbuttons[4].prompt = 360 - bearing\r\n\tfor button in buttons\r\n\t\tbutton.draw()\r\n\r\ndrawCompass = ->\r\n\tpush()\r\n\tstrokeCap SQUARE\r\n\ttranslate width/2, height/2\r\n\trotate radians bearing\r\n\tsw 10\r\n\tsc 1,0,0\r\n\tline 0,-100,0,-150\r\n\tsc 1\r\n\tline 0,100,0,150\r\n\tpop()\r\n\r\nxdraw = ->\r\n\tbg 0\r\n\tfc()\r\n\timage img, 0,0, width,height, cx-width/SCALE/2, cy-height/SCALE/2, width/SCALE, height/SCALE\r\n\tdrawTrack()\r\n\tdrawPoints()\r\n\tdrawCompass()\r\n\tdrawButtons()\r\n\ttextSize 50\r\n\tfor message,i in messages\r\n\t\ttext message,width/2,50*(i+1)\r\n\r\n# touchEnded = ->            # to make Android work\r\n# \treleased = true             # to make Android work\r\n# \tmessages.push 'touchEnded'\r\n# \tfalse       # to make Android work\r\n\r\n# touchStarted = -> \r\n# \tif not released then return false # to make Android work\r\n# \treleased = false            # to make Android work\r\n# \tfor button in buttons\r\n# \t\tif button.contains mouseX,mouseY then button.click()\r\n# \tmessages.push \"touchStarted #{points.length}\"\r\n# \txdraw()\r\n# \tfalse       # to make Android work\r\n\r\n# mouseReleased = ->            # to make Android work\r\n# \treleased = true             # to make Android work\r\n# \tmessages.push 'mouseReleased'\r\n# \tfalse                       # to make Android work\r\n\r\n# mousePressed = ->\r\n# \tif not released then return false # to make Android work\r\n# \treleased = false            # to make Android work\r\n# \tfor button in buttons\r\n# \t\tif button.contains mouseX,mouseY then button.click()\r\n# \tmessages.push \"mousePressed #{points.length}\"\r\n# \tfalse                       # to make Android work\r\n\r\n# mouseReleased = ->\r\n# \treleased = true\r\n# \tmessages.push 'mouseReleased'\r\n# \tfalse\r\n\r\n# mousePressed = ->\r\n# \tif not released then return false\r\n# \treleased = false \r\n# \tcounter += 1\r\n# \tmessages.push \"mousePressed #{counter}\"\r\n# \tfalse\r\n"
  ]
}