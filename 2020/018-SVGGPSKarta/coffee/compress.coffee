letters = 'abcdefghijklmnopqrstuvwx*ABCDEFGHIJKLMNOPQRSTUVWX'

#-3     0 1 2 3
#
# a b c d e f g  -3
# h i j k l m n  -2
# o p q r s t u  -1
# v w x * A B C   0
# D E F G H I J   1
# K L M N O P Q   2
# R S T U V W X   3

#pairs = [[1017,1373],[1016,1378],[1016,1383],[1017,1388],[1015,1393],[1013,1398],[1010,1403],[1006,1406],[1003,1410],[1001,1415],[996,1417],[993,1421],[992,1426],[991,1431],[988,1435],[984,1439],[979,1441],[973,1443],[969,1445],[964,1448],[959,1448],[954,1448],[951,1452],[949,1457],[944,1460],[939,1461],[934,1463],[929,1465],[924,1468],[919,1470],[917,1475],[914,1480],[910,1484],[907,1488],[901,1491],[899,1495],[898,1500],[896,1505],[894,1510],[894,1515],[897,1519],[901,1522],[905,1526],[906,1531],[904,1536],[902,1541],[901,1547],[897,1549],[895,1554],[892,1559],[894,1564],[893,1569],[888,1567],[882,1567],[878,1565],[874,1568],[869,1569],[866,1573],[861,1574],[856,1574],[852,1571],[849,1567],[843,1566],[838,1563],[833,1562],[830,1559],[827,1555],[823,1551],[820,1546],[815,1544],[811,1540],[807,1537],[804,1533],[800,1529],[802,1524],[798,1521],[792,1520],[787,1519],[782,1521],[777,1521],[771,1523],[766,1523],[761,1522],[757,1519],[753,1516],[750,1513],[746,1510],[741,1508],[736,1504],[733,1501],[730,1498],[725,1496],[720,1496],[715,1497],[710,1498],[705,1498],[699,1497],[695,1495],[690,1493],[685,1489],[682,1485],[678,1482],[674,1479],[670,1476],[667,1472],[664,1467],[661,1463],[657,1460],[653,1456],[653,1451],[654,1446],[656,1441],[657,1436],[657,1430],[656,1425],[655,1420]]

pairs = [[-603,2270],[-609,2254],[-610,2254],[-610,2255],[-612,2252],[-613,2247],[1312,1472],[1311,1473],[1310,1473],[1309,1475],[1307,1476],[1308,1476],[1308,1475],[1307,1475],[1307,1475],[1307,1475],[1306,1475],[1306,1475],[1306,1475],[1306,1475],[1306,1475],[1306,1475],[1306,1476],[1307,1476],[1307,1476],[1307,1476],[1307,1476],[1307,1476],[1307,1475],[1306,1475],[1307,1473],[1308,1472],[1308,1471],[1308,1472],[1307,1472],[1307,1472],[1307,1473],[1307,1473],[1308,1473],[1308,1473],[1308,1472],[1308,1472],[1309,1473],[1308,1473],[1308,1474],[1308,1475],[1307,1475],[1308,1476],[1308,1476],[1308,1476],[1308,1476],[1307,1476],[1307,1476],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1307,1475],[1306,1475],[1306,1475],[1306,1475],[1306,1475],[1306,1475],[1306,1474],[1306,1474],[1306,1474],[1306,1474],[1306,1474],[1306,1474],[1306,1474],[1306,1474],[1306,1474],[1306,1474],[1306,1474],[1307,1474],[1307,1473],[1308,1473],[1309,1472],[1310,1472],[1310,1471],[1311,1471],[1312,1470],[1313,1470],[1314,1470],[1314,1469],[1315,1469],[1316,1469],[1317,1468],[1318,1468],[1319,1468],[1320,1467],[1320,1467],[1322,1467],[1323,1466],[1323,1466],[1324,1466],[1324,1465],[1325,1464],[1325,1464],[1325,1464],[1325,1464],[1326,1463],[1326,1463],[1326,1463],[1326,1463],[1327,1463],[1327,1462],[1327,1462],[1327,1462],[1327,1462],[1327,1461],[1327,1461],[1327,1461],[1327,1461],[1327,1461],[1327,1461],[1326,1458],[1383,1437],[1388,1435],[1389,1435],[1389,1435],[1389,1435],[1389,1436],[1389,1436],[1388,1437],[1388,1438],[1388,1438],[1388,1438],[1389,1438],[1389,1438],[1388,1438],[1388,1438],[1388,1438],[1388,1438],[1388,1438],[1388,1438],[1388,1438],[1389,1438],[1389,1438],[1389,1438],[1389,1439],[1390,1439],[1389,1439],[1389,1440],[1389,1439],[1389,1439],[1389,1438],[1389,1438],[1389,1438],[1390,1438],[1390,1438],[1390,1439],[1390,1438],[1390,1438],[1389,1438],[1389,1438],[1389,1437],[1390,1437],[1390,1436],[1390,1436],[1390,1435],[1390,1435],[1390,1435],[1390,1435],[1390,1435],[1390,1435],[1390,1435],[1390,1434],[1390,1434],[1391,1434],[1391,1434],[1391,1434],[1392,1434],[1393,1434],[1394,1434],[1394,1434],[1395,1434],[1396,1433],[1397,1433],[1397,1433],[1398,1432],[1399,1431],[1399,1430],[1400,1429],[1401,1429],[1401,1428],[1401,1428],[1402,1427],[1403,1426],[1403,1425],[1404,1424],[1405,1424],[1405,1423],[1406,1423],[1406,1422],[1407,1422],[1407,1421],[1408,1421],[1409,1421],[1409,1421],[1410,1420],[1410,1420],[1412,1420],[1412,1420],[1412,1420],[1413,1420],[1414,1420],[1414,1420],[1415,1420],[1415,1420],[1416,1420],[1417,1420],[1417,1420],[1418,1420],[1419,1420],[1419,1420],[1420,1420],[1421,1419],[1422,1419],[1422,1419],[1423,1418],[1423,1418],[1424,1417],[1424,1417],[1425,1416],[1425,1416],[1426,1416],[1426,1415],[1427,1415],[1427,1415],[1427,1414],[1428,1414],[1428,1413],[1429,1413],[1429,1413],[1429,1412],[1430,1412],[1430,1411],[1430,1411],[1431,1410],[1431,1410],[1431,1409],[1432,1409],[1432,1408],[1432,1408],[1432,1407],[1432,1406],[1432,1405],[1432,1405],[1433,1404],[1433,1404],[1433,1404],[1434,1403],[1434,1403],[1436,1402],[1436,1402],[1437,1401],[1437,1401],[1438,1401],[1439,1400],[1440,1400],[1440,1400],[1441,1400],[1442,1400],[1442,1400],[1443,1400],[1444,1400],[1444,1400],[1445,1400],[1445,1400],[1446,1401],[1447,1400],[1447,1400],[1448,1400],[1448,1400],[1449,1400],[1449,1400],[1450,1400],[1451,1399],[1451,1399],[1452,1399],[1452,1399],[1453,1398],[1454,1398],[1454,1398],[1455,1397],[1455,1397],[1456,1397],[1456,1396],[1457,1396],[1457,1396],[1458,1396],[1458,1396],[1459,1395],[1459,1395],[1460,1395],[1460,1395],[1460,1395],[1461,1394],[1461,1394],[1462,1394],[1462,1393],[1463,1393],[1464,1393],[1464,1392],[1465,1392],[1465,1392],[1466,1392],[1467,1392],[1467,1392],[1468,1392],[1469,1392],[1469,1392],[1470,1392],[1470,1392],[1471,1392],[1472,1392],[1473,1392],[1473,1392],[1474,1392],[1475,1392],[1476,1392],[1476,1392],[1477,1392],[1477,1392],[1479,1392],[1479,1391],[1480,1391],[1481,1391],[1482,1391],[1483,1391],[1484,1390],[1484,1390],[1485,1390],[1485,1390],[1486,1389],[1487,1389],[1487,1388],[1488,1388],[1489,1387],[1489,1387],[1490,1386],[1491,1386],[1491,1386],[1491,1385],[1492,1384],[1492,1384],[1493,1383],[1493,1382],[1493,1382],[1494,1381],[1495,1380],[1495,1380],[1496,1379],[1497,1378],[1498,1377],[1499,1377],[1499,1376],[1500,1376],[1501,1375],[1501,1375],[1502,1374],[1502,1374],[1503,1373],[1503,1373],[1504,1372],[1505,1372],[1505,1371],[1506,1370],[1507,1370],[1507,1369],[1508,1368],[1508,1368],[1509,1367],[1510,1367],[1511,1366],[1512,1366],[1513,1365],[1513,1365],[1514,1364],[1514,1364],[1515,1363],[1516,1363],[1516,1362],[1516,1362],[1517,1361],[1517,1361],[1518,1360],[1518,1360],[1518,1359],[1519,1359],[1519,1358],[1520,1357],[1520,1357],[1521,1356],[1521,1355],[1521,1354],[1521,1354],[1521,1353],[1521,1352],[1522,1352],[1522,1351],[1522,1351],[1522,1349],[1523,1349],[1523,1348],[1524,1347],[1525,1346],[1525,1346],[1526,1345],[1527,1345],[1527,1344],[1528,1344],[1528,1344],[1529,1343],[1529,1343],[1530,1342],[1531,1342],[1531,1341],[1531,1341],[1532,1340],[1532,1340],[1532,1339],[1532,1339],[1532,1338],[1532,1337],[1533,1337],[1533,1336],[1533,1336],[1533,1335],[1532,1335],[1532,1335],[1532,1334],[1531,1335],[1531,1335],[1531,1335],[1530,1335],[1530,1336],[1530,1336],[1529,1337],[1529,1337],[1529,1337],[1529,1337],[1529,1337],[1529,1337],[1529,1337],[1529,1337],[1529,1337],[1529,1338],[1529,1338],[1529,1338],[1529,1340],[1529,1340],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1529,1341],[1530,1340],[1528,1335],[1524,1331],[1521,1327],[1517,1322],[1514,1319],[1510,1316],[1506,1313],[1503,1308],[1501,1303],[1500,1298],[1496,1294],[1493,1290],[1490,1286],[1487,1283],[1483,1280],[1480,1277],[1478,1272],[1480,1277],[1475,1278],[1470,1277],[1466,1274],[1462,1271],[1458,1268],[1453,1267],[1448,1267],[1442,1267],[1438,1264],[1434,1261],[1429,1261],[1425,1265],[1424,1260],[1426,1254],[1422,1252],[1417,1253],[1411,1254],[1406,1255],[1403,1251],[1401,1246],[1399,1241],[1396,1236],[1395,1232],[1394,1227],[1394,1222],[1395,1216],[1396,1212],[1396,1207],[1398,1202],[1401,1197],[1403,1192],[1403,1186],[1404,1180],[1404,1175],[1406,1170],[1407,1165],[1405,1160],[1401,1156],[1396,1154],[1391,1153],[1386,1152],[1381,1151],[1379,1146],[1380,1141],[1382,1137],[1376,1134],[1372,1133],[1368,1130],[1364,1127],[1365,1122],[1368,1118],[1369,1113],[1369,1108],[1365,1104],[1364,1099],[1364,1093],[1362,1088],[1362,1083],[1361,1078],[1358,1074],[1353,1071],[1349,1068],[1344,1065],[1340,1062],[1336,1060],[1331,1058],[1326,1057],[1321,1054],[1318,1050],[1317,1044],[1318,1039],[1319,1034],[1320,1028],[1321,1023],[1322,1018],[1321,1013],[1321,1008],[1320,1003],[1318,998],[1318,993],[1318,988],[1320,982],[1321,977],[1322,972],[1322,967],[1321,962],[1322,956],[1326,952],[1330,948],[1333,945],[1337,941],[1340,937],[1343,933],[1347,930],[1353,929],[1358,928],[1364,928],[1369,927],[1374,926],[1379,926],[1384,927],[1389,928],[1394,927],[1399,926],[1404,928],[1408,932],[1411,936],[1415,939],[1420,941],[1424,943],[1429,945],[1434,948],[1438,951],[1443,952],[1448,950],[1453,949],[1458,949],[1463,946],[1466,941],[1468,936],[1467,931],[1467,926],[1465,921],[1464,916],[1468,912],[1471,907],[1470,903],[1466,899],[1461,896],[1459,891],[1456,887],[1453,883],[1450,878],[1448,874],[1447,869],[1446,864],[1445,858],[1445,854],[1444,849],[1443,843],[1441,837],[1440,833],[1437,828],[1432,825],[1428,822],[1423,820],[1418,817],[1414,814],[1409,812],[1405,809],[1400,807],[1395,805],[1391,803],[1386,801],[1381,801],[1376,800],[1370,799],[1365,799],[1360,801],[1355,800],[1351,796],[1347,793],[1342,791],[1339,787],[1338,782],[1335,778],[1332,774],[1329,770],[1326,766],[1321,763],[1315,763],[1311,762],[1307,758],[1303,755],[1298,753],[1293,753],[1288,754],[1283,755],[1278,755],[1273,753],[1268,755],[1272,752],[1277,751],[1282,753],[1287,752],[1292,750],[1295,745],[1294,740],[1297,735],[1302,734],[1306,737],[1311,737],[1316,738],[1321,738],[1326,738],[1327,733],[1332,732],[1336,728],[1338,723],[1341,719],[1345,716],[1349,713],[1353,709],[1358,706],[1362,704],[1366,701],[1367,695],[1368,690],[1370,685],[1370,680],[1370,675],[1371,670],[1372,665],[1376,662],[1377,657],[1373,653],[1368,651],[1363,651],[1358,653],[1355,648],[1352,644],[1350,639],[1348,634],[1345,629],[1344,624],[1341,619],[1339,615],[1334,613],[1334,607],[1333,602],[1331,597],[1328,592],[1323,589],[1318,588],[1312,587],[1307,586],[1302,584],[1297,582],[1291,581],[1286,581],[1282,577],[1279,572],[1276,568],[1271,565],[1266,563],[1261,561],[1255,562],[1251,564],[1246,565],[1241,564],[1236,563],[1237,558],[1237,553],[1233,550],[1228,548],[1225,543],[1228,538],[1229,533],[1230,527],[1228,522],[1227,517],[1222,514],[1218,511],[1213,508],[1208,506],[1204,502],[1200,497],[1196,495],[1195,490],[1189,489],[1184,486],[1179,486],[1174,485],[1168,485],[1164,485],[1159,483],[1154,480],[1149,478],[1144,475],[1141,471],[1143,466],[1140,462],[1136,458],[1137,453],[1136,448],[1133,443],[1130,439],[1130,434],[1131,429],[1133,424],[1131,419],[1128,414],[1126,410],[1121,408],[1116,405],[1112,402],[1108,398],[1107,393],[1108,388],[1107,383],[1105,378]]
# -603,2270|jjjkjjjkxGbckntttttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntttttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBtttBtttBntttttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntttttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBtttBtttBntttttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntttttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBtttBtttBntttttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBtttBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBntBtttBtttBtttBFxMEArxxGArxlsrGxGArHxGGxHxrxrArAsArAsAArAAsAAsBsArssArrcntBntBntButBntButBntBtBtBtuAGFGAxAGAxGrrAGrxrArrrAAAAAsAssrsArssrsArArArAAsBAAAAAAAAsAsssArArArArArsrArrrrsstsAsAAAAAAHsAAAsAsAsArAAsAsArAArAAAAAAAAAAAAABrAAAAsAsArAssArssrsssssArAssssArsArssAsAsssArssrArssrrrrArkArsssArAssArsrrrArrxrFxGFGNGscjiiijbiaipipbjcjckiiijijaipacjOVvEowipipipowvwvvipipvwLLckeeppvEvDvEijcjcjbjjkckdkdekldkelemeldddedkeldlcjiiopowowowcjdlllhopwipipdllmdldkiickddcjdkckijhpiphpipppopowhpijcddldldedldlckdkckcjdkdkeedldldkckdemmmmgmmlmlmmtuCtCCCtCtCBCBJBJtCtCIJPPOPIPIJIIIJIQIPBJtutCBCmuemelckdkcjckmmemjkiihpcjijijbjjjckckcdkkckcdccjkbjhpipophpipopipopopppopvwowovvwDEowiiipopijckijijijijhpvvpwiiipopvwvEvEvwopDEmttCIJtCtuemckemtCIPBCBJBCBCdltCmmellmmtmtmmmuttmtdedleldkdkdldlmtdliiopvwDEbjijcjcjbjckbjjjopddckcjbjhpowovowopopovvwiibjijhpopopvDEEvEowowdldkipopbjemdldecjckhpiphpopiibippckovhpvwowvvwwophpophpijelijiidlckbjijdkdlelcjbjjjophpipiickdlckcj

encode = ([x,y]) ->
	if x == 0 and y == 0 then return ""
	if Math.abs(x) <= 3 and Math.abs(y) <= 3 then return letters[(x+3) + 7 * (y+3)]
	[x0,y0] = [Math.floor(x/2), Math.floor(y/2)]
	[x1,y1] = [x-x0,y-y0]
	encode([x0,y0]) + encode([x1,y1])

assert 'a', encode [-3,-3]
assert 'r', encode [0,-1]
assert 'x', encode [-1,0]
assert '', encode [0,0]
assert 'A', encode [1,0]
assert 'G', encode [0,1]
assert 'X', encode [3,3]
assert 'aa', encode [-6,-6]
assert 'XX', encode [6,6]
assert 'mm', encode [4,-4]
assert 'CJ', encode [6,1]

decode = (s) -> 
	index = letters.indexOf s
	[index % 7 - 3, Math.floor(index / 7)-3]

assert [-3,-3], decode 'a'
assert [0,-1], decode 'r'
assert [-1,0], decode 'x'
#assert [0,0], decode 'y'
assert [1,0], decode 'A'
assert [0,1], decode 'G'
assert [3,3], decode 'X'

encodeAll = (pairs) ->
	[x,y] = pairs[0]
	result = "#{x},#{y}|" 
	for i in range 1,pairs.length
		[x0,y0] = pairs[i-1]
		[x1,y1] = pairs[i]
		[dx,dy] = [x1-x0, y1-y0]
		if dx != 0 or dy != 0 then result += encode [dx,dy]
	result
console.log encodeAll pairs

decodeAll = (s) ->
	result = []
	arr = s.split '|'
	pair = arr[0].split ','
	x = parseInt pair[0]
	y = parseInt pair[1]
	result.push [x,y]
	for ch in arr[1]
		[dx,dy] = decode ch
		x += dx
		y += dy
		result.push [x,y]
	result
console.log decodeAll '1017,1373|MUNUNVMTMTLTELLMMTDELMMUMULMLLDEDDEEDLvwvwLMMTDLvEDEDEDLDEMTLTLLLMDKMMMUMTMTNUOPIPPPNVMTMTTUEEMTLTOVMUopvvppELvELMvEvwipijovhpowaijiibjopiiipijiielipovowDEvwDDvwowipipaipophiaaopvwvEvEvwovppophiijipipipijbjijipiidkdleldlddckck'
