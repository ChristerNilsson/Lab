// Generated by CoffeeScript 2.4.1
var Database, PATH, PORT, _, app, db, express, fs;

fs = require('fs');

_ = require('lodash');

PATH = 'db.txt';

express = require('express');

app = express();

app.use(express.urlencoded({
  extended: false // req.body
}));


// Todo:
// ID   1..
// Text "Feed the Cat"
// Done false
Database = class Database {
  constructor() {
    this.clear();
    this.demo();
  }

  read() {
    return Object.assign(this, JSON.parse(fs.readFileSync(PATH, 'utf-8')));
  }

  write() {
    return fs.writeFileSync(PATH, JSON.stringify(this));
  }

  add(text) {
    this.todos.push({
      id: ++this.last,
      text: text,
      done: false
    });
    return this.write();
  }

  clear() {
    this.todos = [];
    this.last = 0;
    return this.write();
  }

  delete(id) {}

  demo() {
    var i, len, ref, results, text;
    ref = 'buy food|fetch lamps|walk dog|feed cat|köp räksmörgåsar'.split('|');
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      text = ref[i];
      results.push(this.add(text));
    }
    return results;
  }

};

db = new Database();

app.post('/todos/demo', function(req, res) {
  db.clear();
  db.demo();
  return res.send(db.todos);
});

app.post('/todos', function(req, res) {
  db.add(req.body.text);
  return res.send(_.last(db.todos));
});

app.get('/todos', function(req, res) {
  return res.send(db.todos);
});

app.get('/todos/:id', function(req, res) {
  return res.send(db.todos.find(function(todo) {
    return todo.id === parseInt(req.params.id);
  }));
});

app.put('/todos', function(req, res) {
  var todo;
  todo = db.todos.find(function(todo) {
    return todo.id === parseInt(req.body.id);
  });
  todo.text = req.body.text;
  todo.done = JSON.parse(req.body.done);
  db.write();
  return res.send(todo);
});

app.delete('/todos', function(req, res) {
  var count;
  count = db.todos.length;
  db.clear();
  return res.send(`${count} items was deleted`);
});

app.delete('/todos/:id', function(req, res) {
  var id;
  id = parseInt(req.params.id);
  db.todos = db.todos.filter(function(todo) {
    return todo.id !== id;
  });
  db.write();
  return res.send(`The item with id=${id} was deleted`);
});

PORT = process.env.PORT || 3000;

app.listen(PORT, function() {
  return console.log(`Server started on port ${PORT}`);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcaW5kZXguY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLFFBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQTs7QUFBQSxFQUFBLEdBQUssT0FBQSxDQUFRLElBQVI7O0FBQ0wsQ0FBQSxHQUFJLE9BQUEsQ0FBUSxRQUFSOztBQUNKLElBQUEsR0FBTzs7QUFFUCxPQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsR0FBQSxHQUFNLE9BQUEsQ0FBQTs7QUFDTixHQUFHLENBQUMsR0FBSixDQUFRLE9BQU8sQ0FBQyxVQUFSLENBQW1CO0VBQUUsUUFBQSxFQUFVLEtBQVo7QUFBQSxDQUFuQixDQUFSLEVBTkE7Ozs7Ozs7QUFhTSxXQUFOLE1BQUEsU0FBQTtFQUNDLFdBQWMsQ0FBQSxDQUFBO0lBQ2IsSUFBQyxDQUFBLEtBQUQsQ0FBQTtJQUNBLElBQUMsQ0FBQSxJQUFELENBQUE7RUFGYTs7RUFJZCxJQUFPLENBQUEsQ0FBQTtXQUFHLE1BQU0sQ0FBQyxNQUFQLENBQWMsSUFBZCxFQUFvQixJQUFJLENBQUMsS0FBTCxDQUFXLEVBQUUsQ0FBQyxZQUFILENBQWdCLElBQWhCLEVBQXFCLE9BQXJCLENBQVgsQ0FBcEI7RUFBSDs7RUFDUCxLQUFRLENBQUEsQ0FBQTtXQUFHLEVBQUUsQ0FBQyxhQUFILENBQWlCLElBQWpCLEVBQXVCLElBQUksQ0FBQyxTQUFMLENBQWUsSUFBZixDQUF2QjtFQUFIOztFQUVSLEdBQU0sQ0FBQyxJQUFELENBQUE7SUFDTCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQVgsQ0FBZ0I7TUFBQyxFQUFBLEVBQUksRUFBRSxJQUFDLENBQUEsSUFBUjtNQUFjLElBQUEsRUFBTSxJQUFwQjtNQUEwQixJQUFBLEVBQU07SUFBaEMsQ0FBaEI7V0FDQSxJQUFDLENBQUEs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S0FBSCxHQUFXLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBVCxDQUFnQixRQUFBLENBQUMsSUFBRCxDQUFBO1dBQVUsSUFBSSxDQUFDLEVBQUwsS0FBVztFQUFyQixDQUFoQjtFQUNYLEVBQUUsQ0FBQyxLQUFILENBQUE7U0FDQSxHQUFHLENBQUMsSUFBSixDQUFTLENBQUEsaUJBQUEsQ0FBQSxDQUFvQixFQUFwQixDQUF1QixZQUF2QixDQUFUO0FBSndCLENBQXpCOztBQU1BLElBQUEsR0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQVosSUFBb0I7O0FBQzNCLEdBQUcsQ0FBQyxNQUFKLENBQVcsSUFBWCxFQUFpQixRQUFBLENBQUEsQ0FBQTtTQUFHLE9BQU8sQ0FBQyxHQUFSLENBQVksQ0FBQSx1QkFBQSxDQUFBLENBQTBCLElBQTFCLENBQUEsQ0FBWjtBQUFILENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiZnMgPSByZXF1aXJlICdmcydcbl8gPSByZXF1aXJlICdsb2Rhc2gnXG5QQVRIID0gJ2RiLnR4dCdcblxuZXhwcmVzcyA9IHJlcXVpcmUgJ2V4cHJlc3MnXG5hcHAgPSBleHByZXNzKClcbmFwcC51c2UgZXhwcmVzcy51cmxlbmNvZGVkIHsgZXh0ZW5kZWQ6IGZhbHNlIH0gIyByZXEuYm9keVxuXG4jIFRvZG86XG4jIElEICAgMS4uXG4jIFRleHQgXCJGZWVkIHRoZSBDYXRcIlxuIyBEb25lIGZhbHNlXG5cbmNsYXNzIERhdGFiYXNlIFxuXHRjb25zdHJ1Y3RvciA6ICgpIC0+IFxuXHRcdEBjbGVhcigpXG5cdFx0QGRlbW8oKVxuXG5cdHJlYWQgOiAtPiBPYmplY3QuYXNzaWduIHRoaXMsIEpTT04ucGFyc2UgZnMucmVhZEZpbGVTeW5jIFBBVEgsJ3V0Zi04J1xuXHR3cml0ZSA6IC0+IGZzLndyaXRlRmlsZVN5bmMgUEFUSCwgSlNPTi5zdHJpbmdpZnkgdGhpc1xuXG5cdGFkZCA6ICh0ZXh0KSAtPlxuXHRcdHRoaXMudG9kb3MucHVzaCB7aWQ6ICsrQGxhc3QsIHRleHQ6IHRleHQsIGRvbmU6IGZhbHNlfVxuXHRcdEB3cml0ZSgpXG5cblx0Y2xlYXIgOiAoKSAtPlxuXHRcdHRoaXMudG9kb3MgPSBbXVxuXHRcdHRoaXMubGFzdCA9IDBcblx0XHRAd3JpdGUoKVxuXG5cdGRlbGV0ZSA6IChpZCkgLT5cblx0ZGVtbyA6IC0+XG5cdFx0QGFkZCB0ZXh0IGZvciB0ZXh0IGluICdidXkgZm9vZHxmZXRjaCBsYW1wc3x3YWxrIGRvZ3xmZWVkIGNhdHxrw7ZwIHLDpGtzbcO2cmfDpXNhcicuc3BsaXQgJ3wnXG5cbmRiID0gbmV3IERhdGFiYXNlKClcblxuYXBwLnBvc3QgJy90b2Rvcy9kZW1vJywgKHJlcSwgcmVzKSAtPlxuXHRkYi5jbGVhcigpXG5cdGRiLmRlbW8oKVxuXHRyZXMuc2VuZCBkYi50b2Rvc1xuXG5hcHAucG9zdCAnL3RvZG9zJywgKHJlcSwgcmVzKSAtPlxuXHRkYi5hZGQgcmVxLmJvZHkudGV4dFxuXHRyZXMuc2VuZCBfLmxhc3QgZGIudG9kb3NcblxuYXBwLmdldCAnL3RvZG9zJywgKHJlcSwgcmVzKSAtPiByZXMuc2VuZCBkYi50b2Rvc1xuYXBwLmdldCAnL3RvZG9zLzppZCcsIChyZXEsIHJlcykgLT4gcmVzLnNlbmQgZGIudG9kb3MuZmluZCAodG9kbykgLT4gdG9kby5pZCA9PSBwYXJzZUludCByZXEucGFyYW1zLmlkXG5cbmFwcC5wdXQgJy90b2RvcycsIChyZXEsIHJlcykgLT4gXG5cdHRvZG8gPSBkYi50b2Rvcy5maW5kICh0b2RvKSAtPiB0b2RvLmlkID09IHBhcnNlSW50IHJlcS5ib2R5LmlkXG5cdHRvZG8udGV4dCA9IHJlcS5ib2R5LnRleHRcblx0dG9kby5kb25lID0gSlNPTi5wYXJzZSByZXEuYm9keS5kb25lXG5cdGRiLndyaXRlKClcblx0cmVzLnNlbmQgdG9kb1xuXG5hcHAuZGVsZXRlICcvdG9kb3MnLCAocmVxLCByZXMpIC0+XG5cdGNvdW50ID0gZGIudG9kb3MubGVuZ3RoXG5cdGRiLmNsZWFyKClcblx0cmVzLnNlbmQgXCIje2NvdW50fSBpdGVtcyB3YXMgZGVsZXRlZFwiXG5hcHAuZGVsZXRlICcvdG9kb3MvOmlkJywgKHJlcSwgcmVzKSAtPlxuXHRpZCA9IHBhcnNlSW50IHJlcS5wYXJhbXMuaWRcblx0ZGIudG9kb3MgPSBkYi50b2Rvcy5maWx0ZXIgKHRvZG8pIC0+IHRvZG8uaWQgIT0gaWRcblx0ZGIud3JpdGUoKVxuXHRyZXMuc2VuZCBcIlRoZSBpdGVtIHdpdGggaWQ9I3tpZH0gd2FzIGRlbGV0ZWRcIlxuXG5QT1JUID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCAzMDAwXG5hcHAubGlzdGVuIFBPUlQsIC0+IGNvbnNvbGUubG9nIFwiU2VydmVyIHN0YXJ0ZWQgb24gcG9ydCAje1BPUlR9XCJcbiJdfQ==
//# sourceURL=c:\Lab\LiveShare\084B-ToDo-API-Express\coffee\index.coffee