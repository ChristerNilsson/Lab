{
  "version": 3,
  "file": "RLKPage.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\RLKPage.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "class RLKPage extends Page # Riksdag, Landsting, Kommun\r\n\r\n\tconstructor : (x,y,w,h,cols=1) ->\r\n\t\tsuper x,y,w,h,cols\r\n\t\t@sbuttons = []\r\n\t\t@start = new Date().getTime()\r\n\t\t@qr = '0000000000'\r\n\r\n\t\tAES_Init()\r\n\t\t@key = new Array 32\r\n\t\tfor i in range 32\r\n\t\t\t@key[i] = i\r\n\t\tAES_ExpandKey @key\r\n\r\n\t\th = height/51\r\n\t\t@yoff = [@y+0,@y+16*h,@y+32*h,@y+48*h]\r\n\r\n\t\t@selectedPersons = {R:[], L:[], K:[]}\r\n\r\n\t\t@addButton new RLKButton 'R', 'Riksdag',@x,@yoff[0],@w-0,3*h-3, -> \r\n\t\t\tpages.partier.select 'R',dbTree.R\r\n\t\t\t@page.selected = @\r\n\r\n\t\t@addButton new RLKButton 'L', dbName.L, @x,@yoff[1],@w-0,3*h-3, ->\r\n\t\t\tpages.partier.select 'L',dbTree.L\r\n\t\t\t@page.selected = @\r\n\r\n\t\t@addButton new RLKButton 'K', dbName.K, @x,@yoff[2],@w-0,3*h-3, ->\r\n\t\t\tpages.partier.select 'K',dbTree.K\r\n\t\t\t@page.selected = @\r\n\r\n\t\t@addButton new Button 'Utskrift', @x,@yoff[3],@w/3-2,3*h-3, ->\r\n\t\t\tpageStack.push pages.utskrift\r\n\t\t\tpages.utskrift.stopMeasuringTime()\r\n\t\t\tqr = @page.getQR()\r\n\t\t\t@page.crc = @page.getCRC qr\r\n\r\n\t\t\tkopia = qr.slice()\r\n\t\t\tassert qr, @page.decrypt @page.encrypt kopia\r\n\r\n\t\t\t@page.qr = kommunkod + @page.encrypt qr\r\n\t\t\tqrcode = new QRCode document.getElementById(\"qrcode\"),\r\n\t\t\t\ttext: @page.qr\r\n\t\t\t\twidth: 0.25*width\r\n\t\t\t\theight: 0.25*width\r\n\t\t\t\tcolorDark : \"#000000\"\r\n\t\t\t\tcolorLight : \"#ffffff\"\r\n\t\t\t\tcorrectLevel : QRCode.CorrectLevel.L # Low Medium Q High\r\n\r\n\t\t@addButton new Button 'Rensa', @x+@w/3,@yoff[3],@w/3-2,3*h-3, ->\r\n\t\t\trensa()\r\n\r\n\t\t@addButton new Button 'Byt kommun', @x+2*@w/3,@yoff[3],@w/3-0,3*h-3, -> \r\n\t\t\tpageStack.push pages.kommun\r\n\r\n\taddsButton : (button) -> \r\n\t\tbutton.page = @\r\n\t\t@sbuttons.push button\r\n\r\n\tgetCRC : (qr) ->\r\n\t\tres = 0\r\n\t\tfor char,i in qr\r\n\t\t\tindex = char\r\n\t\t\tif i%16 != 15 then res += (i+1) * (index+1)\r\n\t\t\tres %= 1000000\r\n\t\tres\r\n\r\n\tencryptBlock : (block,key) -> AES_Encrypt block, key\r\n\tdecryptBlock : (block,key) -> AES_Decrypt block, key\r\n\r\n\t# kryptering sker via server. Inga nycklar i javascriptkoden!\r\n\tencrypt : (qr) -> # 48 bytes => string\r\n\t\tres = []\r\n\t\tfor i in range 3\r\n\t\t\tblock = qr.slice 16*i,16*(i+1)\r\n\t\t\t@encryptBlock block,key\r\n\t\t\tres = res.concat block\r\n\t\t(String.fromCharCode byte for byte in res).join ''\r\n\r\n\tdecrypt : (s) -> # 48 bytes => string\r\n\t\tqr = (s.charCodeAt i for i in range s.length)\r\n\t\tres = []\r\n\t\tfor i in range 3\r\n\t\t\tblock = qr.slice 16*i,16*(i+1)\r\n\t\t\t@decryptBlock block,key\r\n\t\t\tres = res.concat block.slice()\r\n\t\tres\r\n\r\n\tgetQR : -> \r\n\t\tsave3 = (nr) ->\r\n\t\t\tfor i in range 3\r\n\t\t\t\tdata.push nr % 256\r\n\t\t\t\tnr //= 256\r\n\r\n\t\tdata = [] # contains 48 bytes\r\n\r\n\t\tfor rlk of @selectedPersons\r\n\t\t\tpersons = @selectedPersons[rlk]\r\n\t\t\tfor i in range VOTES\r\n\t\t\t\tif i < persons.length \r\n\t\t\t\t\t[partikod,knr] = persons[i]\r\n\t\t\t\t\tsave3 if knr == 0 then 990000 + partikod else knr\r\n\t\t\t\telse\r\n\t\t\t\t\tsave3 0\r\n\t\t\tdata.push int random 256\r\n\r\n\t\tassert data.length,48\r\n\t\tdata\r\n\r\n\trender : ->\r\n\t\t@bg 0\r\n\t\tif @selected != null\r\n\t\t\tpush()\r\n\t\t\tfc 1\r\n\t\t\ttextAlign LEFT,CENTER\r\n\t\t\ttextSize 0.4 * pages.personer.h/17\r\n\t\t\tsc()\r\n\t\t\t[x,y] = [pages.partier.x, pages.partier.y+pages.partier.h/34]\r\n\t\t\tif @selected.rlk == 'R' then text 'Riksdag',x,y\r\n\t\t\tif @selected.rlk == 'L' then text dbName.L, x,y\r\n\t\t\tif @selected.rlk == 'K' then text dbName.K, x,y\r\n\t\t\tpop()\r\n\t\t@showSelectedPersons()\r\n\r\n\tclickDelete : (rlk,index) ->\r\n\t\t@selectedPersons[rlk].splice index,1 \t\r\n\t\t@createSelectButtons()\r\n\r\n\tclickSwap : (rlk,index) ->\r\n\t\tarr = @selectedPersons[rlk]\r\n\t\t[arr[index],arr[index-1]] = [arr[index-1],arr[index]]\r\n\t\t@createSelectButtons()\r\n\r\n\tcreateSelectButtons : ->\r\n\t\t@sbuttons = []\r\n\t\tw = @w\r\n\t\tdw = 0.02 * width\r\n\t\tdh = 0.025 * height\r\n\t\th = height/51\r\n\r\n\t\tfor rlk,persons of @selectedPersons\r\n\t\t\tindex = \"RLK\".indexOf rlk\r\n\t\t\tfor person,i in persons\r\n\t\t\t\tx1 = @x + dw\r\n\t\t\t\tx2 = @x + 0.93 * @w\r\n\t\t\t\ty = @yoff[index] + 4.7*h + 13*h/5*i\r\n\t\t\t\ty1 = y - 2.3 * h\r\n\t\t\t\ty2 = y - 0.9 * h\r\n\t\t\t\tdo (rlk,i) =>\r\n\t\t\t\t\tif i>0 then @addsButton new Button 'byt',x1, y1,dw,dh, => @clickSwap   rlk,i\r\n\t\t\t\t\t@addsButton             new Button ' x ',x2, y2,dw,dh, => @clickDelete rlk,i\r\n\r\n\tclickPersonButton : (person) -> # av typen [partikod,knr]\r\n\t\tpersons = @selectedPersons[@selected.rlk]\r\n\t\tfor pair,i in persons \r\n\t\t\tif pair[0] == person[0] # Finns partiet redan? I så fall: ersätt denna person med den nya.\r\n\t\t\t\tpersons[i][1] = person[1]\r\n\t\t\t\treturn \r\n\t\tif persons.length < VOTES\r\n\t\t\tpersons.push person\r\n\t\t\t@createSelectButtons()\r\n\r\n\tclickPartiButton : (button) ->\r\n\t\tpersons = @selectedPersons[@selected.rlk]\r\n\t\tfor pair,i in persons \r\n\t\t\t[partikod,knr] = pair\r\n\t\t\tif partikod == button.partikod then return \r\n\t\tif persons.length < VOTES\r\n\t\t\tpersons.push [button.partikod, 0]\r\n\t\t\t@createSelectButtons()\r\n\r\n\tsample : (hash,n) -> _.object ([key,hash[key]] for key in _.sample _.keys(hash),n)\r\n\r\n\tslumpa : ->\r\n\t\tfor rlk,partier of dbTree\r\n\t\t\t@selectedPersons[rlk] = []\r\n\t\t\tparties = @sample partier,5\r\n\t\t\tfor partikod,knrs of parties\r\n\t\t\t\tif random() < 0.2 # Vote for a party\r\n\t\t\t\t\tpair = [partikod,0]\r\n\t\t\t\telse # Vote for a person\r\n\t\t\t\t\tknr = _.sample knrs\r\n\t\t\t\t\tpair = [partikod,knr]\r\n\t\t\t\t@selectedPersons[rlk].push pair\r\n\t\r\n\tshowSelectedPersons : ->\r\n\t\tpush()\r\n\t\ttextAlign LEFT,CENTER\r\n\t\ttextSize 0.025 * height\r\n\t\tfor rlk,i in 'RLK'\r\n\t\t\tsc()\r\n\t\t\tsw 1 \r\n\t\t\trectMode CORNER\r\n\t\t\ty0 = @yoff[i]\r\n\t\t\tif i == 0 then fc 1,1,0.5     # gul \r\n\t\t\tif i == 1 then fc 0.5,0.75,1  # blå\r\n\t\t\tif i == 2 then fc 1           # vit\r\n\t\t\th = height/51\r\n\t\t\trect @x, y0+3*h-1, @w, 13*h-1\r\n\t\t\tfc 0\r\n\t\t\tsc()\r\n\t\t\tsw 0\r\n\r\n\t\t\tfor pair,j in @selectedPersons[rlk]\r\n\t\t\t\ty = y0 + 4.5*h + 13*h/5*j\r\n\t\t\t\t[partikod,knr] = pair\r\n\t\t\t\tparti = dbPartier[rlk][partikod][PARTI_FÖRKORTNING]\r\n\t\t\t\tnamn = if knr == 0 then dbPartier[rlk][partikod][PARTI_BETECKNING] else dbPersoner[rlk][knr][PERSON_NAMN]\r\n\t\t\t\ttext \"#{j+1} #{parti} - #{namn}\",@x+10,y\r\n\t\tpop()\r\n\r\n\t\tfor button in @sbuttons\r\n\t\t\tbutton.draw()\r\n\r\n\tmousePressed : ->\r\n\t\tfor button in @sbuttons\r\n\t\t\tif button.inside()\r\n\t\t\t\tbutton.click()\r\n\t\t\t\treturn true\r\n\t\tsuper()\r\n\r\nclass RLKButton extends Button\r\n\tconstructor : (@rlk, title,x,y,w,h,click = ->) ->\r\n\t\tsuper title, x,y,w,h,click\r\n"
  ]
}