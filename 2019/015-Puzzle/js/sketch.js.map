{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "N = 100\r\nbuttons = []\r\ngrid = null\r\noriginalGrid = null\r\ncurrent = 0\r\nlevel = 1\r\nstate = 0 # 0=Go 1=Solve 2=Go/Prev/Next\r\n\r\nclass Button\r\n\tconstructor : (@title,@x,@y,@w,@h,@textSize,@click) ->\r\n\t\t@active = true\r\n\tdraw : ->\r\n\t\ttextAlign CENTER,CENTER\r\n\t\ttextSize @textSize\r\n\t\tif @title == 0 then fill 0 \r\n\t\telse if @title =='Go' and @active then fill 0,255,0 else fill 255\r\n\t\trect N*@x,N*@y,@w,@h\r\n\t\tif @active\r\n\t\t\tfill 0\r\n\t\telse\r\n\t\t\tfill 128\r\n\t\tif @title != 0 then text @title,N*@x+@w/2,N*@y+@h/2\r\n\tinside : -> \r\n\t\t#(width-4*N)/2,(height-5*N)/2\r\n\t\tx = mouseX - (width-4*N)/2\r\n\t\ty = mouseY - (height-5*N)/2\r\n\t\t@active and N*@x < x < N*@x+@w and N*@y < y < N*@y+@h \r\n\r\nrandomMoveList = (grid, nMoves, moveList=[]) ->\r\n\tif moveList.length == nMoves then return moveList\r\n\r\n\tvalidMoves = grid.validMoves()\r\n\r\n\tif moveList.length > 0\r\n\t\t# Don't just revert the last move\r\n\t\tlast = _.last moveList\r\n\t\t[ldr, ldc] = directionToDelta last\r\n\t\tvalidMoves = _.filter validMoves, (m) ->\r\n\t\t\tnot directionsAreOpposites last, m\r\n\r\n\tsourceDirection = _.shuffle(validMoves)[0]\r\n\tnextGrid = grid.applyMoveFrom sourceDirection\r\n\tmoveList.push sourceDirection\r\n\r\n\trandomMoveList nextGrid, nMoves, moveList\r\n\r\ntransfer = ->\r\n\tfor i in range 16\r\n\t\tbuttons[i].title = grid.grid[i//4][i%%4]\r\n\r\nupdate = (delta) ->\r\n\tcurrent = constrain current+delta,0,window.solution.length\r\n\tgrid = originalGrid.applyMoves window.solution.slice 0,current\r\n\ttransfer()\r\n\r\ngoalReached = -> grid.isSolved()\r\n\r\ngoState = (newState) ->\r\n\tstate = newState\r\n\tvalues = \"1000 0100 1011\".split ' '\r\n\tfor button,i in buttons.slice 16,20\r\n\t\tbutton.active = values[state][i] == '1'\r\n\r\nwindowResized = -> resizeCanvas windowWidth, windowHeight\r\n\r\nsetup = ->\r\n\tcreateCanvas windowWidth,windowHeight\r\n\r\n\tfor i in range 16\r\n\t\tx = i%4\r\n\t\ty = i//4\r\n\t\tbuttons.push new Button i,x,y,N,N,60,->\r\n\t\t\t[y0,x0] = grid.emptyPos\r\n\t\t\tfor move in grid.validMoves()\r\n\t\t\t\tdx = x0-@x\r\n\t\t\t\tdy = y0-@y\r\n\t\t\t\tif abs(dx) + abs(dy) == 1\r\n\t\t\t\t\tif move == grid.positionToMove @y,@x\r\n\t\t\t\t\t\tgrid = grid.applyMoveFrom move\r\n\t\t\t\t\t\tother = buttons[x0+4*y0]\r\n\t\t\t\t\t\t[other.title,@title] = [@title,other.title]\r\n\t\t\tif goalReached() \r\n\t\t\t\tgoState 0\r\n\t\t\t\tlevel++\r\n\r\n\tbuttons.push new Button 'Go',0,5,N,N/2,30,->\r\n\t\tgoState 1\r\n\t\twindow.solution = []\r\n\t\tgrid = grid.applyMoves randomMoveList grid,level\r\n\t\ttransfer()\r\n\r\n\tbuttons.push new Button 'Solve',1,5,N,N/2,30,->\r\n\t\tif level > 1 then level--\r\n\t\twindow.solution = []\r\n\t\toriginalGrid = grid.copy()\r\n\t\tsolve grid\r\n\t\tgoState 2\r\n\r\n\tbuttons.push new Button 'Prev',2,5,N,N/2,30,-> update -1\r\n\tbuttons.push new Button 'Next',3,5,N,N/2,30,-> update +1\r\n\r\n\tgoState 0\r\n\r\n\tgrid = new Grid INIT_GRID, [3,3]\r\n\ttransfer()\r\n\r\ndraw = ->\r\n\ttranslate (width-4*N)/2,(height-5*N)/2\r\n\tbackground 128\r\n\tfor button in buttons\r\n\t\tbutton.draw()\r\n\tif solution.length > 0\r\n\t\ttextAlign CENTER,CENTER\r\n\t\tfill 255\r\n\t\ttext \"#{current} of #{solution.length}\", 3*N,4.5*N\r\n\tfill 255\r\n\ttext level,N,4.5*N\r\n\r\nmousePressed = ->\r\n\tfor button,i in buttons\r\n\t\tif button.inside() \r\n\t\t\tif (state==1 and i<16) or i>=16\r\n\t\t\t\tbutton.click()\r\n"
  ]
}