{
  "version": 3,
  "file": "sketch.js",
  "sourceRoot": "..",
  "sources": [
    "coffee\\sketch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "N = 150\r\nKEY = '015'\r\nbuttons = []\r\ngrid = null\r\noriginalGrid = null\r\ncurrent = 0\r\nlevel = null\r\nstate = 0 # 0=Go 1=Solve 2=Go/Prev/Next\r\nreleased = true \r\n\r\nclass Button\r\n\tconstructor : (@title,@x,@y,@w,@h,@textSize,@click) ->\r\n\t\t@active = true\r\n\tdraw : ->\r\n\t\ttextAlign CENTER,CENTER\r\n\t\ttextSize @textSize\r\n\t\tif @title == 0 then fill 0\r\n\t\telse if @title =='Go' and @active then fill 0,255,0 else fill 255\r\n\t\trect N*@x+2,N*@y+2,@w-4,@h-4,15\r\n\t\tfill if @active then 0 else 128\r\n\t\tif @title != 0 \r\n\t\t\ttext @title,N*@x+@w/2,N*@y+@h/2\r\n\tsetxy : (@x,@y) ->\r\n\tinside : -> \r\n\t\tif deviceOrientation == LANDSCAPE\r\n\t\t\tfactor = min width/6/N,height/4/N\r\n\t\telse # PORTRAIT or undefined\r\n\t\t\tfactor = min width/4/N,height/6/N\r\n\r\n\t\tx = mouseX / factor\r\n\t\ty = mouseY / factor\r\n\t\t@active and N*@x < x < N*@x+@w and N*@y < y < N*@y+@h\r\n\r\nrandomMoveList = (grid, nMoves, moveList=[]) ->\r\n\tif moveList.length == nMoves \r\n\t\tprint moveList\r\n\t\treturn moveList\r\n\r\n\tvalidMoves = grid.validMoves()\r\n\r\n\tif moveList.length > 0\r\n\t\t# Don't just revert the last move\r\n\t\tlast = _.last moveList\r\n\t\t[ldr, ldc] = directionToDelta last\r\n\t\tvalidMoves = _.filter validMoves, (m) ->\r\n\t\t\tnot directionsAreOpposites last, m\r\n\r\n\tsourceDirection = _.shuffle(validMoves)[0]\r\n\tnextGrid = grid.applyMoveFrom sourceDirection\r\n\tmoveList.push sourceDirection\r\n\r\n\trandomMoveList nextGrid, nMoves, moveList\r\n\r\ntransfer = ->\r\n\tfor i in range 16\r\n\t\tbuttons[i].title = grid.grid[i//4][i%%4]\r\n\r\nupdate = (delta) ->\r\n\tcurrent = constrain current+delta,0,window.solution.length\r\n\tgrid = originalGrid.applyMoves window.solution.slice 0,current\r\n\ttransfer()\r\n\r\ngoalReached = -> grid.isSolved()\r\n\r\ngoState = (newState) ->\r\n\tstate = newState\r\n\tvalues = \"1000 0100 1011\".split ' '\r\n\tfor button,i in buttons.slice 16,20\r\n\t\tbutton.active = values[state][i] == '1'\r\n\r\nwindowResized = -> resizeCanvas windowWidth, windowHeight\r\ndeviceTurned  = -> resizeCanvas windowWidth, windowHeight\r\n\r\nsetup = ->\r\n\tcreateCanvas windowWidth,windowHeight\r\n\r\n\tlevel = localStorage[KEY]\r\n\tlevel = if level? then parseInt level else 1\r\n\t#level = 15\r\n\r\n\tfor i in range 16\r\n\t\tx = i%4\r\n\t\ty = i//4\r\n\t\tbuttons.push new Button i,x,y,N,N,100,->\r\n\t\t\t[y0,x0] = grid.emptyPos\r\n\t\t\tfor move in grid.validMoves()\r\n\t\t\t\tdx = x0-@x\r\n\t\t\t\tdy = y0-@y\r\n\t\t\t\tif abs(dx) + abs(dy) == 1\r\n\t\t\t\t\tif move == grid.positionToMove @y,@x\r\n\t\t\t\t\t\tgrid = grid.applyMoveFrom move\r\n\t\t\t\t\t\tother = buttons[x0+4*y0]\r\n\t\t\t\t\t\t[other.title,@title] = [@title,other.title]\r\n\t\t\tif goalReached()\r\n\t\t\t\tgoState 0\r\n\t\t\t\tlevel++\r\n\r\n\tbuttons.push new Button 'Go',0,5,N,N,50,->\r\n\t\tgoState 1\r\n\t\tgrid = new Grid INIT_GRID, [3,3]\r\n\t\twindow.solution = []\r\n\t\tgrid = grid.applyMoves randomMoveList grid,level\r\n\t\ttransfer()\r\n\r\n\tbuttons.push new Button 'Solve',1,5,N,N,50,->\r\n\t\tif level > 1 then level--\r\n\t\twindow.solution = []\r\n\t\toriginalGrid = grid.copy()\r\n\t\tsolve grid\r\n\t\tcurrent = 0\r\n\t\tgoState 2\r\n\r\n\tbuttons.push new Button 'Prev',2,5,N,N,50,-> update -1\r\n\tbuttons.push new Button 'Next',3,5,N,N,50,-> update +1\r\n\r\n\tgoState 0\r\n\r\n\tgrid = new Grid INIT_GRID, [3,3]\r\n\ttransfer()\r\n\r\ndraw = ->\r\n\r\n\tif deviceOrientation == LANDSCAPE\r\n\t\tscale min width/6/N,height/4/N\r\n\t\tbuttons[16].setxy 4,0 \r\n\t\tbuttons[17].setxy 5,0 \r\n\t\tbuttons[18].setxy 4,3 \r\n\t\tbuttons[19].setxy 5,3 \r\n\telse # PORTRAIT or undefined\r\n\t\tscale min width/4/N,height/6/N\r\n\t\tbuttons[16].setxy 0,5 \r\n\t\tbuttons[17].setxy 1,5 \r\n\t\tbuttons[18].setxy 2,5 \r\n\t\tbuttons[19].setxy 3,5 \r\n\r\n\tbackground 128\r\n\tfor button in buttons\r\n\t\tbutton.draw()\r\n\tif solution.length > 0\r\n\t\ttextAlign CENTER,CENTER\r\n\t\tfill 255\r\n\t\tif deviceOrientation == LANDSCAPE\r\n\t\t\ttext \"#{current} of #{solution.length}\", 5*N,2.5*N\r\n\t\telse # PORTRAIT or undefined\r\n\t\t\ttext \"#{current} of #{solution.length}\", 3*N,4.5*N\r\n\tfill 255\r\n\tif deviceOrientation == LANDSCAPE\r\n\t\ttext level,5*N,1.5*N\r\n\telse # PORTRAIT or undefined\r\n\t\ttext level,N,4.5*N\r\n\tfill 0\r\n\r\ntoggleFullscreen = ->\r\n\telem = document.querySelector \"#fullscreen\"\r\n\tif !document.fullscreenElement\r\n\t\telem.requestFullscreen() #.catch (err) -> alert \"Error: #{err.message} (#{err.name})\"\r\n\telse \r\n\t\tdocument.exitFullscreen()\r\n\r\nmouseReleased = ->\r\n\treleased = true\r\n\tfalse\r\nmousePressed = ->\r\n\tif not released then return false\r\n\treleased = false \r\n\r\n\tfor button,i in buttons\r\n\t\tif button.inside() \r\n\t\t\tif button.title == 0 then toggleFullscreen()\r\n\t\t\tif (state==1 and i<16) or i>=16\r\n\t\t\t\tbutton.click()\r\n\t\t\t\tlocalStorage[KEY] = level\r\n\t\t\t\treturn false \r\n\tfalse \r\n\r\n\r\n\r\n"
  ]
}