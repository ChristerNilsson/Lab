// Generated by CoffeeScript 2.3.2
// Coding Challenge 130: Drawing with Fourier Transform and Epicycles
// Daniel Shiffman
// https://thecodingtrain.com/CodingChallenges/130-fourier-transform-drawing.html
// https://youtu.be/MY4luNgGfms
// https://editor.p5js.org/codingtrain/sketches/ldBlISrsQ
var draw, epiCycles, fourierX, fourierY, myround, pDistance, path, reduce, setup, simplereduce, start, time, x, y;

x = [];

y = [];

fourierX = null;

fourierY = null;

time = 0;

path = [];

start = 0;

pDistance = function(p, q, r) { // q is the point
  var A, B, C, D, dot, len_sq, param, s;
  A = q.x - p.x;
  B = q.y - p.y;
  C = r.x - p.x;
  D = r.y - p.y;
  dot = A * C + B * D;
  len_sq = C * C + D * D;
  param = len_sq === 0 ? -1 : dot / len_sq;
  if (param < 0) {
    s = p;
  } else if (param > 1) {
    s = r;
  } else {
    s = createVector(p.x + param * C, p.y + param * D);
  }
  return dist(q.x, q.y, s.x, s.y);
};

simplereduce = function(points) {
  var i, j, len, p, results;
  results = [];
  for (i = j = 0, len = points.length; j < len; i = ++j) {
    p = points[i];
    if (i % 8 === 0) {
      results.push(p);
    }
  }
  return results;
};

reduce = function(points, d) {
  var i, j, len, p, q, r, ref, res;
  res = [];
  res.push(points[0]);
  p = points[0];
  q = points[1];
  r = points[2];
  ref = range(1, points.length - 1);
  for (j = 0, len = ref.length; j < len; j++) {
    i = ref[j];
    if (d < pDistance(p, q, r)) { // keep
      res.push(q);
      p = q;
    }
    q = r;
    r = points[i + 2];
  }
  res.push(_.last(points));
  return res;
};

myround = function(x, n) {
  return round(x * 10 ** n) / 10 ** n;
};

setup = function() {
  var newpoints, p;
  createCanvas(800, 600);
  newpoints = reduce(points, 0.1);
  print(newpoints);
  newpoints = (function() {
    var j, len, results;
    results = [];
    for (j = 0, len = newpoints.length; j < len; j++) {
      p = newpoints[j];
      results.push({
        x: myround(p.x, 2),
        y: myround(p.y, 2)
      });
    }
    return results;
  })();
  print(JSON.stringify(newpoints));
  x = (function() {
    var j, len, results;
    results = [];
    for (j = 0, len = newpoints.length; j < len; j++) {
      p = newpoints[j];
      results.push(p.x);
    }
    return results;
  })();
  y = (function() {
    var j, len, results;
    results = [];
    for (j = 0, len = newpoints.length; j < len; j++) {
      p = newpoints[j];
      results.push(p.y);
    }
    return results;
  })();
  fourierX = dft(x);
  fourierY = dft(y);
  fourierX.sort((a, b) => {
    return b.amp - a.amp;
  });
  fourierY.sort((a, b) => {
    return b.amp - a.amp;
  });
  return start = new Date();
};

epiCycles = function(x, y, rotation, fourier) {
  var amp, freq, j, len, phase;
  for (j = 0, len = fourier.length; j < len; j++) {
    ({freq, amp, phase} = fourier[j]);
    x += amp * cos(freq * time + phase + rotation);
    y += amp * sin(freq * time + phase + rotation);
  }
  return createVector(x, y);
};

draw = function() {
  var dt, j, len, p, v, vx, vy;
  background(0);
  noFill();
  stroke(255);
  vx = epiCycles(width / 2 + 100, 100, 0, fourierX);
  vy = epiCycles(100, height / 2 + 100, HALF_PI, fourierY);
  v = createVector(vx.x, vy.y);
  path.unshift(v);
  strokeWeight(2);
  beginShape();
  for (j = 0, len = path.length; j < len; j++) {
    p = path[j];
    vertex(p.x, p.y);
  }
  //point p.x,p.y
  strokeWeight(1);
  endShape();
  dt = TWO_PI / fourierY.length;
  time += dt;
  if (time > TWO_PI) {
    noLoop();
    time = 0;
    path = [];
    print((new Date()) - start);
    return start = new Date();
  }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWVcXHNrZXRjaC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztBQUFBLElBQUEsSUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLEVBQUEsUUFBQSxFQUFBLE9BQUEsRUFBQSxTQUFBLEVBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxLQUFBLEVBQUEsWUFBQSxFQUFBLEtBQUEsRUFBQSxJQUFBLEVBQUEsQ0FBQSxFQUFBOztBQU1BLENBQUEsR0FBSTs7QUFDSixDQUFBLEdBQUk7O0FBQ0osUUFBQSxHQUFXOztBQUNYLFFBQUEsR0FBVzs7QUFDWCxJQUFBLEdBQU87O0FBQ1AsSUFBQSxHQUFPOztBQUNQLEtBQUEsR0FBUTs7QUFFUixTQUFBLEdBQVksUUFBQSxDQUFDLENBQUQsRUFBRyxDQUFILEVBQUssQ0FBTCxDQUFBLEVBQUE7QUFDWCxNQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsTUFBQSxFQUFBLEtBQUEsRUFBQTtFQUFBLENBQUEsR0FBSSxDQUFDLENBQUMsQ0FBRixHQUFNLENBQUMsQ0FBQztFQUNaLENBQUEsR0FBSSxDQUFDLENBQUMsQ0FBRixHQUFNLENBQUMsQ0FBQztFQUNaLENBQUEsR0FBSSxDQUFDLENBQUMsQ0FBRixHQUFNLENBQUMsQ0FBQztFQUNaLENBQUEsR0FBSSxDQUFDLENBQUMsQ0FBRixHQUFNLENBQUMsQ0FBQztFQUNaLEdBQUEsR0FBTSxDQUFBLEdBQUksQ0FBSixHQUFRLENBQUEsR0FBSTtFQUNsQixNQUFBLEdBQVMsQ0FBQSxHQUFJLENBQUosR0FBUSxDQUFBLEdBQUk7RUFDckIsS0FBQSxHQUFXLE1BQUEsS0FBVSxDQUFiLEdBQW9CLENBQUMsQ0FBckIsR0FBNEIsR0FBQSxHQUFNO0VBQzFDLElBQUcsS0FBQSxHQUFRLENBQVg7SUFBa0IsQ0FBQSxHQUFJLEVBQXRCO0dBQUEs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QVQsRUFBWSxDQUFDLENBQUMsQ0FBZDtFQURELENBWEE7O0VBY0EsWUFBQSxDQUFhLENBQWI7RUFDQSxRQUFBLENBQUE7RUFFQSxFQUFBLEdBQUssTUFBQSxHQUFTLFFBQVEsQ0FBQztFQUN2QixJQUFBLElBQVE7RUFFUixJQUFHLElBQUEsR0FBTyxNQUFWO0lBQ0MsTUFBQSxDQUFBO0lBQ0EsSUFBQSxHQUFPO0lBQ1AsSUFBQSxHQUFPO0lBQ1AsS0FBQSxDQUFNLENBQUMsSUFBSSxJQUFKLENBQUEsQ0FBRCxDQUFBLEdBQWUsS0FBckI7V0FDQSxLQUFBLEdBQVEsSUFBSSxJQUFKLENBQUEsRUFMVDs7QUFyQk0iLCJzb3VyY2VzQ29udGVudCI6WyIjIENvZGluZyBDaGFsbGVuZ2UgMTMwOiBEcmF3aW5nIHdpdGggRm91cmllciBUcmFuc2Zvcm0gYW5kIEVwaWN5Y2xlc1xuIyBEYW5pZWwgU2hpZmZtYW5cbiMgaHR0cHM6Ly90aGVjb2Rpbmd0cmFpbi5jb20vQ29kaW5nQ2hhbGxlbmdlcy8xMzAtZm91cmllci10cmFuc2Zvcm0tZHJhd2luZy5odG1sXG4jIGh0dHBzOi8veW91dHUuYmUvTVk0bHVOZ0dmbXNcbiMgaHR0cHM6Ly9lZGl0b3IucDVqcy5vcmcvY29kaW5ndHJhaW4vc2tldGNoZXMvbGRCbElTcnNRXG5cbnggPSBbXVxueSA9IFtdXG5mb3VyaWVyWCA9IG51bGxcbmZvdXJpZXJZID0gbnVsbFxudGltZSA9IDBcbnBhdGggPSBbXVxuc3RhcnQgPSAwXG5cbnBEaXN0YW5jZSA9IChwLHEscikgLT4gIyBxIGlzIHRoZSBwb2ludFxuXHRBID0gcS54IC0gcC54XG5cdEIgPSBxLnkgLSBwLnlcblx0QyA9IHIueCAtIHAueFxuXHREID0gci55IC0gcC55XG5cdGRvdCA9IEEgKiBDICsgQiAqIERcblx0bGVuX3NxID0gQyAqIEMgKyBEICogRFxuXHRwYXJhbSA9IGlmIGxlbl9zcSA9PSAwIHRoZW4gLTEgZWxzZSBkb3QgLyBsZW5fc3Fcblx0aWYgcGFyYW0gPCAwIHRoZW4gcyA9IHBcblx0ZWxzZSBpZiBwYXJhbSA+IDEgdGhlbiBzID0gclxuXHRlbHNlIHMgPSBjcmVhdGVWZWN0b3IgcC54ICsgcGFyYW0gKiBDLCBwLnkgKyBwYXJhbSAqIERcblx0ZGlzdCBxLngscS55LHMueCxzLnlcblxuc2ltcGxlcmVkdWNlID0gKHBvaW50cykgLT4gKHAgZm9yIHAsaSBpbiBwb2ludHMgd2hlbiBpJTggPT0gMClcblxucmVkdWNlID0gKHBvaW50cyxkKSAtPlxuXHRyZXMgPSBbXVxuXHRyZXMucHVzaCBwb2ludHNbMF0gXG5cblx0cCA9IHBvaW50c1swXVxuXHRxID0gcG9pbnRzWzFdXG5cdHIgPSBwb2ludHNbMl1cblx0Zm9yIGkgaW4gcmFuZ2UgMSxwb2ludHMubGVuZ3RoLTFcblx0XHRpZiBkIDwgcERpc3RhbmNlIHAscSxyICMga2VlcFxuXHRcdFx0cmVzLnB1c2ggcVxuXHRcdFx0cCA9IHFcblx0XHRxID0gclxuXHRcdHIgPSBwb2ludHNbaSsyXVx0XHRcdFxuXG5cdHJlcy5wdXNoIF8ubGFzdCBwb2ludHNcblx0cmVzXG5cbm15cm91bmQgPSAoeCxuKSAtPiByb3VuZCh4KjEwKipuKS8xMCoqblxuXG5zZXR1cCA9ICgpIC0+XG5cdGNyZWF0ZUNhbnZhcyA4MDAsIDYwMFxuXHRuZXdwb2ludHMgPSByZWR1Y2UgcG9pbnRzLCAwLjFcblx0cHJpbnQgbmV3cG9pbnRzXG5cdG5ld3BvaW50cyA9ICh7eDpteXJvdW5kKHAueCwyKSwgeTpteXJvdW5kKHAueSwyKX0gZm9yIHAgaW4gbmV3cG9pbnRzKVxuXHRwcmludCBKU09OLnN0cmluZ2lmeSBuZXdwb2ludHNcblxuXHR4ID0gKHAueCBmb3IgcCBpbiBuZXdwb2ludHMpXG5cdHkgPSAocC55IGZvciBwIGluIG5ld3BvaW50cylcblx0XG5cdGZvdXJpZXJYID0gZGZ0IHhcblx0Zm91cmllclkgPSBkZnQgeVxuXG5cdGZvdXJpZXJYLnNvcnQgKGEsIGIpID0+IGIuYW1wIC0gYS5hbXBcblx0Zm91cmllclkuc29ydCAoYSwgYikgPT4gYi5hbXAgLSBhLmFtcFxuXG5cdHN0YXJ0ID0gbmV3IERhdGUoKVxuXG5lcGlDeWNsZXMgPSAoeCwgeSwgcm90YXRpb24sIGZvdXJpZXIpIC0+XG5cdGZvciB7ZnJlcSxhbXAscGhhc2V9IGluIGZvdXJpZXJcblx0XHR4ICs9IGFtcCAqIGNvcyBmcmVxICogdGltZSArIHBoYXNlICsgcm90YXRpb25cblx0XHR5ICs9IGFtcCAqIHNpbiBmcmVxICogdGltZSArIHBoYXNlICsgcm90YXRpb25cblx0Y3JlYXRlVmVjdG9yIHgsIHlcblxuZHJhdyA9IC0+XG5cdGJhY2tncm91bmQgMFxuXHRub0ZpbGwoKVxuXHRzdHJva2UgMjU1XG5cblx0dnggPSBlcGlDeWNsZXMgd2lkdGggLyAyICsgMTAwLCAxMDAsIDAsIGZvdXJpZXJYXG5cdHZ5ID0gZXBpQ3ljbGVzIDEwMCwgaGVpZ2h0IC8gMiArIDEwMCwgSEFMRl9QSSwgZm91cmllcllcblx0diA9IGNyZWF0ZVZlY3RvciB2eC54LCB2eS55XG5cdHBhdGgudW5zaGlmdCB2XG5cblx0c3Ryb2tlV2VpZ2h0IDJcblx0YmVnaW5TaGFwZSgpXG5cdGZvciBwIGluIHBhdGhcblx0XHR2ZXJ0ZXggcC54LCBwLnlcblx0XHQjcG9pbnQgcC54LHAueVxuXHRzdHJva2VXZWlnaHQgMVx0XHRcblx0ZW5kU2hhcGUoKVxuXG5cdGR0ID0gVFdPX1BJIC8gZm91cmllclkubGVuZ3RoXG5cdHRpbWUgKz0gZHRcblxuXHRpZiB0aW1lID4gVFdPX1BJXG5cdFx0bm9Mb29wKClcblx0XHR0aW1lID0gMFxuXHRcdHBhdGggPSBbXVxuXHRcdHByaW50IChuZXcgRGF0ZSgpKSAtIHN0YXJ0XG5cdFx0c3RhcnQgPSBuZXcgRGF0ZSgpIFxuIl19
//# sourceURL=C:\Lab\2019\013-CC130\coffee\sketch.coffee