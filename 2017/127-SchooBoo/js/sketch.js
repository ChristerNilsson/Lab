// Generated by CoffeeScript 1.12.7
var DIR, changePage, chapter, device, draw, fetch, img, info, markedAreas, mousePressed, pageNo, rects, setup, touchEnded,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

DIR = 'kallocain';

pageNo = 1;

img = null;

rects = null;

chapter = null;

markedAreas = {};

markedAreas[1] = [[4, 7, 1], [32, 35, 2]];

markedAreas[2] = [[14, 17, 3], [22, 25, 4]];

device = null;

setup = function() {
  createCanvas(1280, 720);
  fetch();
  frameRate(10);
  device = info();
  return print(device);
};

fetch = function() {
  var xmlhttp, xmlhttp1;
  img = null;
  rects = null;
  chapter = null;
  loadImage(DIR + ("/page" + pageNo + ".png"), function(_img) {
    return img = _img;
  });
  xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
    if (this.readyState === 4 && this.status === 200) {
      return rects = JSON.parse(this.responseText);
    }
  };
  xmlhttp.open("GET", "images/page" + pageNo + ".json", true);
  xmlhttp.send();
  xmlhttp1 = new XMLHttpRequest();
  xmlhttp1.onreadystatechange = function() {
    if (this.readyState === 4 && this.status === 200) {
      return chapter = JSON.parse(this.responseText);
    }
  };
  xmlhttp1.open("GET", DIR + "/chapter.json", true);
  return xmlhttp1.send();
};

draw = function() {
  var color, h, i, j, k, len, len1, n, p, ref, ref1, ref2, ref3, start, stopp, w, x, y;
  bg(1);
  sc();
  if (rects && markedAreas[pageNo]) {
    ref = markedAreas[pageNo];
    for (j = 0, len = ref.length; j < len; j++) {
      ref1 = ref[j], start = ref1[0], stopp = ref1[1], color = ref1[2];
      ref2 = range(start, stopp + 1);
      for (k = 0, len1 = ref2.length; k < len1; k++) {
        i = ref2[k];
        ref3 = rects[i], x = ref3[0], y = ref3[1], w = ref3[2], h = ref3[3];
        if (color === 1) {
          fc(1, 0, 0);
        }
        if (color === 2) {
          fc(0, 1, 0);
        }
        if (color === 3) {
          fc(1, 1, 0);
        }
        if (color === 4) {
          fc(0, 1, 1);
        }
        if (color > 0) {
          rect(x - 6, y + 8, w + 10, h - 2);
        }
      }
    }
  }
  if (img) {
    image(img, 0, 0);
  }
  if (chapter) {
    n = chapter[1];
    w = width / n;
    p = (pageNo - 1) * w;
    sc(0);
    y = height - 2;
    return line(p, y, p + w, y);
  }
};

changePage = function() {
  var n;
  if (mouseX < 0.1 * width && pageNo > 1) {
    pageNo--;
  }
  if (mouseX > 0.9 * width) {
    pageNo++;
  }
  if (chapter) {
    n = chapter[1];
    pageNo = constrain(pageNo, 1, n);
  }
  return fetch();
};

mousePressed = function() {
  if (device.is_touch_device === false) {
    changePage();
  }
  return false;
};

touchEnded = function() {
  if (device.is_touch_device === true) {
    changePage();
  }
  return false;
};

info = function() {
  var ratio;
  ratio = window.devicePixelRatio || 1;
  return {
    ratio: ratio,
    is_touch_device: indexOf.call(document.documentElement, 'ontouchstart') >= 0,
    sw: screen.width,
    sh: screen.height,
    cw: document.documentElement.clientWidth,
    ch: document.documentElement.clientHeight,
    rw: screen.width * ratio,
    rh: screen.height * ratio
  };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWVcXHNrZXRjaC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLElBQUEscUhBQUE7RUFBQTs7QUFBQSxHQUFBLEdBQU07O0FBRU4sTUFBQSxHQUFTOztBQUNULEdBQUEsR0FBTTs7QUFDTixLQUFBLEdBQVE7O0FBQ1IsT0FBQSxHQUFVOztBQUVWLFdBQUEsR0FBYzs7QUFDZCxXQUFZLENBQUEsQ0FBQSxDQUFaLEdBQWlCLENBQUMsQ0FBQyxDQUFELEVBQUcsQ0FBSCxFQUFLLENBQUwsQ0FBRCxFQUFTLENBQUMsRUFBRCxFQUFJLEVBQUosRUFBTyxDQUFQLENBQVQ7O0FBQ2pCLFdBQVksQ0FBQSxDQUFBLENBQVosR0FBaUIsQ0FBQyxDQUFDLEVBQUQsRUFBSSxFQUFKLEVBQU8sQ0FBUCxDQUFELEVBQVcsQ0FBQyxFQUFELEVBQUksRUFBSixFQUFPLENBQVAsQ0FBWDs7QUFFakIsTUFBQSxHQUFTOztBQUVULEtBQUEsR0FBUSxTQUFBO0VBRVAsWUFBQSxDQUFhLElBQWIsRUFBa0IsR0FBbEI7RUFDQSxLQUFBLENBQUE7RUFDQSxTQUFBLENBQVUsRUFBVjtFQUNBLE1BQUEsR0FBUyxJQUFBLENBQUE7U0FDVCxLQUFBLENBQU0sTUFBTjtBQU5POztBQVFSLEtBQUEsR0FBUSxTQUFBO0FBQ1AsTUFBQTtFQUFBLEdBQUEsR0FBTTtFQUNOLEtBQUEsR0FBUTtFQUNSLE9BQUEsR0FBVTtFQUNWLFNBQUEsQ0FBVSxHQUFBLEdBQU0sQ0FBQSxPQUFBLEdBQVEsTUFBUixHQUFlLE1BQWYsQ0FBaEIsRUFBc0MsU0FBQyxJQUFEO1dBQVUsR0FBQSxHQUFNO0VBQWhCLENBQXRDO0VBRUEsT0FBQSxHQUFVLElBQUksY0FBSixDQUFBO0VBQ1YsT0FBTyxDQUFDLGtCQUFSLEdBQTZCLFNBQUE7SUFDNUIsSUFBRyxJQUFJLENBQUMsVUFBTCxLQUFtQixDQUFuQixJQUF3QixJQUFJLENB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Qzs7U0FDQTtBQUZjOztBQUlmLFVBQUEsR0FBYSxTQUFBO0VBQ1osSUFBRyxNQUFNLENBQUMsZUFBUCxLQUEwQixJQUE3QjtJQUF1QyxVQUFBLENBQUEsRUFBdkM7O1NBQ0E7QUFGWTs7QUFJYixJQUFBLEdBQU8sU0FBQTtBQUNOLE1BQUE7RUFBQSxLQUFBLEdBQVEsTUFBTSxDQUFDLGdCQUFQLElBQTJCO1NBQ25DO0lBQUEsS0FBQSxFQUFRLEtBQVI7SUFDQSxlQUFBLEVBQWtCLGFBQWtCLFFBQVEsQ0FBQyxlQUEzQixFQUFBLGNBQUEsTUFEbEI7SUFFQSxFQUFBLEVBQUssTUFBTSxDQUFDLEtBRlo7SUFHQSxFQUFBLEVBQUssTUFBTSxDQUFDLE1BSFo7SUFJQSxFQUFBLEVBQUssUUFBUSxDQUFDLGVBQWUsQ0FBQyxXQUo5QjtJQUtBLEVBQUEsRUFBSyxRQUFRLENBQUMsZUFBZSxDQUFDLFlBTDlCO0lBTUEsRUFBQSxFQUFLLE1BQU0sQ0FBQyxLQUFQLEdBQWUsS0FOcEI7SUFPQSxFQUFBLEVBQUssTUFBTSxDQUFDLE1BQVAsR0FBZ0IsS0FQckI7O0FBRk0iLCJzb3VyY2VzQ29udGVudCI6WyIjRElSID0gJ2JlcmdldCdcclxuRElSID0gJ2thbGxvY2FpbidcclxuXHJcbnBhZ2VObyA9IDFcclxuaW1nID0gbnVsbFxyXG5yZWN0cyA9IG51bGxcclxuY2hhcHRlciA9IG51bGwgIyBbU0laRSxwYWdlc11cclxuXHJcbm1hcmtlZEFyZWFzID0ge31cclxubWFya2VkQXJlYXNbMV0gPSBbWzQsNywxXSxbMzIsMzUsMl1dXHJcbm1hcmtlZEFyZWFzWzJdID0gW1sxNCwxNywzXSxbMjIsMjUsNF1dXHJcblxyXG5kZXZpY2UgPSBudWxsXHJcblxyXG5zZXR1cCA9IC0+XHJcblx0I2NyZWF0ZUNhbnZhcyA2NDAsMzYwXHJcblx0Y3JlYXRlQ2FudmFzIDEyODAsNzIwXHJcblx0ZmV0Y2goKVxyXG5cdGZyYW1lUmF0ZSAxMFxyXG5cdGRldmljZSA9IGluZm8oKVxyXG5cdHByaW50IGRldmljZVxyXG5cclxuZmV0Y2ggPSAtPlxyXG5cdGltZyA9IG51bGxcclxuXHRyZWN0cyA9IG51bGxcclxuXHRjaGFwdGVyID0gbnVsbFxyXG5cdGxvYWRJbWFnZSBESVIgKyBcIi9wYWdlI3twYWdlTm99LnBuZ1wiLCAoX2ltZykgLT4gaW1nID0gX2ltZ1xyXG5cclxuXHR4bWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCkgICAgXHJcblx0eG1saHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSAtPlxyXG5cdFx0aWYgdGhpcy5yZWFkeVN0YXRlID09IDQgJiYgdGhpcy5zdGF0dXMgPT0gMjAwXHJcblx0XHRcdHJlY3RzID0gSlNPTi5wYXJzZSB0aGlzLnJlc3BvbnNlVGV4dFxyXG5cdHhtbGh0dHAub3BlbiBcIkdFVFwiLCBcImltYWdlcy9wYWdlI3twYWdlTm99Lmpzb25cIiwgdHJ1ZVxyXG5cdHhtbGh0dHAuc2VuZCgpXHJcblxyXG5cdHhtbGh0dHAxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCkgICAgXHJcblx0eG1saHR0cDEub25yZWFkeXN0YXRlY2hhbmdlID0gKCkgLT5cclxuXHRcdGlmIHRoaXMucmVhZHlTdGF0ZSA9PSA0ICYmIHRoaXMuc3RhdHVzID09IDIwMFxyXG5cdFx0XHRjaGFwdGVyID0gSlNPTi5wYXJzZSB0aGlzLnJlc3BvbnNlVGV4dFxyXG5cdHhtbGh0dHAxLm9wZW4gXCJHRVRcIiwgRElSICsgXCIvY2hhcHRlci5qc29uXCIsIHRydWVcclxuXHR4bWxodHRwMS5zZW5kKClcclxuXHJcbmRyYXcgPSAtPlxyXG5cdGJnIDFcclxuXHRzYygpXHJcblx0aWYgcmVjdHMgYW5kIG1hcmtlZEFyZWFzW3BhZ2VOb11cclxuXHRcdGZvciBbc3RhcnQsc3RvcHAsY29sb3JdIGluIG1hcmtlZEFyZWFzW3BhZ2VOb11cclxuXHRcdFx0Zm9yIGkgaW4gcmFuZ2Ugc3RhcnQsc3RvcHArMVxyXG5cdFx0XHRcdFt4LHksdyxoXSA9IHJlY3RzW2ldXHJcblx0XHRcdFx0aWYgY29sb3I9PTEgdGhlbiBmYyAxLDAsMFxyXG5cdFx0XHRcdGlmIGNvbG9yPT0yIHRoZW4gZmMgMCwxLDBcclxuXHRcdFx0XHRpZiBjb2xvcj09MyB0aGVuIGZjIDEsMSwwXHJcblx0XHRcdFx0aWYgY29sb3I9PTQgdGhlbiBmYyAwLDEsMVxyXG5cdFx0XHRcdGlmIGNvbG9yID4gMCB0aGVuXHRyZWN0IHgtNix5KzgsdysxMCxoLTJcclxuXHRpZiBpbWcgdGhlbiBpbWFnZSBpbWcsIDAsIDBcclxuXHRpZiBjaGFwdGVyIFxyXG5cdFx0biA9IGNoYXB0ZXJbMV1cclxuXHRcdHcgPSB3aWR0aC9uXHJcblx0XHRwID0gKHBhZ2VOby0xKSAqIHdcclxuXHRcdHNjIDBcclxuXHRcdHkgPSBoZWlnaHQtMlxyXG5cdFx0bGluZSBwLHkscCt3LHlcclxuXHJcbmNoYW5nZVBhZ2UgPSAtPlxyXG5cdGlmIG1vdXNlWCA8IDAuMSAqIHdpZHRoIGFuZCBwYWdlTm8gPiAxIHRoZW4gcGFnZU5vLS1cclxuXHRpZiBtb3VzZVggPiAwLjkgKiB3aWR0aCB0aGVuIHBhZ2VObysrXHJcblx0aWYgY2hhcHRlclxyXG5cdFx0biA9IGNoYXB0ZXJbMV1cclxuXHRcdHBhZ2VObyA9IGNvbnN0cmFpbiBwYWdlTm8sMSxuXHJcblx0ZmV0Y2goKVxyXG5cclxubW91c2VQcmVzc2VkID0gLT5cclxuXHRpZiBkZXZpY2UuaXNfdG91Y2hfZGV2aWNlID09IGZhbHNlIHRoZW4gY2hhbmdlUGFnZSgpXHJcblx0ZmFsc2UgXHJcblxyXG50b3VjaEVuZGVkID0gLT5cclxuXHRpZiBkZXZpY2UuaXNfdG91Y2hfZGV2aWNlID09IHRydWUgdGhlbiBjaGFuZ2VQYWdlKClcclxuXHRmYWxzZSBcclxuXHJcbmluZm8gPSAtPlxyXG5cdHJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMVxyXG5cdHJhdGlvIDogcmF0aW9cclxuXHRpc190b3VjaF9kZXZpY2UgOiAnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnRcclxuXHRzdyA6IHNjcmVlbi53aWR0aCBcclxuXHRzaCA6IHNjcmVlbi5oZWlnaHRcclxuXHRjdyA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aFxyXG5cdGNoIDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodFxyXG5cdHJ3IDogc2NyZWVuLndpZHRoICogcmF0aW9cclxuXHRyaCA6IHNjcmVlbi5oZWlnaHQgKiByYXRpb1xyXG5cdCJdfQ==
//# sourceURL=C:\Lab\2017\127-SchooBoo\coffee\sketch.coffee