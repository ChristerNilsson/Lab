// Generated by CoffeeScript 1.12.7
var changePage, chapter, device, draw, fetch, img, info, markedAreas, mousePressed, pageNo, rects, setup, touchEnded,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

pageNo = 1;

img = null;

rects = null;

chapter = null;

markedAreas = {};

markedAreas[1] = [[4, 7, 1], [32, 35, 2]];

markedAreas[2] = [[14, 17, 3], [22, 25, 4]];

device = null;

setup = function() {
  createCanvas(1280, 720);
  fetch();
  frameRate(10);
  device = info();
  return print(device);
};

fetch = function() {
  var xmlhttp, xmlhttp1;
  img = null;
  rects = null;
  chapter = null;
  loadImage("images/page" + pageNo + ".png", function(_img) {
    return img = _img;
  });
  xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
    if (this.readyState === 4 && this.status === 200) {
      return rects = JSON.parse(this.responseText);
    }
  };
  xmlhttp.open("GET", "images/page" + pageNo + ".json", true);
  xmlhttp.send();
  xmlhttp1 = new XMLHttpRequest();
  xmlhttp1.onreadystatechange = function() {
    if (this.readyState === 4 && this.status === 200) {
      return chapter = JSON.parse(this.responseText);
    }
  };
  xmlhttp1.open("GET", "images/chapter.json", true);
  return xmlhttp1.send();
};

draw = function() {
  var color, h, i, j, k, len, len1, n, p, ref, ref1, ref2, ref3, start, stopp, w, x, y;
  bg(1);
  sc();
  if (rects && markedAreas[pageNo]) {
    ref = markedAreas[pageNo];
    for (j = 0, len = ref.length; j < len; j++) {
      ref1 = ref[j], start = ref1[0], stopp = ref1[1], color = ref1[2];
      ref2 = range(start, stopp + 1);
      for (k = 0, len1 = ref2.length; k < len1; k++) {
        i = ref2[k];
        ref3 = rects[i], x = ref3[0], y = ref3[1], w = ref3[2], h = ref3[3];
        if (color === 1) {
          fc(1, 0, 0);
        }
        if (color === 2) {
          fc(0, 1, 0);
        }
        if (color === 3) {
          fc(1, 1, 0);
        }
        if (color === 4) {
          fc(0, 1, 1);
        }
        if (color > 0) {
          rect(x - 6, y + 8, w + 10, h - 2);
        }
      }
    }
  }
  if (img) {
    image(img, 0, 0);
  }
  if (chapter) {
    n = chapter[1];
    w = width / n;
    p = (pageNo - 1) * w;
    sc(0);
    y = height - 2;
    return line(p, y, p + w, y);
  }
};

changePage = function() {
  var n;
  if (mouseX < 0.1 * width && pageNo > 1) {
    pageNo--;
  }
  if (mouseX > 0.9 * width) {
    pageNo++;
  }
  if (chapter) {
    n = chapter[1];
    pageNo = constrain(pageNo, 1, n);
  }
  return fetch();
};

mousePressed = function() {
  if (device.is_touch_device === false) {
    changePage();
  }
  return false;
};

touchEnded = function() {
  if (device.is_touch_device === true) {
    changePage();
  }
  return false;
};

info = function() {
  var ratio;
  ratio = window.devicePixelRatio || 1;
  return {
    ratio: ratio,
    is_touch_device: indexOf.call(document.documentElement, 'ontouchstart') >= 0,
    sw: screen.width,
    sh: screen.height,
    cw: document.documentElement.clientWidth,
    ch: document.documentElement.clientHeight,
    rw: screen.width * ratio,
    rh: screen.height * ratio
  };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWVcXHNrZXRjaC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQUEsZ0hBQUE7RUFBQTs7QUFBQSxNQUFBLEdBQVM7O0FBQ1QsR0FBQSxHQUFNOztBQUNOLEtBQUEsR0FBUTs7QUFDUixPQUFBLEdBQVU7O0FBRVYsV0FBQSxHQUFjOztBQUNkLFdBQVksQ0FBQSxDQUFBLENBQVosR0FBaUIsQ0FBQyxDQUFDLENBQUQsRUFBRyxDQUFILEVBQUssQ0FBTCxDQUFELEVBQVMsQ0FBQyxFQUFELEVBQUksRUFBSixFQUFPLENBQVAsQ0FBVDs7QUFDakIsV0FBWSxDQUFBLENBQUEsQ0FBWixHQUFpQixDQUFDLENBQUMsRUFBRCxFQUFJLEVBQUosRUFBTyxDQUFQLENBQUQsRUFBVyxDQUFDLEVBQUQsRUFBSSxFQUFKLEVBQU8sQ0FBUCxDQUFYOztBQUVqQixNQUFBLEdBQVM7O0FBRVQsS0FBQSxHQUFRLFNBQUE7RUFFUCxZQUFBLENBQWEsSUFBYixFQUFrQixHQUFsQjtFQUNBLEtBQUEsQ0FBQTtFQUNBLFNBQUEsQ0FBVSxFQUFWO0VBQ0EsTUFBQSxHQUFTLElBQUEsQ0FBQTtTQUNULEtBQUEsQ0FBTSxNQUFOO0FBTk87O0FBUVIsS0FBQSxHQUFRLFNBQUE7QUFDUCxNQUFBO0VBQUEsR0FBQSxHQUFNO0VBQ04sS0FBQSxHQUFRO0VBQ1IsT0FBQSxHQUFVO0VBQ1YsU0FBQSxDQUFVLGFBQUEsR0FBYyxNQUFkLEdBQXFCLE1BQS9CLEVBQXNDLFNBQUMsSUFBRDtXQUFVLEdBQUEsR0FBTTtFQUFoQixDQUF0QztFQUVBLE9BQUEsR0FBVSxJQUFJLGNBQUosQ0FBQTtFQUNWLE9BQU8sQ0FBQyxrQkFBUixHQUE2QixTQUFBO0lBQzVCLElBQUcsSUFBSSxDQUFDLFVBQUwsS0FBbUIsQ0FBbkIsSUFBd0IsSUFBSSxDQUFDLE1BQUwsS0FBZSxHQUExQzthQUNDLEtBQUEsR0FBUSxJ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TUFBTSxDQUFDLGVBQVAsS0FBMEIsSUFBN0I7SUFBdUMsVUFBQSxDQUFBLEVBQXZDOztTQUNBO0FBRlk7O0FBSWIsSUFBQSxHQUFPLFNBQUE7QUFDTixNQUFBO0VBQUEsS0FBQSxHQUFRLE1BQU0sQ0FBQyxnQkFBUCxJQUEyQjtTQUNuQztJQUFBLEtBQUEsRUFBUSxLQUFSO0lBQ0EsZUFBQSxFQUFrQixhQUFrQixRQUFRLENBQUMsZUFBM0IsRUFBQSxjQUFBLE1BRGxCO0lBRUEsRUFBQSxFQUFLLE1BQU0sQ0FBQyxLQUZaO0lBR0EsRUFBQSxFQUFLLE1BQU0sQ0FBQyxNQUhaO0lBSUEsRUFBQSxFQUFLLFFBQVEsQ0FBQyxlQUFlLENBQUMsV0FKOUI7SUFLQSxFQUFBLEVBQUssUUFBUSxDQUFDLGVBQWUsQ0FBQyxZQUw5QjtJQU1BLEVBQUEsRUFBSyxNQUFNLENBQUMsS0FBUCxHQUFlLEtBTnBCO0lBT0EsRUFBQSxFQUFLLE1BQU0sQ0FBQyxNQUFQLEdBQWdCLEtBUHJCOztBQUZNIiwic291cmNlc0NvbnRlbnQiOlsicGFnZU5vID0gMVxyXG5pbWcgPSBudWxsXHJcbnJlY3RzID0gbnVsbFxyXG5jaGFwdGVyID0gbnVsbCAjIFtTSVpFLHBhZ2VzXVxyXG5cclxubWFya2VkQXJlYXMgPSB7fVxyXG5tYXJrZWRBcmVhc1sxXSA9IFtbNCw3LDFdLFszMiwzNSwyXV1cclxubWFya2VkQXJlYXNbMl0gPSBbWzE0LDE3LDNdLFsyMiwyNSw0XV1cclxuXHJcbmRldmljZSA9IG51bGxcclxuXHJcbnNldHVwID0gLT5cclxuXHQjY3JlYXRlQ2FudmFzIDY0MCwzNjBcclxuXHRjcmVhdGVDYW52YXMgMTI4MCw3MjBcclxuXHRmZXRjaCgpXHJcblx0ZnJhbWVSYXRlIDEwXHJcblx0ZGV2aWNlID0gaW5mbygpXHJcblx0cHJpbnQgZGV2aWNlXHJcblxyXG5mZXRjaCA9IC0+XHJcblx0aW1nID0gbnVsbFxyXG5cdHJlY3RzID0gbnVsbFxyXG5cdGNoYXB0ZXIgPSBudWxsXHJcblx0bG9hZEltYWdlIFwiaW1hZ2VzL3BhZ2Uje3BhZ2VOb30ucG5nXCIsIChfaW1nKSAtPiBpbWcgPSBfaW1nXHJcblxyXG5cdHhtbGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSAgICBcclxuXHR4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9ICgpIC0+XHJcblx0XHRpZiB0aGlzLnJlYWR5U3RhdGUgPT0gNCAmJiB0aGlzLnN0YXR1cyA9PSAyMDBcclxuXHRcdFx0cmVjdHMgPSBKU09OLnBhcnNlIHRoaXMucmVzcG9uc2VUZXh0XHJcblx0eG1saHR0cC5vcGVuIFwiR0VUXCIsIFwiaW1hZ2VzL3BhZ2Uje3BhZ2VOb30uanNvblwiLCB0cnVlXHJcblx0eG1saHR0cC5zZW5kKClcclxuXHJcblx0eG1saHR0cDEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSAgICBcclxuXHR4bWxodHRwMS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSAtPlxyXG5cdFx0aWYgdGhpcy5yZWFkeVN0YXRlID09IDQgJiYgdGhpcy5zdGF0dXMgPT0gMjAwXHJcblx0XHRcdGNoYXB0ZXIgPSBKU09OLnBhcnNlIHRoaXMucmVzcG9uc2VUZXh0XHJcblx0eG1saHR0cDEub3BlbiBcIkdFVFwiLCBcImltYWdlcy9jaGFwdGVyLmpzb25cIiwgdHJ1ZVxyXG5cdHhtbGh0dHAxLnNlbmQoKVxyXG5cclxuZHJhdyA9IC0+XHJcblx0YmcgMVxyXG5cdHNjKClcclxuXHRpZiByZWN0cyBhbmQgbWFya2VkQXJlYXNbcGFnZU5vXVxyXG5cdFx0Zm9yIFtzdGFydCxzdG9wcCxjb2xvcl0gaW4gbWFya2VkQXJlYXNbcGFnZU5vXVxyXG5cdFx0XHRmb3IgaSBpbiByYW5nZSBzdGFydCxzdG9wcCsxXHJcblx0XHRcdFx0W3gseSx3LGhdID0gcmVjdHNbaV1cclxuXHRcdFx0XHRpZiBjb2xvcj09MSB0aGVuIGZjIDEsMCwwXHJcblx0XHRcdFx0aWYgY29sb3I9PTIgdGhlbiBmYyAwLDEsMFxyXG5cdFx0XHRcdGlmIGNvbG9yPT0zIHRoZW4gZmMgMSwxLDBcclxuXHRcdFx0XHRpZiBjb2xvcj09NCB0aGVuIGZjIDAsMSwxXHJcblx0XHRcdFx0aWYgY29sb3IgPiAwIHRoZW5cdHJlY3QgeC02LHkrOCx3KzEwLGgtMlxyXG5cdGlmIGltZyB0aGVuIGltYWdlIGltZywgMCwgMFxyXG5cdGlmIGNoYXB0ZXIgXHJcblx0XHRuID0gY2hhcHRlclsxXVxyXG5cdFx0dyA9IHdpZHRoL25cclxuXHRcdHAgPSAocGFnZU5vLTEpICogd1xyXG5cdFx0c2MgMFxyXG5cdFx0eSA9IGhlaWdodC0yXHJcblx0XHRsaW5lIHAseSxwK3cseVxyXG5cclxuY2hhbmdlUGFnZSA9IC0+XHJcblx0aWYgbW91c2VYIDwgMC4xICogd2lkdGggYW5kIHBhZ2VObyA+IDEgdGhlbiBwYWdlTm8tLVxyXG5cdGlmIG1vdXNlWCA+IDAuOSAqIHdpZHRoIHRoZW4gcGFnZU5vKytcclxuXHRpZiBjaGFwdGVyXHJcblx0XHRuID0gY2hhcHRlclsxXVxyXG5cdFx0cGFnZU5vID0gY29uc3RyYWluIHBhZ2VObywxLG5cclxuXHRmZXRjaCgpXHJcblxyXG5tb3VzZVByZXNzZWQgPSAtPlxyXG5cdGlmIGRldmljZS5pc190b3VjaF9kZXZpY2UgPT0gZmFsc2UgdGhlbiBjaGFuZ2VQYWdlKClcclxuXHRmYWxzZSBcclxuXHJcbnRvdWNoRW5kZWQgPSAtPlxyXG5cdGlmIGRldmljZS5pc190b3VjaF9kZXZpY2UgPT0gdHJ1ZSB0aGVuIGNoYW5nZVBhZ2UoKVxyXG5cdGZhbHNlIFxyXG5cclxuaW5mbyA9IC0+XHJcblx0cmF0aW8gPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxXHJcblx0cmF0aW8gOiByYXRpb1xyXG5cdGlzX3RvdWNoX2RldmljZSA6ICdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudFxyXG5cdHN3IDogc2NyZWVuLndpZHRoIFxyXG5cdHNoIDogc2NyZWVuLmhlaWdodFxyXG5cdGN3IDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoXHJcblx0Y2ggOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0XHJcblx0cncgOiBzY3JlZW4ud2lkdGggKiByYXRpb1xyXG5cdHJoIDogc2NyZWVuLmhlaWdodCAqIHJhdGlvXHJcblx0Il19
//# sourceURL=C:\Lab\2017\127-SchooBoo\coffee\sketch.coffee