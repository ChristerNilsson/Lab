// Generated by CoffeeScript 1.11.1
var Game;

Game = (function() {
  function Game() {
    this.asteroids = [];
    this.ships = [];
    this.width = width;
    this.height = height;
    this.score = 0;
    this.spawnInterval = 120;
    this.interval = 0;
    this.maxAsteroids = 10;
    this.gen = [];
    this.alives = 0;
    this.generation = 0;
  }

  Game.prototype.start = function() {
    var i, j, len, ref;
    this.interval = 0;
    this.score = 0;
    this.asteroids = [];
    this.ships = [];
    this.gen = Neuvol.nextGeneration();
    ref = this.gen;
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      this.ships.push(new Ship());
    }
    this.generation++;
    return this.alives = this.ships.length;
  };

  Game.prototype.update = function() {
    var asteroid, i, inputs, j, k, len, len1, ref, ref1, res, ship;
    ref = this.ships;
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      ship = ref[i];
      if (ship.alive) {
        inputs = ship.getSensorDistances();
        res = this.gen[i].compute(inputs);
        ship.movex = 0;
        ship.movey = 0;
        if (res[0] > 0.65) {
          ship.movex++;
        }
        if (res[0] < 0.45) {
          ship.movex--;
        }
        if (res[1] > 0.65) {
          ship.movey++;
        }
        if (res[1] < 0.45) {
          ship.movey--;
        }
        ship.update();
        if (ship.isDead()) {
          ship.alive = false;
          this.alives--;
          Neuvol.networkScore(this.gen[i], this.score);
          if (this.isItEnd()) {
            this.start();
          }
        }
      }
    }
    ref1 = this.asteroids;
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      asteroid = ref1[k];
      asteroid.update();
    }
    if (this.interval === 0 && this.asteroids.length < this.maxAsteroids) {
      this.spawnAsteroids();
    }
    this.interval++;
    if (this.interval === this.spawnInterval) {
      this.interval = 0;
    }
    return this.score++;
  };

  Game.prototype.spawnAsteroids = function() {
    var a, j, len, results, spawn, spawns;
    spawns = [
      {
        x: 0 + 30,
        y: 0 + 30
      }, {
        x: width - 50,
        y: height - 50
      }
    ];
    results = [];
    for (j = 0, len = spawns.length; j < len; j++) {
      spawn = spawns[j];
      a = new Asteroid({
        x: spawn.x,
        y: spawn.y
      });
      results.push(this.asteroids.push(a));
    }
    return results;
  };

  Game.prototype.isItEnd = function() {
    var j, len, ref, ship;
    ref = this.ships;
    for (j = 0, len = ref.length; j < len; j++) {
      ship = ref[j];
      if (ship.alive) {
        return false;
      }
    }
    return true;
  };

  Game.prototype.display = function() {
    var asteroid, j, k, len, len1, ref, ref1, ship;
    background(0);
    ref = this.ships;
    for (j = 0, len = ref.length; j < len; j++) {
      ship = ref[j];
      if (ship.alive) {
        stroke(255, 0, 0);
        rect(ship.x, ship.y, ship.width, ship.height);
      }
    }
    fill(255, 255, 0);
    ref1 = this.asteroids;
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      asteroid = ref1[k];
      rect(asteroid.x, asteroid.y, asteroid.width, asteroid.height);
    }
    fill(255);
    noStroke();
    text("Score : " + this.score, 10, 25);
    text("Generation : " + this.generation, 10, 50);
    return text("Alive : " + this.alives + " / " + Neuvol.options.population, 10, 75);
  };

  return Game;

})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FtZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdhbWUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxJQUFBOztBQUFNO0VBQ1MsY0FBQTtJQUNiLElBQUMsQ0FBQSxTQUFELEdBQWE7SUFDYixJQUFDLENBQUEsS0FBRCxHQUFTO0lBRVQsSUFBQyxDQUFBLEtBQUQsR0FBUztJQUNULElBQUMsQ0FBQSxNQUFELEdBQVU7SUFFVixJQUFDLENBQUEsS0FBRCxHQUFTO0lBRVQsSUFBQyxDQUFBLGFBQUQsR0FBaUI7SUFDakIsSUFBQyxDQUFBLFFBQUQsR0FBWTtJQUNaLElBQUMsQ0FBQSxZQUFELEdBQWdCO0lBRWhCLElBQUMsQ0FBQSxHQUFELEdBQU87SUFFUCxJQUFDLENBQUEsTUFBRCxHQUFVO0lBQ1YsSUFBQyxDQUFBLFVBQUQsR0FBYztFQWhCRDs7aUJBa0JkLEtBQUEsR0FBUSxTQUFBO0FBQ1AsUUFBQTtJQUFBLElBQUMsQ0FBQSxRQUFELEdBQVk7SUFDWixJQUFDLENBQUEsS0FBRCxHQUFTO0lBQ1QsSUFBQyxDQUFBLFNBQUQsR0FBYTtJQUNiLElBQUMsQ0FBQSxLQUFELEdBQVM7SUFFVCxJQUFDLENBQUEsR0FBRCxHQUFPLE1BQU0sQ0FBQyxjQUFQLENBQUE7QUFDUDtBQUFBLFNBQUEscUNBQUE7O01BQ0MsSUFBQyxDQUFBLEtBQUssQ0FBQyxJQUFQLENBQWdCLElBQUEsSUFBQSxDQUFBLENBQWhCO0FBREQ7SUFFQSxJQUFDLENBQUEsVUFBRDtXQUNBLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBQyxDQUFBLEtBQUssQ0FBQztFQVZWOztpQkFZUixNQUFBLEdBQVMsU0FBQTtBQUNSLFFBQUE7QUFBQTtBQUFBLFNBQUEsNkNBQUE7O01BQ0MsSUFBRyxJQUFJLENBQUMsS0FBUjtRQUNDLE1BQUEsR0FBUyxJQUFJLENBQUMsa0JBQUwsQ0FBQTtRQUVULEdBQUEsR0FBTSxJQUFDLENBQUEsR0FBSSxDQUFBLENBQUEsQ0FBRSxD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R0EsSUFBQSxDQUFLLEdBQUw7SUFDQSxRQUFBLENBQUE7SUFDQSxJQUFBLENBQUssVUFBQSxHQUFhLElBQUMsQ0FBQSxLQUFuQixFQUEwQixFQUExQixFQUE4QixFQUE5QjtJQUNBLElBQUEsQ0FBSyxlQUFBLEdBQWtCLElBQUMsQ0FBQSxVQUF4QixFQUFvQyxFQUFwQyxFQUF3QyxFQUF4QztXQUNBLElBQUEsQ0FBSyxVQUFBLEdBQWEsSUFBQyxDQUFBLE1BQWQsR0FBdUIsS0FBdkIsR0FBK0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFuRCxFQUErRCxFQUEvRCxFQUFtRSxFQUFuRTtFQWhCUyIsInNvdXJjZXNDb250ZW50IjpbIlxuY2xhc3MgR2FtZVxuXHRjb25zdHJ1Y3RvciA6IC0+XG5cdFx0QGFzdGVyb2lkcyA9IFtdXG5cdFx0QHNoaXBzID0gW11cblxuXHRcdEB3aWR0aCA9IHdpZHRoXG5cdFx0QGhlaWdodCA9IGhlaWdodFxuXG5cdFx0QHNjb3JlID0gMFxuXG5cdFx0QHNwYXduSW50ZXJ2YWwgPSAxMjBcblx0XHRAaW50ZXJ2YWwgPSAwXG5cdFx0QG1heEFzdGVyb2lkcyA9IDEwXG5cblx0XHRAZ2VuID0gW11cblxuXHRcdEBhbGl2ZXMgPSAwXG5cdFx0QGdlbmVyYXRpb24gPSAwXG5cblx0c3RhcnQgOiAtPiBcblx0XHRAaW50ZXJ2YWwgPSAwXG5cdFx0QHNjb3JlID0gMFxuXHRcdEBhc3Rlcm9pZHMgPSBbXVxuXHRcdEBzaGlwcyA9IFtdXG5cblx0XHRAZ2VuID0gTmV1dm9sLm5leHRHZW5lcmF0aW9uKClcblx0XHRmb3IgaSBpbiBAZ2VuXG5cdFx0XHRAc2hpcHMucHVzaCBuZXcgU2hpcCgpXG5cdFx0QGdlbmVyYXRpb24rK1xuXHRcdEBhbGl2ZXMgPSBAc2hpcHMubGVuZ3RoXG5cblx0dXBkYXRlIDogLT4gXG5cdFx0Zm9yIHNoaXAsaSBpbiBAc2hpcHNcblx0XHRcdGlmIHNoaXAuYWxpdmVcblx0XHRcdFx0aW5wdXRzID0gc2hpcC5nZXRTZW5zb3JEaXN0YW5jZXMoKVxuXHRcdFx0XHQjY29uc29sZS5sb2cgaW5wdXRzXG5cdFx0XHRcdHJlcyA9IEBnZW5baV0uY29tcHV0ZSBpbnB1dHNcblx0XHRcdFx0c2hpcC5tb3ZleCA9IDBcblx0XHRcdFx0c2hpcC5tb3ZleSA9IDBcblxuXHRcdFx0XHRpZiByZXNbMF0gPiAwLjY1IHRoZW4gc2hpcC5tb3ZleCsrXG5cdFx0XHRcdGlmIHJlc1swXSA8IDAuNDUgdGhlbiBzaGlwLm1vdmV4LS1cblx0XHRcdFx0aWYgcmVzWzFdID4gMC42NSB0aGVuIHNoaXAubW92ZXkrK1xuXHRcdFx0XHRpZiByZXNbMV0gPCAwLjQ1IHRoZW4gc2hpcC5tb3ZleS0tXG5cblx0XHRcdFx0c2hpcC51cGRhdGUoKVxuXHRcdFx0XHRpZiBzaGlwLmlzRGVhZCgpXG5cdFx0XHRcdFx0c2hpcC5hbGl2ZSA9IGZhbHNlXG5cdFx0XHRcdFx0QGFsaXZlcy0tXG5cdFx0XHRcdFx0TmV1dm9sLm5ldHdvcmtTY29yZSBAZ2VuW2ldLCBAc2NvcmVcblx0XHRcdFx0XHRpZiBAaXNJdEVuZCgpIHRoZW4gQHN0YXJ0KClcblxuXHRcdGZvciBhc3Rlcm9pZCBpbiBAYXN0ZXJvaWRzXG5cdFx0XHRhc3Rlcm9pZC51cGRhdGUoKVxuXG5cdFx0aWYgQGludGVydmFsID09IDAgJiYgQGFzdGVyb2lkcy5sZW5ndGggPCBAbWF4QXN0ZXJvaWRzIHRoZW4gQHNwYXduQXN0ZXJvaWRzKClcblxuXHRcdEBpbnRlcnZhbCsrXG5cdFx0aWYgQGludGVydmFsID09IEBzcGF3bkludGVydmFsIHRoZW4gQGludGVydmFsID0gMFxuXG5cdFx0QHNjb3JlKytcblxuXHRzcGF3bkFzdGVyb2lkcyA6IC0+XG5cdFx0c3Bhd25zID0gW3t4OjAgKyAzMCwgeTowICsgMzB9LCB7eDp3aWR0aCAtIDUwLCB5OmhlaWdodCAtIDUwfV1cblx0XHRmb3Igc3Bhd24gaW4gc3Bhd25zXG5cdFx0XHRhID0gbmV3IEFzdGVyb2lkIHt4OnNwYXduLngsIHk6c3Bhd24ueX1cblx0XHRcdEBhc3Rlcm9pZHMucHVzaCBhXG5cblx0aXNJdEVuZCA6IC0+XG5cdFx0Zm9yIHNoaXAgaW4gQHNoaXBzXG5cdFx0XHRpZiBzaGlwLmFsaXZlIHRoZW4gcmV0dXJuIGZhbHNlXG5cdFx0cmV0dXJuIHRydWVcblxuXHRkaXNwbGF5IDogLT5cblx0XHRiYWNrZ3JvdW5kIDBcblxuXHRcdGZvciBzaGlwIGluIEBzaGlwc1xuXHRcdFx0aWYgc2hpcC5hbGl2ZVxuXHRcdFx0XHRzdHJva2UgMjU1LDAsMFxuXHRcdFx0XHRyZWN0IHNoaXAueCwgc2hpcC55LCBzaGlwLndpZHRoLCBzaGlwLmhlaWdodFxuXG5cdFx0ZmlsbCAyNTUsMjU1LDAgXG5cdFx0Zm9yIGFzdGVyb2lkIGluIEBhc3Rlcm9pZHNcblx0XHRcdHJlY3QgYXN0ZXJvaWQueCwgYXN0ZXJvaWQueSwgYXN0ZXJvaWQud2lkdGgsIGFzdGVyb2lkLmhlaWdodFxuXG5cdFx0ZmlsbCAyNTVcblx0XHRub1N0cm9rZSgpXG5cdFx0dGV4dCBcIlNjb3JlIDogXCIgKyBAc2NvcmUsIDEwLCAyNVxuXHRcdHRleHQgXCJHZW5lcmF0aW9uIDogXCIgKyBAZ2VuZXJhdGlvbiwgMTAsIDUwXG5cdFx0dGV4dCBcIkFsaXZlIDogXCIgKyBAYWxpdmVzICsgXCIgLyBcIiArIE5ldXZvbC5vcHRpb25zLnBvcHVsYXRpb24sIDEwLCA3NSJdfQ==
//# sourceURL=C:\Lab\2017\002-asteroids-ai\game.coffee