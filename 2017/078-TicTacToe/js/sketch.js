// Generated by CoffeeScript 1.11.1
var EMPTY, MARKERS, WINNERS, ai, buttons, drawOnce, marks, mousePressed, move, newGame, setup, state;

EMPTY = ' ';

MARKERS = 'XO';

WINNERS = [1 + 2 + 4, 8 + 16 + 32, 64 + 128 + 256, 1 + 8 + 64, 2 + 16 + 128, 4 + 32 + 256, 1 + 16 + 256, 4 + 16 + 64];

buttons = null;

marks = null;

state = null;

ai = function() {
  var i, owner;
  return _.sample((function() {
    var j, len, results;
    results = [];
    for (i = j = 0, len = buttons.length; j < len; i = ++j) {
      owner = buttons[i];
      if (owner === EMPTY) {
        results.push(i);
      }
    }
    return results;
  })());
};

drawOnce = function() {
  var index, j, len, owner, ref, x, y;
  for (index = j = 0, len = buttons.length; j < len; index = ++j) {
    owner = buttons[index];
    ref = [100 * (index % 3), 100 * int(index / 3)], x = ref[0], y = ref[1];
    fc(1);
    rect(x, y, 100, 100);
    fc(0);
    text(owner, x + 50, y + 50);
  }
  fc(1, 0, 0);
  return text(state, 150, 150);
};

mousePressed = function() {
  var index;
  if (state !== '') {
    return newGame();
  }
  index = (int(mouseX / 100)) + 3 * int(mouseY / 100);
  if (buttons[index] === EMPTY) {
    move(0, index);
    move(1, ai());
    return drawOnce();
  }
};

move = function(player, index) {
  var j, len, results, winner;
  if (state !== '') {
    return;
  }
  buttons[index] = MARKERS[player];
  marks[player] |= 1 << index;
  results = [];
  for (j = 0, len = WINNERS.length; j < len; j++) {
    winner = WINNERS[j];
    if ((winner & marks[player]) === winner) {
      results.push(state = MARKERS[player] + ' wins!');
    } else {
      results.push(void 0);
    }
  }
  return results;
};

newGame = function() {
  var i;
  buttons = (function() {
    var j, len, ref, results;
    ref = range(9);
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      results.push(EMPTY);
    }
    return results;
  })();
  marks = [0, 0];
  state = '';
  return drawOnce();
};

setup = function() {
  createCanvas(400, 400);
  textAlign(CENTER, CENTER);
  textSize(90);
  return newGame();
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWVcXHNrZXRjaC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQUE7O0FBQUEsS0FBQSxHQUFROztBQUNSLE9BQUEsR0FBVTs7QUFDVixPQUFBLEdBQVUsQ0FBQyxDQUFBLEdBQUUsQ0FBRixHQUFJLENBQUwsRUFBTyxDQUFBLEdBQUUsRUFBRixHQUFLLEVBQVosRUFBZSxFQUFBLEdBQUcsR0FBSCxHQUFPLEdBQXRCLEVBQTBCLENBQUEsR0FBRSxDQUFGLEdBQUksRUFBOUIsRUFBaUMsQ0FBQSxHQUFFLEVBQUYsR0FBSyxHQUF0QyxFQUEwQyxDQUFBLEdBQUUsRUFBRixHQUFLLEdBQS9DLEVBQW1ELENBQUEsR0FBRSxFQUFGLEdBQUssR0FBeEQsRUFBNEQsQ0FBQSxHQUFFLEVBQUYsR0FBSyxFQUFqRTs7QUFFVixPQUFBLEdBQVU7O0FBQ1YsS0FBQSxHQUFROztBQUNSLEtBQUEsR0FBUTs7QUFFUixFQUFBLEdBQUssU0FBQTtBQUFHLE1BQUE7U0FBQSxDQUFDLENBQUMsTUFBRjs7QUFBVTtTQUFBLGlEQUFBOztVQUE4QixLQUFBLEtBQVM7cUJBQXZDOztBQUFBOztNQUFWO0FBQUg7O0FBRUwsUUFBQSxHQUFXLFNBQUE7QUFDVixNQUFBO0FBQUEsT0FBQSx5REFBQTs7SUFDQyxNQUFRLENBQUMsR0FBQSxHQUFNLENBQUMsS0FBQSxHQUFNLENBQVAsQ0FBUCxFQUFrQixHQUFBLEdBQU0sR0FBQSxDQUFJLEtBQUEsR0FBTSxDQUFWLENBQXhCLENBQVIsRUFBQyxVQUFELEVBQUc7SUFDSCxFQUFBLENBQUcsQ0FBSDtJQUNBLElBQUEsQ0FBSyxDQUFMLEVBQU8sQ0FBUCxFQUFTLEdBQVQsRUFBYSxHQUFiO0lBQ0EsRUFBQSxDQUFHLENBQUg7SUFDQSxJQUFBLENBQUssS0FBTCxFQUFXLENBQUEsR0FBRSxFQUFiLEVBQWdCLENBQUEsR0FBRSxFQUFsQjtBQUxEO0VBTUEsRUFBQSxDQUFHLENBQUgsRUFBSyxDQUFMLEVBQU8sQ0FBUDtTQUNBLElBQUEsQ0FBSyxLQUFMLEVBQVcsR0FBWCxFQUFlLEdBQWY7QUFSVTs7QUFVWCxZQUFBLEdBQWUsU0FBQTtBQUNkLE1BQUE7RUFBQSxJQUFHLEtBQUEsS0FBUyxFQUFaO0FBQW9CLFdBQU8sT0FBQSxDQUFBLEVBQTNCOztFQUNBLEtBQUEsR0FBUSxDQUFDLEdBQUEsQ0FBSSxNQUFBLEdBQU8sR0FBWCxDQUFELENBQUEsR0FBbUIsQ0FBQSxHQUFJLEdBQUEsQ0FBSSxNQUFBLEdBQU8sR0FBWDtFQUMvQixJQUFHLE9BQVEsQ0FBQSxLQUFBLENBQVIsS0FBa0IsS0FBckI7SUFDQyxJQUFBLENBQUssQ0FBTCxFQUFPLEtBQVA7SUFDQSxJQUFBLENBQUssQ0FBTCxFQUFPLEVBQUEsQ0FBQSxDQUFQO1dBQ0EsUUFBQSxDQUFBLEVBSEQ7O0FBSGM7O0FBUWYsSUFBQSxHQUFPLFNBQUMsTUFBRCxFQUFRLEtBQVI7QUFDTixNQUFBO0VBQUEsSUFBRyxLQUFBLEtBQVMsRUFBWjtBQUFvQixXQUFwQjs7RUFDQSxPQUFRLENBQUEsS0FBQSxDQUFSLEdBQWlCLE9BQVEsQ0FBQSxNQUFBO0VBQ3pCLEtBQU0sQ0FBQSxNQUFBLENBQU4sSUFBaUIsQ0FBQSxJQUFLO0FBQ3RCO09BQUEseUNBQUE7O0lBQ0MsSUFBRyxDQUFDLE1BQUEsR0FBUyxLQUFNLENBQUEsTUFBQSxDQUFoQixDQUFBLEtBQTRCLE1BQS9CO21CQUEyQyxLQUFBLEdBQVEsT0FBUSxDQUFBLE1BQUEsQ0FBUixHQUFrQixVQUFyRTtLQUFBLE1BQUE7MkJBQUE7O0FBREQ7O0FBSk07O0FBT1AsT0FBQSxHQUFVLFNBQUE7QUFDVCxNQUFBO0VBQUEsT0FBQTs7QUFBVztBQUFBO1NBQUEscUNBQUE7O21CQUFBO0FBQUE7OztFQUNYLEtBQUEsR0FBUSxDQUFDLENBQUQsRUFBRyxDQUFIO0VBQ1IsS0FBQSxHQUFRO1NBQ1IsUUFBQSxDQUFBO0FBSlM7O0FBTVYsS0FBQSxHQUFRLFNBQUE7RUFDUCxZQUFBLENBQWEsR0FBYixFQUFpQixHQUFqQjtFQUNBLFNBQUEsQ0FBVSxNQUFWLEVBQWlCLE1BQWpCO0VBQ0EsUUFBQSxDQUFTLEVBQVQ7U0FDQSxPQUFBLENBQUE7QUFKTyIsInNvdXJjZXNDb250ZW50IjpbIkVNUFRZID0gJyAnXHJcbk1BUktFUlMgPSAnWE8nXHJcbldJTk5FUlMgPSBbMSsyKzQsOCsxNiszMiw2NCsxMjgrMjU2LDErOCs2NCwyKzE2KzEyOCw0KzMyKzI1NiwxKzE2KzI1Niw0KzE2KzY0XVxyXG5cclxuYnV0dG9ucyA9IG51bGxcclxubWFya3MgPSBudWxsXHJcbnN0YXRlID0gbnVsbFxyXG5cclxuYWkgPSAtPiBfLnNhbXBsZSAoaSBmb3Igb3duZXIsaSBpbiBidXR0b25zIHdoZW4gb3duZXIgPT0gRU1QVFkpXHJcblxyXG5kcmF3T25jZSA9IC0+XHJcblx0Zm9yIG93bmVyLGluZGV4IGluIGJ1dHRvbnNcclxuXHRcdFt4LHldID0gWzEwMCAqIChpbmRleCUzKSwgMTAwICogaW50IGluZGV4LzNdXHJcblx0XHRmYyAxXHJcblx0XHRyZWN0IHgseSwxMDAsMTAwXHJcblx0XHRmYyAwXHJcblx0XHR0ZXh0IG93bmVyLHgrNTAseSs1MFxyXG5cdGZjIDEsMCwwXHJcblx0dGV4dCBzdGF0ZSwxNTAsMTUwXHJcblxyXG5tb3VzZVByZXNzZWQgPSAtPlxyXG5cdGlmIHN0YXRlICE9ICcnIHRoZW4gcmV0dXJuIG5ld0dhbWUoKVxyXG5cdGluZGV4ID0gKGludCBtb3VzZVgvMTAwKSArIDMgKiBpbnQgbW91c2VZLzEwMFxyXG5cdGlmIGJ1dHRvbnNbaW5kZXhdID09IEVNUFRZXHJcblx0XHRtb3ZlIDAsaW5kZXhcclxuXHRcdG1vdmUgMSxhaSgpXHJcblx0XHRkcmF3T25jZSgpXHJcblxyXG5tb3ZlID0gKHBsYXllcixpbmRleCkgLT5cclxuXHRpZiBzdGF0ZSAhPSAnJyB0aGVuIHJldHVyblxyXG5cdGJ1dHRvbnNbaW5kZXhdID0gTUFSS0VSU1twbGF5ZXJdXHJcblx0bWFya3NbcGxheWVyXSB8PSAxIDw8IGluZGV4XHJcblx0Zm9yIHdpbm5lciBpbiBXSU5ORVJTXHJcblx0XHRpZiAod2lubmVyICYgbWFya3NbcGxheWVyXSkgPT0gd2lubmVyIHRoZW4gc3RhdGUgPSBNQVJLRVJTW3BsYXllcl0gKyAnIHdpbnMhJ1xyXG5cclxubmV3R2FtZSA9IC0+XHJcblx0YnV0dG9ucyA9IChFTVBUWSBmb3IgaSBpbiByYW5nZSA5KVxyXG5cdG1hcmtzID0gWzAsMF1cclxuXHRzdGF0ZSA9ICcnXHJcblx0ZHJhd09uY2UoKVxyXG5cclxuc2V0dXAgPSAtPlxyXG5cdGNyZWF0ZUNhbnZhcyA0MDAsNDAwXHJcblx0dGV4dEFsaWduIENFTlRFUixDRU5URVJcclxuXHR0ZXh0U2l6ZSA5MFxyXG5cdG5ld0dhbWUoKSJdfQ==
//# sourceURL=C:\Lab\2017\078-TicTacToe\coffee\sketch.coffee